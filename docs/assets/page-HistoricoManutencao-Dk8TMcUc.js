import{r as c,A as H,u as T,j as e,M as q}from"./index-B5aSUcFk.js";import{M as O}from"./index.esm-Dw_fqbFe.js";import{g as m,u as R,a as B,d as z}from"./maintenanceService-DOGDJ6m6.js";import{g as P}from"./carService-B4lSvgg8.js";function J(){const{usuarioLogado:r}=c.useContext(H)||{},b=T(),[j,u]=c.useState([]),[l,C]=c.useState([]),[S,g]=c.useState(!0),[w,n]=c.useState(!1),[h,N]=c.useState(null),[v,F]=c.useState("todos"),[M,p]=c.useState(""),[i,t]=c.useState({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""});c.useEffect(()=>{(async()=>{if(r){g(!0);try{const s=r.id||r.email,o=await P(s);C(o);const d=await m(s);u(d)}catch(s){console.error("Erro ao carregar dados:",s)}finally{g(!1)}}})()},[r]);const D=async a=>{if(a.preventDefault(),!r)return;const s=r.id||r.email;try{if(h){await R(s,h,i);const o=await m(s);u(o)}else{await B(s,i);const o=await m(s);u(o)}x(),n(!1)}catch(o){console.error("Erro ao salvar manuten√ß√£o:",o),alert("Erro ao salvar manuten√ß√£o. Tente novamente.")}},y=a=>{const s=a&&(a.data||a.createdAt||new Date().toISOString());let o="";if(s){const d=new Date(s);if(!isNaN(d.getTime())){const V=d.getFullYear(),L=String(d.getMonth()+1).padStart(2,"0"),$=String(d.getDate()).padStart(2,"0");o=`${V}-${L}-${$}`}}t({...a,data:o}),N(a.id),p(a.veiculoId),n(!0)},k=async a=>{if(!window.confirm("Tem certeza que deseja excluir este registro?")||!r)return;const s=r.id||r.email;try{await z(s,a);const o=await m(s);u(o)}catch(o){console.error("Erro ao deletar manuten√ß√£o:",o),alert("Erro ao deletar manuten√ß√£o. Tente novamente.")}},x=()=>{t({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),N(null),p("")},E=a=>{p(a),a&&t({...i,veiculoId:a})},I=a=>{const s=l.find(o=>String(o.id)===String(a));return s?`${s.marca} ${s.modelo} (${s.ano})`:"Ve√≠culo n√£o encontrado"},A=a=>{const s=a&&(a.data||a.createdAt||a.createdAt)||"",o=s?new Date(s):new Date;return isNaN(o.getTime())?new Date().toLocaleDateString("pt-BR"):o.toLocaleDateString("pt-BR")},f=[...v==="todos"?j:j.filter(a=>a.veiculoId===v)].sort((a,s)=>new Date(s.data)-new Date(a.data));return r?e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page historico-page",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsx("div",{className:"historico-intro",children:e.jsx("p",{children:"Mantenha um registro completo de todas as manuten√ß√µes, trocas de pe√ßas e servi√ßos realizados nos seus ve√≠culos. Esse hist√≥rico digital facilita o acompanhamento de revis√µes peri√≥dicas e aumenta o valor de revenda."})}),S?e.jsx("div",{className:"historico-loading",children:e.jsx("p",{children:"Carregando dados..."})}):l.length===0?e.jsxs("div",{className:"historico-no-cars",children:[e.jsx("p",{children:"Voc√™ ainda n√£o possui ve√≠culos cadastrados."}),e.jsx("p",{children:"Cadastre seu primeiro ve√≠culo para come√ßar a registrar manuten√ß√µes."}),e.jsx("button",{onClick:()=>b("/meus-carros"),className:"historico-add-car-btn",children:"üìù Ir para Meus Carros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historico-actions",children:[e.jsxs("div",{className:"historico-filters",children:[e.jsx("label",{htmlFor:"filtro-veiculo",children:"Filtrar por ve√≠culo:"}),e.jsxs("select",{id:"filtro-veiculo",value:v,onChange:a=>F(a.target.value),className:"historico-select",children:[e.jsx("option",{value:"todos",children:"Todos os ve√≠culos"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsx("button",{className:"historico-add-btn",onClick:()=>{x(),n(!0)},children:"+ Nova Manuten√ß√£o"})]}),f.length===0?e.jsxs("div",{className:"historico-empty",children:[e.jsx("p",{children:"Nenhuma manuten√ß√£o registrada ainda."}),e.jsx("p",{children:'Clique em "Nova Manuten√ß√£o" para come√ßar.'})]}):e.jsx("div",{className:"historico-list",children:f.map(a=>e.jsxs("div",{className:"historico-card",children:[e.jsxs("div",{className:"historico-card-header",children:[e.jsx("div",{className:"historico-card-veiculo",children:I(a.veiculoId)}),e.jsx("div",{className:"historico-card-data",children:A(a)})]}),e.jsxs("div",{className:"historico-card-body",children:[e.jsx("div",{className:"historico-card-tipo",children:e.jsx("span",{className:`historico-tipo-badge ${a.tipo}`,children:a.tipo==="preventiva"?"Preventiva":a.tipo==="corretiva"?"Corretiva":"Outro"})}),e.jsxs("div",{className:"historico-card-descricao",children:[e.jsx("strong",{children:"Descri√ß√£o:"})," ",a.descricao]}),a.kmAtual&&e.jsxs("div",{className:"historico-card-km",children:[e.jsx("strong",{children:"Quilometragem:"})," ",parseInt(a.kmAtual).toLocaleString("pt-BR")," km"]}),a.oficina&&e.jsxs("div",{className:"historico-card-oficina",children:[e.jsx("strong",{children:"Oficina:"})," ",a.oficina]}),a.valor&&e.jsxs("div",{className:"historico-card-valor",children:[e.jsx("strong",{children:"Valor:"})," R$ ",parseFloat(a.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.observacoes&&e.jsxs("div",{className:"historico-card-obs",children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",a.observacoes]})]}),e.jsxs("div",{className:"historico-card-actions",children:[e.jsx("button",{className:"historico-edit-btn",onClick:()=>y(a),children:"Editar"}),e.jsx("button",{className:"historico-delete-btn",onClick:()=>k(a.id),children:"Excluir"})]})]},a.id))})]}),w&&e.jsx("div",{className:"historico-modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"historico-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"historico-modal-header",children:[e.jsx("h3",{children:h?"Editar Manuten√ß√£o":"Nova Manuten√ß√£o"}),e.jsx("button",{className:"historico-modal-close",onClick:()=>n(!1),children:"√ó"})]}),e.jsxs("form",{onSubmit:D,className:"historico-form",children:[!h&&l.length>0&&e.jsxs("div",{className:"historico-form-group historico-car-helper",children:[e.jsx("label",{htmlFor:"carroHelper",children:"üöó Selecione um ve√≠culo cadastrado (facilita o preenchimento)"}),e.jsxs("select",{id:"carroHelper",value:M,onChange:a=>E(a.target.value),className:"historico-input historico-car-selector",children:[e.jsx("option",{value:"",children:"-- Selecione um carro cadastrado --"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")",a.isDefault?" ‚≠ê":""]},a.id))]}),e.jsx("small",{className:"historico-helper-text",children:'Ao selecionar um ve√≠culo, o campo "Ve√≠culo" ser√° preenchido automaticamente'})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"veiculoId",children:"Ve√≠culo *"}),e.jsxs("select",{id:"veiculoId",value:i.veiculoId,onChange:a=>t({...i,veiculoId:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"",children:"Selecione um ve√≠culo"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"data",children:"Data *"}),e.jsx("input",{type:"date",id:"data",value:i.data,onChange:a=>t({...i,data:a.target.value}),required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",value:i.tipo,onChange:a=>t({...i,tipo:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"preventiva",children:"Preventiva"}),e.jsx("option",{value:"corretiva",children:"Corretiva"}),e.jsx("option",{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"descricao",children:"Descri√ß√£o *"}),e.jsx("input",{type:"text",id:"descricao",value:i.descricao,onChange:a=>t({...i,descricao:a.target.value}),placeholder:"Ex: Troca de √≥leo e filtro",required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"kmAtual",children:"Quilometragem"}),e.jsx("input",{type:"number",id:"kmAtual",value:i.kmAtual,onChange:a=>t({...i,kmAtual:a.target.value}),placeholder:"Ex: 50000",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"valor",children:"Valor (R$)"}),e.jsx("input",{type:"number",step:"0.01",id:"valor",value:i.valor,onChange:a=>t({...i,valor:a.target.value}),placeholder:"Ex: 150.00",className:"historico-input"})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"oficina",children:"Oficina/Local"}),e.jsx("input",{type:"text",id:"oficina",value:i.oficina,onChange:a=>t({...i,oficina:a.target.value}),placeholder:"Ex: Auto Center XYZ",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"observacoes",children:"Observa√ß√µes"}),e.jsx("textarea",{id:"observacoes",value:i.observacoes,onChange:a=>t({...i,observacoes:a.target.value}),placeholder:"Informa√ß√µes adicionais sobre a manuten√ß√£o",rows:"3",className:"historico-textarea"})]}),e.jsxs("div",{className:"historico-form-actions",children:[e.jsx("button",{type:"button",className:"historico-cancel-btn",onClick:()=>{x(),n(!1)},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"historico-save-btn",children:h?"Salvar Altera√ß√µes":"Adicionar Manuten√ß√£o"})]})]})]})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsxs("div",{className:"historico-login-required",children:[e.jsx("p",{children:"Voc√™ precisa estar logado para acessar o hist√≥rico de manuten√ß√£o."}),e.jsx("a",{href:"/#/login",className:"historico-login-btn",children:"Fazer Login"})]})]})})]})}export{J as default};
