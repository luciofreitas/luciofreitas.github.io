import{r as a,j as e,M as N,L as g,s as k}from"./index-BAnybm9n.js";import{E as S}from"./emailService-BNRgp8aK.js";function U(){const[r,m]=a.useState(""),[i,n]=a.useState(!1),[f,l]=a.useState(""),[u,c]=a.useState(""),[v,h]=a.useState(!1),E=async t=>{t.preventDefault(),n(!0),c(""),l("");try{const s=r.toLowerCase().trim();console.log("Email processado:",s);const{data:x,error:d}=await k.from("users").select("id, nome, email, auth_id");if(console.log("Todos os usuÃ¡rios:",x,"Erro:",d),d)throw console.error("Erro ao buscar usuÃ¡rios:",d),new Error("Erro ao acessar o banco de dados.");const o=x?.find(w=>w.email?.toLowerCase()===s);if(console.log("UsuÃ¡rio encontrado:",o),!o){console.warn("UsuÃ¡rio nÃ£o encontrado na tabela users:",s),c("Email nÃ£o encontrado. Verifique e tente novamente."),n(!1);return}const p=`${Date.now()}-${Math.random().toString(36).substring(7)}`,j=`${window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?window.location.origin:"https://www.garagemsmart.com.br"}/#/redefinir-senha?token=${p}&email=${encodeURIComponent(s)}`;console.log("Link de recuperaÃ§Ã£o gerado:",j);const b={email:s,token:p,expiresAt:Date.now()+3600*1e3};localStorage.setItem(`reset_token_${s}`,JSON.stringify(b)),console.log("Enviando email via EmailJS..."),await S.sendPasswordResetEmail({nome:o.nome||"UsuÃ¡rio",email:s,userId:o.id,resetLink:j}),console.log("Email enviado com sucesso!"),h(!0),l(`âœ… Email de recuperaÃ§Ã£o enviado para ${s}. Verifique sua caixa de entrada e spam.`)}catch(s){console.error("Erro ao solicitar recuperaÃ§Ã£o de senha:",s),c("Erro ao enviar email de recuperaÃ§Ã£o. Tente novamente mais tarde.")}finally{n(!1)}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(N,{}),e.jsxs("div",{className:"esqueci-senha-card",children:[e.jsxs("div",{className:"esqueci-senha-header",children:[e.jsx("h1",{children:"ğŸ” Esqueci minha senha"}),e.jsx("p",{children:"NÃ£o se preocupe! Vamos te ajudar a recuperar o acesso Ã  sua conta."})]}),v?e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-message",children:f}),e.jsxs("div",{className:"success-info",children:[e.jsx("h3",{children:"ğŸ“¬ PrÃ³ximos passos:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["âœ… Verifique sua caixa de entrada em ",e.jsx("strong",{children:r})]}),e.jsx("li",{children:"âœ… Procure por email da Garagem Smart"}),e.jsxs("li",{children:["âœ… Se nÃ£o encontrar, verifique a pasta de ",e.jsx("strong",{children:"SPAM"})]}),e.jsx("li",{children:"âœ… Clique no link de recuperaÃ§Ã£o"}),e.jsx("li",{children:"âœ… Defina sua nova senha"})]})]}),e.jsx("button",{onClick:()=>{h(!1),m(""),l("")},className:"resend-btn",children:"ğŸ“§ Reenviar email"})]}):e.jsxs("form",{onSubmit:E,className:"esqueci-senha-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email cadastrado:"}),e.jsx("input",{type:"email",id:"email",value:r,onChange:t=>m(t.target.value),placeholder:"seuemail@exemplo.com",required:!0,disabled:i,className:"input-field"})]}),u&&e.jsxs("div",{className:"error-message",children:["âŒ ",u]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:i,children:i?"â³ Enviando...":"ğŸ“§ Enviar Email de RecuperaÃ§Ã£o"}),e.jsxs("div",{className:"info-box",children:[e.jsxs("p",{children:["ğŸ“Œ ",e.jsx("strong",{children:"Como funciona:"})]}),e.jsxs("ol",{children:[e.jsx("li",{children:"Digite seu email cadastrado"}),e.jsx("li",{children:"VocÃª receberÃ¡ um link de recuperaÃ§Ã£o"}),e.jsx("li",{children:"Clique no link e defina uma nova senha"}),e.jsx("li",{children:"Pronto! FaÃ§a login com a nova senha"})]})]})]}),e.jsxs("div",{className:"login-links",children:[e.jsx(g,{to:"/login",className:"back-link",children:"â† Voltar para o login"}),e.jsx(g,{to:"/cadastro",className:"signup-link",children:"NÃ£o tem conta? Cadastre-se"})]})]})]})}export{U as default};
