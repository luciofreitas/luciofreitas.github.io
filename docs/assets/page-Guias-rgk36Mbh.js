import{r as j,j as a,u as C,A}from"./index-Dmdn6vl_.js";import{M as G}from"./index.esm-D9jB1jEF.js";import{o as w}from"./glossarioData-8VebtgBN.js";import{u as z}from"./useAvaliacoes-D6vyIP9c.js";import{g as v}from"./guiasService-DAw1oR7r.js";const b=({guiaId:t,mediaAtual:i,totalVotos:g,votosUsuario:m,onAvaliar:x,somenteLeitura:c=!1})=>{const[d,n]=j.useState(0),u=m[t]!==void 0,p=r=>{if(console.debug("[ComponenteEstrelas] click",{guiaId:t,estrela:r,somenteLeitura:c,jaVotou:u}),!c)try{x(t,r)}catch(s){console.warn("[ComponenteEstrelas] onAvaliar threw",s)}},N=r=>{const s=r<=(d||i),e=u?r<=m[t]?"#FFAB00":"#d1d5db":s?"#FFAB00":"#d1d5db";return a.jsx("button",{type:"button","aria-label":`${r} ${r===1?"estrela":"estrelas"}`,className:`estrela ${!c&&!u?"estrela-interativa":""}`,style:{color:e,fontSize:"1.2rem"},onClick:()=>p(r),onMouseEnter:()=>!c&&!u&&n(r),onMouseLeave:()=>!c&&!u&&n(0),children:"‚òÖ"},r)};return a.jsxs("div",{className:"sistema-avaliacao",children:[a.jsx("div",{className:"estrelas-container",children:[1,2,3,4,5].map(N)}),a.jsxs("div",{className:"avaliacao-info",children:[a.jsx("span",{className:"media-nota",children:i.toFixed(1)}),a.jsxs("span",{className:"total-votos",children:["(",g," avalia√ß√£o",g!==1?"√µes":"",")"]})]}),u&&a.jsxs("div",{className:"voto-confirmado",children:["Sua avalia√ß√£o: ",m[t]," ‚òÖ"]})]})};function P(){const t=C(),{usuarioLogado:i}=j.useContext(A)||{},{avaliacoes:g,votosUsuario:m,avaliarGuia:x}=z(i?.email),[c,d]=j.useState([]),n=!!(i&&i.isPro||localStorage.getItem("versaoProAtiva")==="true");j.useEffect(()=>{let s=!0;return(async()=>{try{const e=await v.getVisibleGuias(i?.email);s&&d(e||[])}catch(e){console.error("Erro ao carregar guias vis√≠veis:",e),s&&d([])}})(),()=>{s=!1}},[i]);const p=[{id:"glossario-automotivo",titulo:"Luzes do Painel",subtitulo:"Entenda os avisos do seu ve√≠culo",descricao:"Aprenda sobre as luzes de aviso do painel e o que fazer quando elas acendem.",icone:"‚ö†Ô∏è",categoria:"Diagn√≥stico",rota:"/luzes-do-painel"},...w],N=(s,e)=>{if(!i?.email){alert("Fa√ßa login para avaliar guias");return}try{x(s,e)}catch(o){console.warn("avaliarGuia hook failed:",o)}(async()=>{try{const o=await v.addRating(s,i.email,e);d(l=>l.map(h=>h.id===s?{...h,...o||{}}:h))}catch(o){console.warn("guiaService.addRating failed:",o)}})(),(async()=>{try{const o=await v.getVisibleGuias(i?.email);d(o||[])}catch(o){console.error("Erro ao recarregar guias ap√≥s avalia√ß√£o:",o)}})(),d(o=>o.map(l=>{if(l.id!==s||(l.ratings||[]).some(E=>E.userEmail===i.email))return l;const f={userEmail:i.email,rating:e,timestamp:new Date().toISOString()};return{...l,ratings:[...l.ratings||[],f]}}))},r=s=>{v.incrementViews(s),t(`/guia/${s}`)};return a.jsxs(a.Fragment,{children:[a.jsx(G,{}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsxs("div",{className:"page-content",children:[a.jsx("h2",{className:"page-title",children:"Guias"}),a.jsx("div",{className:"guias-intro-wrapper",children:a.jsx("div",{className:"guias-intro",children:a.jsx("p",{children:"Encontre guias completos sobre manuten√ß√£o, diagn√≥stico, pe√ßas e tudo relacionado ao seu ve√≠culo."})})}),!n&&a.jsxs("div",{className:"guias-pro-notice",children:[a.jsx("div",{className:"pro-notice-icon",children:"‚≠ê"}),a.jsxs("div",{className:"pro-notice-content",children:[a.jsx("h3",{children:"Crie seus pr√≥prios guias!"}),a.jsxs("p",{children:["Assinantes ",a.jsx("strong",{children:"Pro"})," podem ",a.jsx("span",{className:"highlight-orange",children:"criar"})," e ",a.jsx("span",{className:"highlight-orange",children:"compartilhar"})," guias customizados com a comunidade.",a.jsx("a",{className:"btn-seja-pro-inline",href:"#/versao-pro",children:"Vers√£o Pro ‚Üí"})]})]})]}),n&&a.jsx("div",{className:"criar-guia-section",children:a.jsx("button",{className:"btn-criar-guia",onClick:()=>t("/criar-guia"),children:"‚úèÔ∏è Criar Novo Guia"})}),a.jsx("h3",{className:"section-title",children:"üìñ Guias Oficiais"}),a.jsx("div",{className:"guias-grid",children:p.map(s=>a.jsxs("div",{className:"guia-card",children:[a.jsxs("div",{className:"guia-header",children:[a.jsx("div",{className:"guia-icone",children:s.icone}),a.jsx("div",{className:"guia-categoria",children:s.categoria})]}),a.jsxs("div",{className:"guia-content",children:[a.jsx("h3",{className:"guia-titulo",children:s.titulo}),a.jsx("p",{className:"guia-subtitulo",children:s.subtitulo}),a.jsx("div",{className:"guia-avaliacao",children:a.jsx(b,{guiaId:s.id,mediaAtual:g[s.id]?.media||0,totalVotos:g[s.id]?.total||0,votosUsuario:m,onAvaliar:x})})]}),a.jsx("div",{className:"guia-footer",children:a.jsx("span",{className:"guia-cta",onClick:()=>t(s.rota),children:"Ver guia completo ‚Üí"})})]},s.id))}),a.jsx("h3",{className:"section-title",children:"ÔøΩ Guias da Comunidade"}),c.length>0?a.jsx("div",{className:"guias-grid",children:c.map(s=>{const e=i?.email===s.autorEmail;v.calculateAverageRating(s);const o=s.status==="oculto";return a.jsxs("div",{className:`guia-card ${o?"guia-oculto":""} ${!n&&!e?"locked":""}`,children:[a.jsxs("div",{className:"guia-header",children:[a.jsx("div",{className:"guia-icone",children:"üìÑ"}),a.jsx("div",{className:"guia-categoria",children:s.categoria}),e&&a.jsx("div",{className:"guia-author-badge",title:"Voc√™ √© o autor deste guia",children:"üë§ Seu Guia"})]}),s.imagem&&a.jsx("div",{className:"guia-imagem",children:a.jsx("img",{src:s.imagem,alt:s.titulo})}),a.jsxs("div",{className:"guia-content",children:[a.jsx("h3",{className:"guia-titulo",children:s.titulo}),o&&e&&a.jsx("div",{className:"guia-status-warning",children:"‚ö†Ô∏è Este guia est√° oculto devido a avalia√ß√µes baixas. Edite-o para melhorar!"}),a.jsxs("div",{className:"guia-avaliacao",children:[(()=>{const l=v.getGuiaStats(s);return a.jsx(b,{guiaId:s.id,mediaAtual:Number((l.averageRating||0).toFixed(1)),totalVotos:l.totalRatings,votosUsuario:m,onAvaliar:(h,f)=>N(h,f),somenteLeitura:e||!i})})(),s.views>0&&a.jsxs("span",{className:"guia-views",children:["üëÅÔ∏è ",s.views," visualiza√ß√µes"]})]})]}),a.jsxs("div",{className:"guia-footer",children:[e&&a.jsx("button",{className:"btn-editar-guia",onClick:()=>t(`/criar-guia/${s.id}`),children:"‚úèÔ∏è Editar"}),!n&&!e?a.jsx("div",{className:"guia-locked-wrapper",children:a.jsx("button",{className:"btn-locked",onClick:()=>t("/versao-pro"),children:"üîí Somente Pro ‚Äî Assine para abrir"})}):a.jsx("span",{className:"guia-cta",onClick:()=>r(s.id),children:"Ver guia completo ‚Üí"})]})]},s.id)})}):a.jsxs("p",{className:"guias-empty-message",children:["Nenhum guia da comunidade criado ainda. ",n?"Seja o primeiro!":"Seja Pro para criar o primeiro guia!"]}),a.jsx("div",{className:"guias-footer",children:a.jsxs("div",{className:"info-section",children:[a.jsx("h3",{children:"üí° Dica"}),a.jsx("p",{children:"Nossos guias s√£o atualizados regularmente com as melhores pr√°ticas e informa√ß√µes mais recentes do setor automotivo. Marque esta p√°gina nos favoritos para consultar sempre que precisar!"})]})})]})})]})}export{P as default};
