import{r,A as M,j as e,M as k}from"./index-UH5wqYcE.js";import{M as I}from"./index.esm-DpjhGyRm.js";function E(){const{usuarioLogado:t}=r.useContext(M)||{},[n,x]=r.useState([]),[h,g]=r.useState([]),[N,c]=r.useState(!1),[d,p]=r.useState(null),[u,f]=r.useState("todos"),[i,a]=r.useState({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""});r.useEffect(()=>{if(t){const s=localStorage.getItem(`manutencoes_${t.email}`),o=localStorage.getItem(`carros_${t.email}`);s&&x(JSON.parse(s)),o&&g(JSON.parse(o))}},[t]);const m=s=>{t&&(localStorage.setItem(`manutencoes_${t.email}`,JSON.stringify(s)),x(s))},b=s=>{if(s.preventDefault(),d){const o=n.map(l=>l.id===d?{...i,id:d}:l);m(o)}else{const o={...i,id:Date.now().toString()};m([...n,o])}v(),c(!1)},C=s=>{a(s),p(s.id),c(!0)},S=s=>{if(window.confirm("Tem certeza que deseja excluir este registro?")){const o=n.filter(l=>l.id!==s);m(o)}},v=()=>{a({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),p(null)},F=s=>{const o=h.find(l=>l.id===s);return o?`${o.marca} ${o.modelo} (${o.ano})`:"Veículo não encontrado"},j=[...u==="todos"?n:n.filter(s=>s.veiculoId===u)].sort((s,o)=>new Date(o.data)-new Date(s.data));return t?e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Histórico de Manutenção"}),e.jsx("div",{className:"historico-intro",children:e.jsx("p",{children:"Mantenha um registro completo de todas as manutenções, trocas de peças e serviços realizados nos seus veículos. Esse histórico digital facilita o acompanhamento de revisões periódicas e aumenta o valor de revenda."})}),h.length===0?e.jsxs("div",{className:"historico-no-cars",children:[e.jsx("p",{children:"Você ainda não possui veículos cadastrados."}),e.jsx("a",{href:"/meus-carros",className:"historico-add-car-btn",children:"Cadastrar Veículo"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historico-actions",children:[e.jsxs("div",{className:"historico-filters",children:[e.jsx("label",{htmlFor:"filtro-veiculo",children:"Filtrar por veículo:"}),e.jsxs("select",{id:"filtro-veiculo",value:u,onChange:s=>f(s.target.value),className:"historico-select",children:[e.jsx("option",{value:"todos",children:"Todos os veículos"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.marca," ",s.modelo," (",s.ano,")"]},s.id))]})]}),e.jsx("button",{className:"historico-add-btn",onClick:()=>{v(),c(!0)},children:"+ Nova Manutenção"})]}),j.length===0?e.jsxs("div",{className:"historico-empty",children:[e.jsx("p",{children:"Nenhuma manutenção registrada ainda."}),e.jsx("p",{children:'Clique em "Nova Manutenção" para começar.'})]}):e.jsx("div",{className:"historico-list",children:j.map(s=>e.jsxs("div",{className:"historico-card",children:[e.jsxs("div",{className:"historico-card-header",children:[e.jsx("div",{className:"historico-card-veiculo",children:F(s.veiculoId)}),e.jsx("div",{className:"historico-card-data",children:new Date(s.data).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"historico-card-body",children:[e.jsx("div",{className:"historico-card-tipo",children:e.jsx("span",{className:`historico-tipo-badge ${s.tipo}`,children:s.tipo==="preventiva"?"Preventiva":s.tipo==="corretiva"?"Corretiva":"Outro"})}),e.jsxs("div",{className:"historico-card-descricao",children:[e.jsx("strong",{children:"Descrição:"})," ",s.descricao]}),s.kmAtual&&e.jsxs("div",{className:"historico-card-km",children:[e.jsx("strong",{children:"Quilometragem:"})," ",parseInt(s.kmAtual).toLocaleString("pt-BR")," km"]}),s.oficina&&e.jsxs("div",{className:"historico-card-oficina",children:[e.jsx("strong",{children:"Oficina:"})," ",s.oficina]}),s.valor&&e.jsxs("div",{className:"historico-card-valor",children:[e.jsx("strong",{children:"Valor:"})," R$ ",parseFloat(s.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),s.observacoes&&e.jsxs("div",{className:"historico-card-obs",children:[e.jsx("strong",{children:"Observações:"})," ",s.observacoes]})]}),e.jsxs("div",{className:"historico-card-actions",children:[e.jsx("button",{className:"historico-edit-btn",onClick:()=>C(s),children:"Editar"}),e.jsx("button",{className:"historico-delete-btn",onClick:()=>S(s.id),children:"Excluir"})]})]},s.id))})]}),N&&e.jsx("div",{className:"historico-modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"historico-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"historico-modal-header",children:[e.jsx("h3",{children:d?"Editar Manutenção":"Nova Manutenção"}),e.jsx("button",{className:"historico-modal-close",onClick:()=>c(!1),children:"×"})]}),e.jsxs("form",{onSubmit:b,className:"historico-form",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"veiculoId",children:"Veículo *"}),e.jsxs("select",{id:"veiculoId",value:i.veiculoId,onChange:s=>a({...i,veiculoId:s.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"",children:"Selecione um veículo"}),h.map(s=>e.jsxs("option",{value:s.id,children:[s.marca," ",s.modelo," (",s.ano,")"]},s.id))]})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"data",children:"Data *"}),e.jsx("input",{type:"date",id:"data",value:i.data,onChange:s=>a({...i,data:s.target.value}),required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",value:i.tipo,onChange:s=>a({...i,tipo:s.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"preventiva",children:"Preventiva"}),e.jsx("option",{value:"corretiva",children:"Corretiva"}),e.jsx("option",{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"descricao",children:"Descrição *"}),e.jsx("input",{type:"text",id:"descricao",value:i.descricao,onChange:s=>a({...i,descricao:s.target.value}),placeholder:"Ex: Troca de óleo e filtro",required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"kmAtual",children:"Quilometragem"}),e.jsx("input",{type:"number",id:"kmAtual",value:i.kmAtual,onChange:s=>a({...i,kmAtual:s.target.value}),placeholder:"Ex: 50000",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"valor",children:"Valor (R$)"}),e.jsx("input",{type:"number",step:"0.01",id:"valor",value:i.valor,onChange:s=>a({...i,valor:s.target.value}),placeholder:"Ex: 150.00",className:"historico-input"})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"oficina",children:"Oficina/Local"}),e.jsx("input",{type:"text",id:"oficina",value:i.oficina,onChange:s=>a({...i,oficina:s.target.value}),placeholder:"Ex: Auto Center XYZ",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"observacoes",children:"Observações"}),e.jsx("textarea",{id:"observacoes",value:i.observacoes,onChange:s=>a({...i,observacoes:s.target.value}),placeholder:"Informações adicionais sobre a manutenção",rows:"3",className:"historico-textarea"})]}),e.jsxs("div",{className:"historico-form-actions",children:[e.jsx("button",{type:"button",className:"historico-cancel-btn",onClick:()=>{v(),c(!1)},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"historico-save-btn",children:d?"Salvar Alterações":"Adicionar Manutenção"})]})]})]})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Histórico de Manutenção"}),e.jsxs("div",{className:"historico-login-required",children:[e.jsx("p",{children:"Você precisa estar logado para acessar o histórico de manutenção."}),e.jsx("a",{href:"/login",className:"historico-login-btn",children:"Fazer Login"})]})]})})]})}export{E as default};
