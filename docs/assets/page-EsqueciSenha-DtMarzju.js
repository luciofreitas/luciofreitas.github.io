import{r as i,j as e,M as g,L as x,s as j}from"./index-gCNHD5Pg.js";import{E as N}from"./emailService-BPoDMqL0.js";function w(){const[s,d]=i.useState(""),[r,n]=i.useState(!1),[p,o]=i.useState(""),[m,l]=i.useState(""),[v,u]=i.useState(!1),f=async c=>{c.preventDefault(),n(!0),l(""),o("");try{const{data:a,error:E}=await j.from("users").select("id, nome, email").eq("email",s.toLowerCase().trim()).single();if(E||!a){l("Email nÃ£o encontrado. Verifique e tente novamente."),n(!1);return}const{error:h}=await j.auth.resetPasswordForEmail(s,{redirectTo:`${window.location.origin}/#/redefinir-senha`});if(h)throw h;try{const t=`${window.location.origin}/#/redefinir-senha`;await N.sendPasswordResetEmail({nome:a.nome,email:a.email,userId:a.id,resetLink:t})}catch(t){console.warn("Aviso: Email personalizado nÃ£o enviado, mas email padrÃ£o do Supabase foi enviado.",t)}u(!0),o(`âœ… Email de recuperaÃ§Ã£o enviado para ${s}. Verifique sua caixa de entrada e spam.`)}catch(a){console.error("Erro ao solicitar recuperaÃ§Ã£o de senha:",a),l("Erro ao enviar email de recuperaÃ§Ã£o. Tente novamente mais tarde.")}finally{n(!1)}};return e.jsxs("div",{className:"page-wrapper",children:[e.jsx(g,{}),e.jsx("div",{className:"esqueci-senha-container",children:e.jsxs("div",{className:"esqueci-senha-card",children:[e.jsxs("div",{className:"esqueci-senha-header",children:[e.jsx("h1",{children:"ğŸ” Esqueci minha senha"}),e.jsx("p",{children:"NÃ£o se preocupe! Vamos te ajudar a recuperar o acesso Ã  sua conta."})]}),v?e.jsxs("div",{className:"success-container",children:[e.jsx("div",{className:"success-message",children:p}),e.jsxs("div",{className:"success-info",children:[e.jsx("h3",{children:"ğŸ“¬ PrÃ³ximos passos:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:["âœ… Verifique sua caixa de entrada em ",e.jsx("strong",{children:s})]}),e.jsx("li",{children:"âœ… Procure por email da Garagem Smart"}),e.jsxs("li",{children:["âœ… Se nÃ£o encontrar, verifique a pasta de ",e.jsx("strong",{children:"SPAM"})]}),e.jsx("li",{children:"âœ… Clique no link de recuperaÃ§Ã£o"}),e.jsx("li",{children:"âœ… Defina sua nova senha"})]})]}),e.jsx("button",{onClick:()=>{u(!1),d(""),o("")},className:"resend-btn",children:"ğŸ“§ Reenviar email"})]}):e.jsxs("form",{onSubmit:f,className:"esqueci-senha-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email cadastrado:"}),e.jsx("input",{type:"email",id:"email",value:s,onChange:c=>d(c.target.value),placeholder:"seuemail@exemplo.com",required:!0,disabled:r,className:"input-field"})]}),m&&e.jsxs("div",{className:"error-message",children:["âŒ ",m]}),e.jsx("button",{type:"submit",className:"submit-btn",disabled:r,children:r?"â³ Enviando...":"ğŸ“§ Enviar Email de RecuperaÃ§Ã£o"}),e.jsxs("div",{className:"info-box",children:[e.jsxs("p",{children:["ğŸ“Œ ",e.jsx("strong",{children:"Como funciona:"})]}),e.jsxs("ol",{children:[e.jsx("li",{children:"Digite seu email cadastrado"}),e.jsx("li",{children:"VocÃª receberÃ¡ um link de recuperaÃ§Ã£o"}),e.jsx("li",{children:"Clique no link e defina uma nova senha"}),e.jsx("li",{children:"Pronto! FaÃ§a login com a nova senha"})]})]})]}),e.jsxs("div",{className:"login-links",children:[e.jsx(x,{to:"/login",className:"back-link",children:"â† Voltar para o login"}),e.jsx(x,{to:"/cadastro",className:"signup-link",children:"NÃ£o tem conta? Cadastre-se"})]})]})})]})}export{w as default};
