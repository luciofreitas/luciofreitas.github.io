import{r as t,c as Ee,j as e,A as te,u as Pe,M as Fe}from"./index-DbidQ0J6.js";import{a as se}from"./apiService-DRkEcca-.js";import{M as $e}from"./index.esm-BUVno2-Q.js";import{g as Be}from"./carService-Due04Svz.js";import"./glossarioData-8VebtgBN.js";function De({anchorRef:u,children:r,visible:p}){const a=t.useRef(null),[b,d]=t.useState({top:0,left:0});return t.useEffect(()=>{if(!p)return;function x(){const N=u&&u.current,c=a.current;if(!N||!c)return;const g=N.getBoundingClientRect(),i=c.getBoundingClientRect();let w=g.top-i.height-8,S=g.left+g.width/2-i.width/2;const l=8;S<l&&(S=l),S+i.width>window.innerWidth-l&&(S=window.innerWidth-i.width-l),w<l&&(w=g.bottom+8),d({top:w,left:S})}x(),window.addEventListener("resize",x),window.addEventListener("scroll",x,!0);let n;return typeof window.ResizeObserver<"u"&&(n=new window.ResizeObserver(x),n.observe(document.body)),()=>{window.removeEventListener("resize",x),window.removeEventListener("scroll",x,!0),n&&n.disconnect()}},[p,u]),p?Ee.createPortal(e.jsx("div",{ref:a,className:"whatsapp-portal-tooltip-text",role:"status","aria-hidden":!p,style:{position:"fixed",top:b.top,left:b.left},children:r}),document.body):null}function Re({vehicle:u,isPro:r}){const p=`https://api.whatsapp.com/send?text=${encodeURIComponent("OlÃ¡, tenho interesse na peÃ§a para: "+(u||""))}`,a=t.useRef(null),[b,d]=t.useState(!1),x=()=>d(!0),n=()=>d(!1);return e.jsxs("div",{className:"whatsapp-button-container",children:[e.jsxs("div",{className:"whatsapp-button-wrapper",children:[e.jsx("a",{className:"whatsapp-button",href:p,target:"_blank",rel:"noopener noreferrer","aria-label":`Contato via WhatsApp: ${u||""}`,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M20.52 3.48A11.94 11.94 0 0012 0C5.37 0 0 5.37 0 12c0 2.11.55 4.09 1.52 5.83L0 24l6.39-1.65A11.95 11.95 0 0012 24c6.63 0 12-5.37 12-12 0-3.2-1.24-6.18-3.48-8.52zM12 21.5c-1.2 0-2.38-.26-3.44-.75l-.25-.11-3.79.98.97-3.06-.17-.27A9.5 9.5 0 0112 3.5c5.25 0 9.5 4.25 9.5 9.5S17.25 22.5 12 22.5z"}),e.jsx("path",{d:"M17.06 14.34c-.31-.16-1.83-.9-2.11-1-.28-.11-.48-.16-.68.16s-.78 1-.95 1.19c-.17.19-.34.21-.66.07a6.77 6.77 0 01-2-1.23 7.02 7.02 0 01-1.28-1.58c-.13-.22 0-.34.09-.45.09-.09.2-.21.3-.32.1-.11.13-.19.2-.32.07-.13.04-.24-.02-.35-.07-.11-.68-1.64-.93-2.24-.24-.59-.48-.51-.66-.52l-.56-.01c-.18 0-.47.07-.72.35s-.94.92-.94 2.24.96 2.6 1.09 2.78c.13.19 1.87 2.86 4.53 3.9 2.66 1.04 2.66.69 3.14.65.48-.04 1.83-.74 2.09-1.45.26-.71.26-1.32.18-1.45-.08-.13-.28-.19-.59-.35z",fill:"#fff"})]})}),!r&&e.jsx("div",{className:"whatsapp-button-blur"})]}),!r&&e.jsxs("div",{className:"whatsapp-tooltip",onMouseEnter:x,onMouseLeave:n,children:[e.jsx("div",{className:"whatsapp-tooltip-icon",ref:a,onFocus:x,onBlur:n,tabIndex:0,children:e.jsx("img",{src:"/imagens/padlock.png",alt:"Cadeado",className:"whatsapp-padlock"})}),e.jsx(De,{anchorRef:a,visible:b,children:"Seja Pro, para liberar o contato da oficina"})]})]})}function Te({applications:u,usuarioLogado:r}){const p=!!(r&&r.isPro||localStorage.getItem("versaoProAtiva")==="true");return e.jsxs("div",{className:"compatibility-grid",children:[e.jsxs("div",{className:"compatibility-grid-header",children:[e.jsx("div",{className:"compatibility-header-vehicle",children:e.jsx("strong",{children:"Carro"})}),e.jsx("div",{className:"compatibility-header-years",children:e.jsx("strong",{children:"Anos"})}),e.jsx("div",{className:"compatibility-header-contact",children:e.jsx("strong",{children:"Contato"})})]}),u.map((a,b)=>{let d=[],x="";return typeof a=="string"?((a.match(/\d{4}(?:-\d{4})?/g)||[]).forEach(N=>{if(N.includes("-")){const[c,g]=N.split("-").map(Number);for(let i=c;i<=g;i++)d.push(String(i))}else d.push(N)}),x=a.replace(/\d{4}(-\d{4})?/g,"").replace(/--/g,"").replace(/\(|\)|,/g,"").replace(/-+/g,"").trim()):typeof a=="object"&&(x=a.vehicle||"",d=a.years||[]),e.jsxs("div",{className:"compatibility-grid-row",children:[e.jsx("div",{className:"compatibility-grid-vehicle",children:e.jsx("div",{className:"compatibility-vehicle-text",children:x||"-"})}),e.jsx("div",{className:"compatibility-grid-years",children:e.jsx("div",{className:"compatibility-years-text",children:d.length?d.join(", "):"-"})}),e.jsx("div",{className:"compatibility-grid-contact",children:e.jsx(Re,{vehicle:x,isPro:p})})]},b)})]})}const R=[];function de(u,r){t.useEffect(()=>{const p=r?.current;if(!u||!p)return;const a=document.activeElement;R.push({container:p,prevActive:a});const b=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");function d(){return Array.from(p.querySelectorAll(b)).filter(c=>!!(c.offsetWidth||c.offsetHeight||c.getClientRects().length))}function x(){const c=d();c.length?c[0].focus():(p.hasAttribute("tabindex")||p.setAttribute("tabindex","-1"),p.focus())}function n(){const c=R[R.length-1];return c&&c.container===p}function N(c){if(!n()||c.key!=="Tab")return;const g=d();if(g.length===0){c.preventDefault();return}const i=g[0],w=g[g.length-1];c.shiftKey?(document.activeElement===i||document.activeElement===p)&&(c.preventDefault(),w.focus()):document.activeElement===w&&(c.preventDefault(),i.focus())}return x(),document.addEventListener("keydown",N),()=>{for(let c=R.length-1;c>=0;c--)if(R[c].container===p){const g=R.splice(c,1)[0];try{g.prevActive&&typeof g.prevActive.focus=="function"&&g.prevActive.focus()}catch{}break}document.removeEventListener("keydown",N)}},[u,r])}function We({show:u,onClose:r,title:p,titleIcon:a,children:b}){const d=t.useRef(null);if(de(u,d),t.useEffect(()=>{if(u){const n=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=n}}},[u]),!u)return null;const x=n=>{n.target.classList.contains("modal-overlay")&&r()};return e.jsx("div",{className:"modal-overlay",onClick:x,children:e.jsxs("div",{ref:d,className:"compat-modal",role:"dialog","aria-modal":"true","aria-label":p||"Modal",children:[e.jsxs("div",{className:"app-compat-header",children:[e.jsxs("div",{className:"app-compat-title-wrapper",children:[a&&e.jsx("img",{src:a,alt:"",className:"app-compat-title-icon"}),e.jsx("span",{className:"app-compat-title",children:p})]}),e.jsx("button",{className:"app-compat-close","aria-label":"Fechar",onClick:r,children:"âœ•"})]}),e.jsx("div",{className:"app-compat-body",children:b})]})})}function P({options:u=[],value:r,onChange:p,placeholder:a="",disabled:b=!1}){const[d,x]=t.useState(!1),n=t.useRef(null);t.useEffect(()=>{function i(w){n.current&&!n.current.contains(w.target)&&x(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]);function N(i){p(i),x(!1)}const c=u.find(i=>i.value===r)?.label||"",g=u;return e.jsxs("div",{className:`custom-dropdown${b?" disabled":""}`,ref:n,children:[e.jsxs("button",{className:`dropdown-btn${d?" open":""}`,onClick:()=>!b&&x(!d),disabled:b,type:"button",children:[e.jsx("span",{className:"dropdown-label",children:c||a}),e.jsx("span",{className:"dropdown-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"custom-dropdown-arrow-svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 6 L8 10 L12 6",stroke:"#444",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),d&&e.jsxs("div",{className:"dropdown-menu",children:[g.length===0&&e.jsx("div",{className:"dropdown-item disabled",children:"Nenhum item"}),g.map((i,w)=>e.jsx("div",{className:`dropdown-item${i.value===r?" selected":""}`,onClick:()=>N(i.value),children:i.label},`${i.value}${w}`))]})]})}const _e=({size:u="medium",color:r="primary",text:p=""})=>e.jsxs("div",{className:`loading-spinner-container loading-spinner-${u}`,children:[e.jsxs("div",{className:`loading-spinner loading-spinner-${r}`,children:[e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"})]}),p&&e.jsx("p",{className:"loading-text",children:p})]});function ze({peca:u,onViewCompatibility:r,onViewDetails:p}){const{usuarioLogado:a}=t.useContext(te)||{},b=Pe();return e.jsxs("div",{className:"peca-card",children:[e.jsx("h3",{className:"peca-card-title",children:u.name}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Categoria:"})," ",u.category]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Fabricante:"})," ",u.manufacturer]}),u.specifications&&e.jsxs("div",{className:"peca-card-specs",children:[e.jsx("strong",{children:"EspecificaÃ§Ãµes:"}),Object.entries(u.specifications).map(([d,x])=>e.jsxs("div",{className:"peca-card-spec-item",children:[d,": ",x]},d))]}),e.jsxs("div",{className:"peca-card-actions",children:[e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-compat-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&r(u),disabled:!a,children:"Ver compatibilidade"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para ver a compatibilidade completa desta peÃ§a"})]})]}),e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-details-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&p&&p(u.id),disabled:!a,children:"Ver ficha completa"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para acessar a ficha tÃ©cnica completa desta peÃ§a"})]})]})]}),!a&&e.jsxs("div",{className:"cta-login-box",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Quer acessar todos os detalhes?"})]}),e.jsx("button",{onClick:()=>b("/login"),className:"cta-login-button",children:"Fazer Login / Cadastrar GrÃ¡tis"})]})]})}function Ge({pecas:u,onViewCompatibility:r,onViewDetails:p}){return!u||u.length===0?e.jsx("div",{className:"pecas-grid-empty",children:e.jsx("p",{children:"Nenhuma peÃ§a encontrada para os filtros selecionados."})}):e.jsx("div",{className:"pecas-grid",children:u.map(a=>e.jsx(ze,{peca:a,onViewCompatibility:r,onViewDetails:p},a.id))})}function Ie({isOpen:u,onClose:r,productId:p}){const[a,b]=t.useState(null),[d,x]=t.useState(!1),[n,N]=t.useState("geral"),[c,g]=t.useState(0);t.useEffect(()=>{u&&p&&w(p)},[u,p]);const i=t.useRef(null);de(u,i);const w=async l=>{x(!0);try{const m=await se.getPecaById(l);if(m.error)throw console.error("ProductDetailModal: Error from API:",m.error),new Error(m.error);b(m),g(0)}catch(m){console.error("Erro ao carregar detalhes da peÃ§a:",m),b(null)}finally{x(!1)}},S=l=>{l.target===l.currentTarget&&r()};return u?e.jsx("div",{className:"product-modal-overlay",onClick:S,children:e.jsxs("div",{ref:i,className:"product-modal",role:"dialog","aria-modal":"true","aria-label":a?.nome||"Detalhes da peÃ§a",children:[e.jsxs("div",{className:"product-modal-header",children:[e.jsx("h2",{children:a?.nome||"Carregando..."}),e.jsx("button",{className:"product-modal-close",onClick:r,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),d?e.jsxs("div",{className:"product-modal-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Carregando detalhes da peÃ§a..."})]}):a?e.jsxs("div",{className:"product-modal-content",children:[e.jsxs("div",{className:"product-header-section",children:[e.jsxs("div",{className:"product-images",children:[e.jsx("div",{className:"main-image",children:e.jsx("img",{src:a.imagens?.[c]||"/images/placeholderPart.jpg",alt:a?.nome||"",onError:l=>{l.target.src="/images/placeholderPart.jpg"}})}),a.imagens&&a.imagens.length>1&&e.jsx("div",{className:"image-thumbnails",children:a.imagens.map((l,m)=>e.jsx("img",{src:l,alt:a?.nome?`${a.nome} - ${m+1}`:"",className:c===m?"active":"",onClick:()=>g(m),onError:T=>{T.target.src="/images/placeholderPart.jpg"}},m))})]}),e.jsxs("div",{className:"product-basic-info",children:[a.recall_relacionado&&e.jsxs("div",{className:"recall-alert",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M11 7h2v6h-2zM11 15h2v2h-2z",fill:"currentColor"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Recall Relacionado"}),e.jsx("p",{children:a.recall_detalhes?.descricao}),e.jsxs("small",{children:["Ref: ",a.recall_detalhes?.numero]})]})]}),e.jsxs("div",{className:"product-codes",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fabricante:"})," ",a.fabricante]}),a.codigos?.oem&&e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digos OEM:"})," ",a.codigos.oem.join(", ")]})]}),e.jsxs("div",{className:"installation-info",children:[e.jsxs("div",{className:"install-difficulty",children:[e.jsx("span",{className:"label",children:"Dificuldade:"}),e.jsx("span",{className:`difficulty ${a.instalacao?.dificuldade?.toLowerCase()}`,children:a.instalacao?.dificuldade})]}),e.jsxs("div",{className:"install-time",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2"})]}),a.instalacao?.tempo_estimado_min," min"]})]}),e.jsxs("div",{className:"contact-workshop",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ’¡ Para preÃ§os e disponibilidade:"})}),e.jsx("p",{children:"Consulte nossas oficinas parceiras prÃ³ximas ao seu local"})]})]})]}),e.jsxs("div",{className:"product-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsx("button",{className:n==="geral"?"active":"",onClick:()=>N("geral"),children:"Geral"}),e.jsx("button",{className:n==="especificacoes"?"active":"",onClick:()=>N("especificacoes"),children:"EspecificaÃ§Ãµes"}),e.jsx("button",{className:n==="compatibilidade"?"active":"",onClick:()=>N("compatibilidade"),children:"Compatibilidade"}),e.jsx("button",{className:n==="instalacao"?"active":"",onClick:()=>N("instalacao"),children:"InstalaÃ§Ã£o"}),e.jsx("button",{className:n==="avaliacoes"?"active":"",onClick:()=>N("avaliacoes"),children:"AvaliaÃ§Ãµes"})]}),e.jsxs("div",{className:"tab-content",children:[n==="geral"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Como Adquirir"}),e.jsxs("div",{className:"workshop-info",children:[e.jsx("div",{children:"ðŸª Consulte preÃ§os e disponibilidade com nossas oficinas parceiras"}),e.jsx("div",{children:"ðŸ› ï¸ InstalaÃ§Ã£o profissional disponÃ­vel"}),e.jsx("div",{children:"ï¿½ Garantia conforme polÃ­tica de cada oficina"})]}),a.pecas_relacionadas&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"PeÃ§as Relacionadas"}),e.jsx("div",{className:"related-parts",children:a.pecas_relacionadas.map((l,m)=>e.jsxs("div",{className:"related-part",children:[e.jsx("strong",{children:l.nome}),e.jsx("span",{children:l.relacao})]},m))})]})]}),n==="especificacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"EspecificaÃ§Ãµes TÃ©cnicas"}),e.jsx("div",{className:"specs-grid",children:a.especificacoes_tecnicas&&Object.entries(a.especificacoes_tecnicas).map(([l,m])=>e.jsxs("div",{className:"spec-item",children:[e.jsxs("span",{className:"spec-label",children:[l.replace(/_/g," "),":"]}),e.jsx("span",{className:"spec-value",children:m})]},l))})]}),n==="compatibilidade"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AplicaÃ§Ãµes Detalhadas"}),e.jsx("div",{className:"compatibility-table",children:a.aplicacoes_detalhadas?.map((l,m)=>e.jsxs("div",{className:"compatibility-row",children:[e.jsxs("div",{className:"app-main",children:[e.jsxs("strong",{children:[l.marca," ",l.modelo]}),e.jsxs("span",{children:[l.ano_inicio,"-",l.ano_fim]})]}),e.jsxs("div",{className:"app-details",children:[e.jsxs("span",{children:["Motor: ",l.motor]}),l.observacoes&&e.jsx("small",{children:l.observacoes})]})]},m))})]}),n==="instalacao"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Guia de InstalaÃ§Ã£o"}),e.jsxs("div",{className:"install-guide",children:[e.jsxs("div",{className:"install-requirements",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ferramentas necessÃ¡rias:"})}),e.jsx("ul",{children:a.instalacao?.ferramentas_necessarias?.map((l,m)=>e.jsx("li",{children:l},m))})]}),a.instalacao?.precaucoes&&e.jsxs("div",{className:"install-precautions",children:[e.jsx("div",{children:e.jsx("strong",{children:"âš ï¸ PrecauÃ§Ãµes:"})}),e.jsx("ul",{children:a.instalacao.precaucoes.map((l,m)=>e.jsx("li",{children:l},m))})]})]})]}),n==="avaliacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AvaliaÃ§Ãµes de Clientes"}),e.jsx("div",{className:"reviews",children:a.avaliacoes?.map((l,m)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("strong",{children:l.usuario}),e.jsxs("div",{className:"review-rating",children:["â˜…".repeat(l.nota),"â˜†".repeat(5-l.nota)]}),e.jsx("span",{className:"review-date",children:new Date(l.data).toLocaleDateString("pt-BR")})]}),e.jsx("p",{children:l.texto})]},m))}),a.perguntasFrequentes&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Perguntas Frequentes"}),e.jsx("div",{className:"faq",children:a.perguntasFrequentes.map((l,m)=>e.jsxs("div",{className:"faq-item",children:[e.jsxs("strong",{children:["Q: ",l.pergunta]}),e.jsxs("p",{children:["R: ",l.resposta]})]},m))})]})]})]})]})]}):e.jsx("div",{className:"product-modal-error",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da peÃ§a."})})]})}):null}function qe({selectedGrupo:u,setSelectedGrupo:r,selectedCategoria:p,setSelectedCategoria:a,selectedMarca:b,setSelectedMarca:d,selectedModelo:x,setSelectedModelo:n,selectedAno:N,setSelectedAno:c,selectedFabricante:g,setSelectedFabricante:i,grupos:w,todasPecas:S,marcas:l,modelos:m,anos:T,fabricantes:re,onSearch:J,onClear:z,loading:G,error:W,warningMarca:I,warningModelo:X,warningAno:q,warningFabricante:U,emptyFieldsWarning:F}){const{usuarioLogado:L}=t.useContext(te)||{},[$,O]=t.useState([]),[E,_]=t.useState("");t.useEffect(()=>{(async()=>{if(L){const A=L.id||L.email,D=await Be(A);O(D)}else O([]),_("")})()},[L]);const B=j=>{if(_(j),!j)return;const A=$.find(D=>D.id===j);A&&(d(A.marca),n(A.modelo),c(String(A.ano)))};return e.jsxs("form",{className:"search-form",onSubmit:J,"aria-label":"FormulÃ¡rio de busca de peÃ§as",children:[L&&$.length>0&&e.jsxs("div",{className:"search-form-car-selector",children:[e.jsx("label",{htmlFor:"carro-selecionado",children:"Buscar para um carro especÃ­fico (opcional)"}),e.jsx(P,{options:[{value:"",label:"-- Busca geral (deixar em branco) --"},...$.map(j=>({value:j.id,label:`${j.marca} ${j.modelo} ${j.ano}${j.isDefault?" â­":""}`}))],value:E,onChange:B,placeholder:"Selecione um carro cadastrado"})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"grupo",children:"Grupo"}),e.jsx(P,{options:[{value:"",label:""},...w.map(j=>({value:j,label:j}))],value:u,onChange:r,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"categoria",children:"PeÃ§a"}),e.jsx(P,{options:[{value:"",label:""},...S.map(j=>({value:j,label:j}))],value:p,onChange:a,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"marca",children:"Marca"}),e.jsx(P,{options:[{value:"",label:""},...l.map(j=>({value:j,label:j}))],value:b,onChange:d,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"modelo",children:"Modelo"}),e.jsx(P,{options:[{value:"",label:""},...m.map(j=>({value:j,label:j}))],value:x,onChange:n,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"ano",children:"Ano"}),e.jsx(P,{options:[{value:"",label:""},...T.map(j=>({value:j,label:j}))],value:N,onChange:c,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"fabricante",children:"Fabricante"}),e.jsx(P,{options:[{value:"",label:""},...re.map(j=>({value:j,label:j}))],value:g,onChange:i,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-actions",children:[e.jsxs("div",{className:"search-form-buttons-row",children:[e.jsxs("div",{className:"search-form-buttons",children:[e.jsx("button",{className:"search-form-btn search-form-btn-primary",type:"submit",disabled:G,children:G?e.jsxs("span",{className:"loading-inline",children:[e.jsx(_e,{size:"small",color:"primary"}),"Buscando..."]}):"Buscar"}),e.jsx("button",{type:"button",className:"search-form-btn search-form-btn-secondary",onClick:z,children:"Limpar"})]}),e.jsx("div",{className:"search-form-warnings-container",children:F?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",F]}):I?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",I]}):X?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",X]}):q?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",q]}):U?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",U]}):null})]}),W&&e.jsx("div",{className:"search-form-error",role:"status","aria-live":"polite",children:W})]})]})}function He(){const{usuarioLogado:u}=t.useContext(te)||{},[r,p]=t.useState(""),[a,b]=t.useState(""),[d,x]=t.useState(""),[n,N]=t.useState(""),[c,g]=t.useState(""),[i,w]=t.useState(""),[S,l]=t.useState([]),[m,T]=t.useState([]),[re,J]=t.useState([]),[z,G]=t.useState([]),[W,I]=t.useState([]),[X,q]=t.useState([]),[U,F]=t.useState([]),[L,$]=t.useState(!1),[O,E]=t.useState(""),[_,B]=t.useState(""),[j,A]=t.useState(""),[D,V]=t.useState(""),[me,K]=t.useState(""),[he,Q]=t.useState(""),[ue,H]=t.useState(!1),[ie,oe]=t.useState(""),[pe,Y]=t.useState(null),[fe,ne]=t.useState(!1),[xe,ce]=t.useState(null);t.useEffect(()=>{const o=async()=>{try{const s=await se.getPecasMeta();l(s.grupos||[]),T(s.pecas||[]),J(s.marcas||[]),G(s.modelos||[]),I(s.anos||[]),q(s.fabricantes||[]),s.pecas&&s.pecas.length>0&&F(s.pecas)}catch(s){console.warn("Failed to load metadata:",s&&s.message?s.message:s),E("NÃ£o foi possÃ­vel carregar os dados iniciais. Tente recarregar a pÃ¡gina.")}};o();const f=()=>o();return window.addEventListener("app-refresh",f),()=>window.removeEventListener("app-refresh",f)},[]),t.useEffect(()=>{if(B(""),A(""),V(""),K(""),(r||a||d||n||c||i)&&Q(""),i&&m.length>0){const f=m.filter(s=>(!r||s.category===r)&&(!a||s.name===a)&&s.manufacturer===i);d&&f.length>0&&(f.some(h=>!h.applications||!Array.isArray(h.applications)?!1:h.applications.some(v=>String(v).toLowerCase().includes(d.toLowerCase())))||B(`NÃ£o hÃ¡ peÃ§as do fabricante "${i}" compatÃ­veis com a marca "${d}"`)),n&&f.length>0&&(f.some(h=>!h.applications||!Array.isArray(h.applications)?!1:h.applications.some(v=>String(v).toLowerCase().includes(n.toLowerCase())))||A(`NÃ£o hÃ¡ peÃ§as do fabricante "${i}" compatÃ­veis com o modelo "${n}"`)),c&&f.length>0&&(f.some(h=>!h.applications||!Array.isArray(h.applications)?!1:h.applications.some(v=>String(v).toLowerCase().includes(c)))||V(`NÃ£o hÃ¡ peÃ§as do fabricante "${i}" compatÃ­veis com o ano "${c}"`))}(d||n||c)&&i&&m.filter(s=>{const h=!r||s.category===r,v=!a||s.name===a,y=s.manufacturer===i;return!h||!v||!y||!s.applications||!Array.isArray(s.applications)?!1:s.applications.some(C=>{const k=String(C).toLowerCase(),M=!d||k.includes(d.toLowerCase()),Z=!n||k.includes(n.toLowerCase()),le=!c||k.includes(c);return M&&Z&&le})}).length===0&&!_&&!j&&!D&&K("NÃ£o hÃ¡ peÃ§as que atendam todos os filtros selecionados")},[r,a,i,d,n,c,m]);const je=()=>{if(!m||m.length===0)return[];if(!r||r==="")return Array.from(new Set(m.map(h=>h.name||"").filter(Boolean)));const o=m.filter(s=>s.category?s.category.toLowerCase().trim()===r.toLowerCase().trim():!1);return Array.from(new Set(o.map(s=>s.name||"").filter(Boolean)))},ve=()=>{if(!Array.isArray(m))return[];let o=m;return r&&(o=o.filter(f=>f&&f.category===r)),a&&(o=o.filter(f=>f&&f.name===a)),Array.from(new Set(o.map(f=>f&&f.manufacturer).filter(Boolean)))},ge=()=>{if(!Array.isArray(m))return[];let o=m;r&&(o=o.filter(s=>s&&s.category===r)),a&&(o=o.filter(s=>s&&s.name===a)),i&&(o=o.filter(s=>s&&s.manufacturer===i));const f=new Set;return o.forEach(s=>{s&&s.applications&&Array.isArray(s.applications)&&s.applications.forEach(h=>{const v=String(h).toLowerCase();["ford","chevrolet","volkswagen","fiat","honda","toyota","hyundai","nissan","renault","peugeot","citroÃ«n","bmw","mercedes","audi","volvo","mitsubishi","kia","suzuki","jeep","land rover","jaguar"].forEach(C=>{v.includes(C)&&f.add(C.charAt(0).toUpperCase()+C.slice(1))})})}),Array.from(f)},be=()=>{if(!d)return Array.isArray(z)?z:[];if(!Array.isArray(m))return[];let o=m;r&&(o=o.filter(h=>h&&h.category===r)),a&&(o=o.filter(h=>h&&h.name===a)),i&&(o=o.filter(h=>h&&h.manufacturer===i));const f=new Set,s=d.toLowerCase();return o.forEach(h=>{h&&h.applications&&Array.isArray(h.applications)&&h.applications.forEach(v=>{const y=String(v).toLowerCase();if(y.includes(s)){const C=y.split(" "),k=C.findIndex(M=>M.includes(s));if(k>=0&&k<C.length-1){const M=C[k+1];M&&M.length>1&&f.add(M.charAt(0).toUpperCase()+M.slice(1))}}})}),Array.from(f)},Ne=()=>{if(!d&&!n)return Array.isArray(W)?W:[];if(!Array.isArray(m))return[];let o=m;r&&(o=o.filter(v=>v&&v.category===r)),a&&(o=o.filter(v=>v&&v.name===a)),i&&(o=o.filter(v=>v&&v.manufacturer===i));const f=new Set,s=d?.toLowerCase(),h=n?.toLowerCase();return o.forEach(v=>{v&&v.applications&&Array.isArray(v.applications)&&v.applications.forEach(y=>{const C=String(y).toLowerCase(),k=!s||C.includes(s),M=!h||C.includes(h);if(k&&M){const Z=/\d{4}(?:-\d{4})?/g;(C.match(Z)||[]).forEach(ee=>{if(ee.includes("-")){const[ke,Le]=ee.split("-").map(Number);for(let ae=ke;ae<=Le;ae++)f.add(String(ae))}else f.add(ee)})}})}),Array.from(f).sort()},we=o=>e.jsx("div",{className:"buscarpeca-modal-pecas",children:e.jsx("div",{className:"compat-results-grid",children:e.jsx(Ge,{pecas:o,onViewCompatibility:Se,onViewDetails:ye})})}),ye=o=>{ce(o),ne(!0)},Ce=()=>{ne(!1),ce(null)},Se=o=>{const f=typeof o=="object"&&o?o:U.find(h=>h.id===o);if(oe("Compatibilidade"),!f||!f.applications){console.debug("[BuscarPeca] no applications for peca",f),Y(e.jsx("div",{children:"Nenhuma aplicaÃ§Ã£o encontrada."})),H(!0);return}const s=e.jsx("div",{className:"buscarpeca-compat-wrapper",children:e.jsx(Te,{applications:f.applications,usuarioLogado:u})});Y(s),H(!0)},Ae=async o=>{if(o&&o.preventDefault&&o.preventDefault(),Q(""),!(r||a||d||n||c||i)){Q("Por favor, preencha pelo menos um campo para realizar a busca."),B(""),A(""),V(""),K("");return}$(!0),E("");const s={grupo:r,categoria:a,marca:d,modelo:n,ano:c,fabricante:i};try{const h=await se.filtrarPecas(s);console.log("ðŸ” Filtros aplicados:",s),console.log("ðŸ“¦ Dados retornados da API:",h),console.log("ðŸ“‹ PeÃ§as encontradas:",h.pecas?.length||0);const v=h.pecas||[];if(F(v),v.length===0){const y=[];s.marca&&y.push(`Marca: ${s.marca}`),s.modelo&&y.push(`Modelo: ${s.modelo}`),s.ano&&y.push(`Ano: ${s.ano}`),s.grupo&&y.push(`Grupo: ${s.grupo}`),s.categoria&&y.push(`PeÃ§a: ${s.categoria}`),s.fabricante&&y.push(`Fabricante: ${s.fabricante}`);const C=y.length>0?`Nenhuma peÃ§a encontrada para: ${y.join(", ")}. Tente remover alguns filtros ou buscar por termos mais genÃ©ricos.`:"Nenhuma peÃ§a encontrada para os filtros selecionados.";E(C)}else oe(`Encontradas ${v.length} peÃ§a(s)`),Y(we(v)),H(!0)}catch(h){console.error("âŒ Erro na busca:",h),E(h.message||"Erro ao buscar peÃ§as")}finally{$(!1)}},Me=()=>{p(""),b(""),x(""),N(""),g(""),w(""),F([]),E(""),B(""),A(""),V(""),K(""),Q("")};return e.jsxs(e.Fragment,{children:[u?e.jsx($e,{}):e.jsx(Fe,{}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content buscarpeca-section",children:[e.jsx("h2",{className:"page-title",children:"CatÃ¡logo de PeÃ§as"}),e.jsx("div",{className:"buscarpeca-intro",children:e.jsx("p",{children:"Encontre peÃ§as automotivas compatÃ­veis com seu veÃ­culo. Busque por marca, modelo e ano."})}),e.jsx(qe,{selectedGrupo:r,setSelectedGrupo:p,selectedCategoria:a,setSelectedCategoria:b,selectedMarca:d,setSelectedMarca:x,selectedModelo:n,setSelectedModelo:N,selectedAno:c,setSelectedAno:g,selectedFabricante:i,setSelectedFabricante:w,grupos:S,todasPecas:je(),marcas:ge(),modelos:be(),anos:Ne(),fabricantes:ve(),onSearch:Ae,onClear:Me,loading:L,error:O,warningMarca:_,warningModelo:j,warningAno:D,warningFabricante:me,emptyFieldsWarning:he})]})}),e.jsx(We,{show:ue,onClose:()=>H(!1),title:ie,titleIcon:ie==="Compatibilidade"?"./check.png":null,children:pe}),e.jsx(Ie,{isOpen:fe,onClose:Ce,productId:xe})]})}export{He as default};
