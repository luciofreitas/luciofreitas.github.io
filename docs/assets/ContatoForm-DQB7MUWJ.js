import{u as b,r as l,j as o}from"./index-0KkQOpV4.js";import{E as v}from"./emailService-BNRgp8aK.js";function w({requireAuth:x=!1,user:a=null,initialValues:f={},onRequireLogin:d=null,onSubmit:p=null}){const y=b(),[n,i]=l.useState({nome:"",email:"",mensagem:"",...f}),[u,h]=l.useState(!1),r=l.useRef(null),c=()=>`contato_rascunho_${a&&a.id?a.id:"anon"}`;l.useEffect(()=>{try{const e=localStorage.getItem(c());if(e){const t=JSON.parse(e);t&&typeof t=="object"&&i(m=>({...m,...t}))}}catch(e){console.warn("Failed to restore contato draft",e)}return()=>{r.current&&(clearTimeout(r.current),r.current=null)}},[a]),l.useEffect(()=>{a&&i(e=>({...e,nome:e.nome||a.nome||a.name||"",email:e.email||a.email||""}))},[a]);const g=e=>{const{name:t,value:m}=e.target,s={...n,[t]:m};i(s),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{try{s.nome||s.email||s.mensagem?localStorage.setItem(c(),JSON.stringify(s)):localStorage.removeItem(c())}catch(S){console.warn("Failed to save contato draft",S)}r.current=null},700)};if(x&&!a){const e=()=>{if(typeof d=="function")return d();y("/login")};return o.jsxs("div",{className:"contato-need-login",children:[o.jsx("p",{children:"Faça login para enviar uma mensagem."}),o.jsx("button",{type:"button",className:"contato-login-btn",onClick:e,children:"Entrar"})]})}const E=async e=>{if(e.preventDefault(),!u){h(!0);try{await v.sendContactEmail({nome:n.nome,email:n.email,mensagem:n.mensagem,userId:a?.id||"Visitante"}),typeof p=="function"&&await p(n),i({nome:"",email:"",mensagem:"",...f});try{localStorage.removeItem(c())}catch(t){console.warn("Erro ao limpar rascunho",t)}alert("✅ Mensagem enviada com sucesso! Em breve entraremos em contato."),console.log("✅ Email enviado para: suportegaragemsmart@gmail.com")}catch(t){console.error("❌ Erro ao enviar email:",t);const m=v.getErrorMessage(t);alert(`Falha ao enviar a mensagem. ${m}`)}finally{h(!1)}}};return o.jsxs("form",{className:"contato-form-wrapper",onSubmit:E,children:[o.jsx("input",{name:"nome",className:"contato-input",type:"text",placeholder:"Seu nome",value:n.nome,onChange:g,required:!0}),o.jsx("input",{name:"email",className:"contato-input",type:"email",placeholder:"Seu e-mail",value:n.email,onChange:g,required:!0}),o.jsx("textarea",{name:"mensagem",className:"contato-textarea",placeholder:"Mensagem",rows:6,value:n.mensagem,onChange:g,required:!0}),o.jsx("button",{className:"contato-submit",type:"submit",disabled:u,children:u?"Enviando...":"Enviar Mensagem"})]})}export{w as C};
