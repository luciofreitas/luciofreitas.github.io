import{j as e,r as c,A as ne,u as Pe,M as $e}from"./index-0KkQOpV4.js";import{a as te}from"./apiService-BSYCPAs2.js";import{b as De}from"./index-mue7Az_S.js";import{M as _e}from"./index.esm-r0q3wcqg.js";import{g as Be}from"./carService-CkEnHevU.js";import"./glossarioData-8VebtgBN.js";import"./mlService-W3KBMVll.js";function Re({applications:r,usuarioLogado:m}){return m&&m.isPro||localStorage.getItem("versaoProAtiva"),e.jsxs("div",{className:"compatibility-grid",children:[e.jsxs("div",{className:"compatibility-grid-header",children:[e.jsx("div",{className:"compatibility-header-vehicle",children:e.jsx("strong",{children:"Carro"})}),e.jsx("div",{className:"compatibility-header-years",children:e.jsx("strong",{children:"Anos"})})]}),r.map((u,a)=>{let v=[],l="";return typeof u=="string"?((u.match(/\d{4}(?:-\d{4})?/g)||[]).forEach(t=>{if(t.includes("-")){const[N,d]=t.split("-").map(Number);for(let b=N;b<=d;b++)v.push(String(b))}else v.push(t)}),l=u.replace(/\d{4}(-\d{4})?/g,"").replace(/--/g,"").replace(/\(|\)|,/g,"").replace(/-+/g,"").trim()):typeof u=="object"&&(l=u.vehicle||"",v=u.years||[]),e.jsxs("div",{className:"compatibility-grid-row",children:[e.jsx("div",{className:"compatibility-grid-vehicle",children:e.jsx("div",{className:"compatibility-vehicle-text",children:l||"-"})}),e.jsx("div",{className:"compatibility-grid-years",children:e.jsx("div",{className:"compatibility-years-text",children:v.length?v.join(", "):"-"})})]},a)})]})}const _=[];function he(r,m){c.useEffect(()=>{const u=m?.current;if(!r||!u)return;const a=document.activeElement;_.push({container:u,prevActive:a});const v=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");function l(){return Array.from(u.querySelectorAll(v)).filter(d=>!!(d.offsetWidth||d.offsetHeight||d.getClientRects().length))}function y(){const d=l();d.length?d[0].focus():(u.hasAttribute("tabindex")||u.setAttribute("tabindex","-1"),u.focus())}function t(){const d=_[_.length-1];return d&&d.container===u}function N(d){if(!t()||d.key!=="Tab")return;const b=l();if(b.length===0){d.preventDefault();return}const h=b[0],C=b[b.length-1];d.shiftKey?(document.activeElement===h||document.activeElement===u)&&(d.preventDefault(),C.focus()):document.activeElement===C&&(d.preventDefault(),h.focus())}return y(),document.addEventListener("keydown",N),()=>{for(let d=_.length-1;d>=0;d--)if(_[d].container===u){const b=_.splice(d,1)[0];try{b.prevActive&&typeof b.prevActive.focus=="function"&&b.prevActive.focus()}catch{}break}document.removeEventListener("keydown",N)}},[r,m])}function qe({show:r,onClose:m,title:u,titleIcon:a,children:v}){const l=c.useRef(null);if(he(r,l),c.useEffect(()=>{if(r){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[r]),!r)return null;const y=t=>{t.target.classList.contains("modal-overlay")&&m()};return e.jsx("div",{className:"modal-overlay",onClick:y,children:e.jsxs("div",{ref:l,className:"compat-modal",role:"dialog","aria-modal":"true","aria-label":u||"Modal",children:[e.jsxs("div",{className:"app-compat-header",children:[e.jsxs("div",{className:"app-compat-title-wrapper",children:[a&&e.jsx(De,{className:"app-compat-title-icon",style:{color:"#10b981",fontSize:"1.5rem"}}),e.jsx("span",{className:"app-compat-title",children:u})]}),e.jsx("button",{className:"app-compat-close","aria-label":"Fechar",onClick:m,children:"âœ•"})]}),e.jsx("div",{className:"app-compat-body",children:v})]})})}function $({options:r=[],value:m,onChange:u,placeholder:a="",disabled:v=!1}){const[l,y]=c.useState(!1),t=c.useRef(null);c.useEffect(()=>{function h(C){t.current&&!t.current.contains(C.target)&&y(!1)}return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[]);function N(h){u(h),y(!1)}const d=r.find(h=>h.value===m)?.label||"",b=r;return e.jsxs("div",{className:`custom-dropdown${v?" disabled":""}`,ref:t,children:[e.jsxs("button",{className:`dropdown-btn${l?" open":""}`,onClick:()=>!v&&y(!l),disabled:v,type:"button",children:[e.jsx("span",{className:"dropdown-label",children:d||a}),e.jsx("span",{className:"dropdown-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"custom-dropdown-arrow-svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 6 L8 10 L12 6",stroke:"#444",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),l&&e.jsxs("div",{className:"dropdown-menu",children:[b.length===0&&e.jsx("div",{className:"dropdown-item disabled",children:"Nenhum item"}),b.map((h,C)=>e.jsx("div",{className:`dropdown-item${h.value===m?" selected":""}`,onClick:()=>N(h.value),children:h.label},`${h.value}${C}`))]})]})}const Ge=({size:r="medium",color:m="primary",text:u=""})=>e.jsxs("div",{className:`loading-spinner-container loading-spinner-${r}`,children:[e.jsxs("div",{className:`loading-spinner loading-spinner-${m}`,children:[e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"})]}),u&&e.jsx("p",{className:"loading-text",children:u})]});function Ie({peca:r,onViewCompatibility:m,onViewDetails:u}){const{usuarioLogado:a}=c.useContext(ne)||{},v=Pe(),l=r.ml_product||r.permalink,y=(t,N="BRL")=>t?new Intl.NumberFormat("pt-BR",{style:"currency",currency:N}).format(t):null;return e.jsxs("div",{className:`peca-card ${l?"ml-product":""}`,children:[l&&r.thumbnail&&e.jsxs("div",{className:"peca-card-image",children:[e.jsx("img",{src:r.thumbnail,alt:r.name,loading:"lazy"}),r.shipping?.free_shipping&&e.jsx("span",{className:"free-shipping-badge",children:"Frete GrÃ¡tis"})]}),e.jsx("h3",{className:"peca-card-title",children:r.name}),l&&r.price&&e.jsxs("div",{className:"peca-card-price",children:[e.jsx("span",{className:"price-current",children:y(r.price,r.currency)}),r.original_price&&r.original_price>r.price&&e.jsx("span",{className:"price-original",children:y(r.original_price,r.currency)})]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Categoria:"})," ",r.category]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Fabricante:"})," ",r.manufacturer]}),l&&r.condition&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"CondiÃ§Ã£o:"})," ",r.condition==="new"?"Novo":"Usado"]}),l&&r.available_quantity!==void 0&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"DisponÃ­vel:"})," ",r.available_quantity," unidade(s)",r.sold_quantity>0&&` â€¢ ${r.sold_quantity} vendido(s)`]}),r.specifications&&e.jsxs("div",{className:"peca-card-specs",children:[e.jsx("strong",{children:"EspecificaÃ§Ãµes:"}),Object.entries(r.specifications).map(([t,N])=>e.jsxs("div",{className:"peca-card-spec-item",children:[t,": ",N]},t))]}),e.jsxs("div",{className:"peca-card-actions",children:[l&&r.permalink&&e.jsx("a",{href:r.permalink,target:"_blank",rel:"noopener noreferrer",className:"peca-card-buy-btn ml-btn",children:"ðŸ›’ Comprar no Mercado Livre"}),e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-compat-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&m(r),disabled:!a,children:"Ver compatibilidade"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para ver a compatibilidade completa desta peÃ§a"})]})]}),(!l||a)&&e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-details-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&u&&u(r.id),disabled:!a,children:"Ver ficha completa"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para acessar a ficha tÃ©cnica completa desta peÃ§a"})]})]})]}),!a&&e.jsxs("div",{className:"cta-login-box",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Quer acessar todos os detalhes?"})]}),e.jsx("button",{onClick:()=>v("/login"),className:"cta-login-button",children:"Fazer Login / Cadastrar GrÃ¡tis"})]})]})}function Te({pecas:r,onViewCompatibility:m,onViewDetails:u}){return!r||r.length===0?e.jsx("div",{className:"pecas-grid-empty",children:e.jsx("p",{children:"Nenhuma peÃ§a encontrada para os filtros selecionados."})}):e.jsx("div",{className:"pecas-grid",children:r.map(a=>e.jsx(Ie,{peca:a,onViewCompatibility:m,onViewDetails:u},a.id))})}function We({isOpen:r,onClose:m,productId:u}){const[a,v]=c.useState(null),[l,y]=c.useState(!1),[t,N]=c.useState("geral"),[d,b]=c.useState(0);c.useEffect(()=>{r&&u&&B(u)},[r,u]);const h=c.useRef(null);he(r,h);const C="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'><rect width='100%25' height='100%25' fill='%23f3f4f6'/><text x='50%25' y='50%25' fill='%239ca3af' font-size='24' font-family='Arial' dominant-baseline='middle' text-anchor='middle'>Imagem%20indispon%C3%ADvel</text></svg>",B=async i=>{y(!0);try{const g=await te.getPecaById(i);if(g.error)throw console.error("ProductDetailModal: Error from API:",g.error),new Error(g.error);v(g),b(0)}catch(g){console.error("Erro ao carregar detalhes da peÃ§a:",g),v(null)}finally{y(!1)}},R=i=>{i.target===i.currentTarget&&m()};return r?e.jsx("div",{className:"product-modal-overlay",onClick:R,children:e.jsxs("div",{ref:h,className:"product-modal",role:"dialog","aria-modal":"true","aria-label":a?.nome||"Detalhes da peÃ§a",children:[e.jsxs("div",{className:"product-modal-header",children:[e.jsx("h2",{children:a?.nome||"Carregando..."}),e.jsx("button",{className:"product-modal-close",onClick:m,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),l?e.jsxs("div",{className:"product-modal-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Carregando detalhes da peÃ§a..."})]}):a?e.jsxs("div",{className:"product-modal-content",children:[e.jsxs("div",{className:"product-header-section",children:[e.jsxs("div",{className:"product-images",children:[e.jsx("div",{className:"main-image",children:e.jsx("img",{src:a.imagens?.[d]||C,alt:a?.nome||"",onError:i=>{i.target.src=C}})}),a.imagens&&a.imagens.length>1&&e.jsx("div",{className:"image-thumbnails",children:a.imagens.map((i,g)=>e.jsx("img",{src:i,alt:a?.nome?`${a.nome} - ${g+1}`:"",className:d===g?"active":"",onClick:()=>b(g),onError:I=>{I.target.src=C}},g))})]}),e.jsxs("div",{className:"product-basic-info",children:[a.recall_relacionado&&e.jsxs("div",{className:"recall-alert",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M11 7h2v6h-2zM11 15h2v2h-2z",fill:"currentColor"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Recall Relacionado"}),e.jsx("p",{children:a.recall_detalhes?.descricao}),e.jsxs("small",{children:["Ref: ",a.recall_detalhes?.numero]})]})]}),e.jsxs("div",{className:"product-codes",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fabricante:"})," ",a.fabricante]}),a.codigos?.oem&&e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digos OEM:"})," ",a.codigos.oem.join(", ")]})]}),e.jsxs("div",{className:"installation-info",children:[e.jsxs("div",{className:"install-difficulty",children:[e.jsx("span",{className:"label",children:"Dificuldade:"}),e.jsx("span",{className:`difficulty ${a.instalacao?.dificuldade?.toLowerCase()}`,children:a.instalacao?.dificuldade})]}),e.jsxs("div",{className:"install-time",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2"})]}),a.instalacao?.tempo_estimado_min," min"]})]}),e.jsxs("div",{className:"contact-workshop",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ’¡ Para preÃ§os e disponibilidade:"})}),e.jsx("p",{children:"Consulte nossas oficinas parceiras prÃ³ximas ao seu local"})]})]})]}),e.jsxs("div",{className:"product-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsx("button",{className:t==="geral"?"active":"",onClick:()=>N("geral"),children:"Geral"}),e.jsx("button",{className:t==="especificacoes"?"active":"",onClick:()=>N("especificacoes"),children:"EspecificaÃ§Ãµes"}),e.jsx("button",{className:t==="compatibilidade"?"active":"",onClick:()=>N("compatibilidade"),children:"Compatibilidade"}),e.jsx("button",{className:t==="instalacao"?"active":"",onClick:()=>N("instalacao"),children:"InstalaÃ§Ã£o"}),e.jsx("button",{className:t==="avaliacoes"?"active":"",onClick:()=>N("avaliacoes"),children:"AvaliaÃ§Ãµes"})]}),e.jsxs("div",{className:"tab-content",children:[t==="geral"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Como Adquirir"}),e.jsxs("div",{className:"workshop-info",children:[e.jsx("div",{children:"ðŸª Consulte preÃ§os e disponibilidade com nossas oficinas parceiras"}),e.jsx("div",{children:"ðŸ› ï¸ InstalaÃ§Ã£o profissional disponÃ­vel"}),e.jsx("div",{children:"ï¿½ Garantia conforme polÃ­tica de cada oficina"})]}),a.pecas_relacionadas&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"PeÃ§as Relacionadas"}),e.jsx("div",{className:"related-parts",children:a.pecas_relacionadas.map((i,g)=>e.jsxs("div",{className:"related-part",children:[e.jsx("strong",{children:i.nome}),e.jsx("span",{children:i.relacao})]},g))})]})]}),t==="especificacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"EspecificaÃ§Ãµes TÃ©cnicas"}),e.jsx("div",{className:"specs-grid",children:a.especificacoes_tecnicas&&Object.entries(a.especificacoes_tecnicas).map(([i,g])=>e.jsxs("div",{className:"spec-item",children:[e.jsxs("span",{className:"spec-label",children:[i.replace(/_/g," "),":"]}),e.jsx("span",{className:"spec-value",children:g})]},i))})]}),t==="compatibilidade"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AplicaÃ§Ãµes Detalhadas"}),e.jsx("div",{className:"compatibility-table",children:a.aplicacoes_detalhadas?.map((i,g)=>e.jsxs("div",{className:"compatibility-row",children:[e.jsxs("div",{className:"app-main",children:[e.jsxs("strong",{children:[i.marca," ",i.modelo]}),e.jsxs("span",{children:[i.ano_inicio,"-",i.ano_fim]})]}),e.jsxs("div",{className:"app-details",children:[e.jsxs("span",{children:["Motor: ",i.motor]}),i.observacoes&&e.jsx("small",{children:i.observacoes})]})]},g))})]}),t==="instalacao"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Guia de InstalaÃ§Ã£o"}),e.jsxs("div",{className:"install-guide",children:[e.jsxs("div",{className:"install-requirements",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ferramentas necessÃ¡rias:"})}),e.jsx("ul",{children:a.instalacao?.ferramentas_necessarias?.map((i,g)=>e.jsx("li",{children:i},g))})]}),a.instalacao?.precaucoes&&e.jsxs("div",{className:"install-precautions",children:[e.jsx("div",{children:e.jsx("strong",{children:"âš ï¸ PrecauÃ§Ãµes:"})}),e.jsx("ul",{children:a.instalacao.precaucoes.map((i,g)=>e.jsx("li",{children:i},g))})]})]})]}),t==="avaliacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AvaliaÃ§Ãµes de Clientes"}),e.jsx("div",{className:"reviews",children:a.avaliacoes?.map((i,g)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("strong",{children:i.usuario}),e.jsxs("div",{className:"review-rating",children:["â˜…".repeat(i.nota),"â˜†".repeat(5-i.nota)]}),e.jsx("span",{className:"review-date",children:new Date(i.data).toLocaleDateString("pt-BR")})]}),e.jsx("p",{children:i.texto})]},g))}),a.perguntasFrequentes&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Perguntas Frequentes"}),e.jsx("div",{className:"faq",children:a.perguntasFrequentes.map((i,g)=>e.jsxs("div",{className:"faq-item",children:[e.jsxs("strong",{children:["Q: ",i.pergunta]}),e.jsxs("p",{children:["R: ",i.resposta]})]},g))})]})]})]})]})]}):e.jsx("div",{className:"product-modal-error",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da peÃ§a."})})]})}):null}function ze({selectedGrupo:r,setSelectedGrupo:m,selectedCategoria:u,setSelectedCategoria:a,selectedMarca:v,setSelectedMarca:l,selectedModelo:y,setSelectedModelo:t,selectedAno:N,setSelectedAno:d,selectedFabricante:b,setSelectedFabricante:h,grupos:C,todasPecas:B,marcas:R,modelos:i,anos:g,fabricantes:I,onSearch:Z,onClear:T,loading:W,error:q,warningMarca:z,warningModelo:ee,warningAno:U,warningFabricante:O,emptyFieldsWarning:D,onCarroChange:V}){const{usuarioLogado:k}=c.useContext(ne)||{},[G,L]=c.useState([]),[F,H]=c.useState("");c.useEffect(()=>{(async()=>{if(k){const A=k.id||k.email,E=await Be(A);L(E)}else L([]),H("")})()},[k]);const K=p=>{if(H(p),V&&V(p),!p)return;const A=G.find(E=>E.id===p);A&&(l(A.marca),t(A.modelo),d(String(A.ano)))};return e.jsxs("form",{className:"search-form",onSubmit:Z,"aria-label":"FormulÃ¡rio de busca de peÃ§as",children:[k&&G.length>0&&e.jsxs("div",{className:"search-form-car-selector",children:[e.jsx("label",{htmlFor:"carro-selecionado",children:"Buscar por um carro especÃ­fico (opcional)"}),e.jsx($,{options:[{value:"",label:"-- Busca geral (deixar em branco) --"},...G.map(p=>({value:p.id,label:`${p.marca} ${p.modelo} ${p.ano}${p.isDefault?" â­":""}`}))],value:F,onChange:K,placeholder:"Selecione um carro cadastrado"})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"grupo",children:"Grupo"}),e.jsx($,{options:[{value:"",label:""},...C.map(p=>({value:p,label:p}))],value:r,onChange:m,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"categoria",children:"PeÃ§a"}),e.jsx($,{options:[{value:"",label:""},...B.map(p=>({value:p,label:p}))],value:u,onChange:a,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"marca",children:"Marca"}),e.jsx($,{options:[{value:"",label:""},...R.map(p=>({value:p,label:p}))],value:v,onChange:l,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"modelo",children:"Modelo"}),e.jsx($,{options:[{value:"",label:""},...i.map(p=>({value:p,label:p}))],value:y,onChange:t,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"ano",children:"Ano"}),e.jsx($,{options:[{value:"",label:""},...g.map(p=>({value:p,label:p}))],value:N,onChange:d,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"fabricante",children:"Fabricante"}),e.jsx($,{options:[{value:"",label:""},...I.map(p=>({value:p,label:p}))],value:b,onChange:h,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-actions",children:[e.jsxs("div",{className:"search-form-buttons-row",children:[e.jsxs("div",{className:"search-form-buttons",children:[e.jsx("button",{className:"search-form-btn search-form-btn-primary",type:"submit",disabled:W,children:W?e.jsxs("span",{className:"loading-inline",children:[e.jsx(Ge,{size:"small",color:"primary"}),"Buscando..."]}):"Buscar"}),e.jsx("button",{type:"button",className:"search-form-btn search-form-btn-secondary",onClick:T,children:"Limpar"})]}),e.jsx("div",{className:"search-form-warnings-container",children:D?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",D]}):z?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",z]}):ee?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",ee]}):U?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",U]}):O?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",O]}):null})]}),q&&e.jsx("div",{className:"search-form-error",role:"status","aria-live":"polite",children:q})]})]})}function Ye(){const{usuarioLogado:r}=c.useContext(ne)||{},[m,u]=c.useState(""),[a,v]=c.useState(""),[l,y]=c.useState(""),[t,N]=c.useState(""),[d,b]=c.useState(""),[h,C]=c.useState(""),[B,R]=c.useState([]),[i,g]=c.useState([]),[I,Z]=c.useState([]),[T,W]=c.useState([]),[q,z]=c.useState([]),[ee,U]=c.useState([]),[O,D]=c.useState([]),[V,k]=c.useState(!1),[G,L]=c.useState(""),[F,H]=c.useState(""),[K,p]=c.useState(""),[A,E]=c.useState(""),[oe,Q]=c.useState(""),[ue,J]=c.useState(""),[pe,X]=c.useState(""),[fe,Y]=c.useState(!1),[ce,le]=c.useState(""),[xe,ae]=c.useState(null),[ge,de]=c.useState(!1),[je,me]=c.useState(null);c.useEffect(()=>{const n=async()=>{try{const s=await te.getPecasMeta();R(s.grupos||[]),g(s.pecas||[]),Z(s.marcas||[]),W(s.modelos||[]),z(s.anos||[]),U(s.fabricantes||[]),s.pecas&&s.pecas.length>0&&D(s.pecas)}catch(s){console.warn("Failed to load metadata:",s&&s.message?s.message:s),L("NÃ£o foi possÃ­vel carregar os dados iniciais. Tente recarregar a pÃ¡gina.")}};n();const f=()=>n();return window.addEventListener("app-refresh",f),()=>window.removeEventListener("app-refresh",f)},[]),c.useEffect(()=>{if(p(""),E(""),Q(""),J(""),(m||a||l||t||d||h)&&X(""),h&&i.length>0){const f=i.filter(s=>(!m||s.category===m)&&(!a||s.name===a)&&s.manufacturer===h);l&&f.length>0&&(f.some(o=>!o.applications||!Array.isArray(o.applications)?!1:o.applications.some(x=>String(x).toLowerCase().includes(l.toLowerCase())))||p(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com a marca "${l}"`)),t&&f.length>0&&(f.some(o=>!o.applications||!Array.isArray(o.applications)?!1:o.applications.some(x=>String(x).toLowerCase().includes(t.toLowerCase())))||E(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o modelo "${t}"`)),d&&f.length>0&&(f.some(o=>!o.applications||!Array.isArray(o.applications)?!1:o.applications.some(x=>String(x).toLowerCase().includes(d)))||Q(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o ano "${d}"`))}(l||t||d)&&h&&i.filter(s=>{const o=!m||s.category===m,x=!a||s.name===a,j=s.manufacturer===h;return!o||!x||!j||!s.applications||!Array.isArray(s.applications)?!1:s.applications.some(M=>{const w=String(M).toLowerCase(),P=!l||w.includes(l.toLowerCase()),S=!t||w.includes(t.toLowerCase()),se=!d||w.includes(d);return P&&S&&se})}).length===0&&!K&&!A&&!oe&&J("NÃ£o hÃ¡ peÃ§as que atendam todos os filtros selecionados")},[m,a,h,l,t,d,i]);const ve=()=>{if(!i||i.length===0)return[];if(!m||m==="")return Array.from(new Set(i.map(o=>o.name||"").filter(Boolean)));const n=i.filter(s=>s.category?s.category.toLowerCase().trim()===m.toLowerCase().trim():!1),f=Array.from(new Set(n.map(s=>s.name||"").filter(Boolean)));return F&&a&&!f.includes(a)&&f.push(a),f},be=()=>{if(!Array.isArray(i))return[];let n=i;m&&(n=n.filter(s=>s&&s.category===m)),a&&(n=n.filter(s=>s&&s.name===a));const f=Array.from(new Set(n.map(s=>s&&s.manufacturer).filter(Boolean)));return F&&h&&!f.includes(h)&&f.push(h),f},Ne=()=>{if(!Array.isArray(i))return[];let n=i;m&&(n=n.filter(o=>o&&o.category===m)),a&&(n=n.filter(o=>o&&o.name===a)),h&&(n=n.filter(o=>o&&o.manufacturer===h));const f=new Set;n.forEach(o=>{o&&o.applications&&Array.isArray(o.applications)&&o.applications.forEach(x=>{const j=String(x).toLowerCase();["ford","chevrolet","volkswagen","fiat","honda","toyota","hyundai","nissan","renault","peugeot","citroÃ«n","bmw","mercedes","audi","volvo","mitsubishi","kia","suzuki","jeep","land rover","jaguar"].forEach(w=>{j.includes(w)&&f.add(w.charAt(0).toUpperCase()+w.slice(1))})})});const s=Array.from(f);return F&&l&&!s.includes(l)&&s.push(l),s},ye=()=>{if(!l)return Array.isArray(T)?T:[];if(!Array.isArray(i))return[];let n=i;m&&(n=n.filter(x=>x&&x.category===m)),a&&(n=n.filter(x=>x&&x.name===a)),h&&(n=n.filter(x=>x&&x.manufacturer===h));const f=new Set,s=l.toLowerCase();n.forEach(x=>{x&&x.applications&&Array.isArray(x.applications)&&x.applications.forEach(j=>{const M=String(j).toLowerCase();if(M.includes(s)){const w=M.split(" "),P=w.findIndex(S=>S.includes(s));if(P>=0&&P<w.length-1){const S=w[P+1];S&&S.length>1&&f.add(S.charAt(0).toUpperCase()+S.slice(1))}}})});const o=Array.from(f);return F&&t&&!o.includes(t)&&o.push(t),o},Ce=()=>{if(!l&&!t)return Array.isArray(q)?q:[];if(!Array.isArray(i))return[];let n=i;m&&(n=n.filter(j=>j&&j.category===m)),a&&(n=n.filter(j=>j&&j.name===a)),h&&(n=n.filter(j=>j&&j.manufacturer===h));const f=new Set,s=l?.toLowerCase(),o=t?.toLowerCase();n.forEach(j=>{j&&j.applications&&Array.isArray(j.applications)&&j.applications.forEach(M=>{const w=String(M).toLowerCase(),P=!s||w.includes(s),S=!o||w.includes(o);if(P&&S){const se=/\d{4}(?:-\d{4})?/g;(w.match(se)||[]).forEach(re=>{if(re.includes("-")){const[Ee,Fe]=re.split("-").map(Number);for(let ie=Ee;ie<=Fe;ie++)f.add(String(ie))}else f.add(re)})}})});const x=Array.from(f).sort();return F&&d&&!x.includes(d)&&(x.push(d),x.sort()),x},we=n=>e.jsx("div",{className:"buscarpeca-modal-pecas",children:e.jsx("div",{className:"compat-results-grid",children:e.jsx(Te,{pecas:n,onViewCompatibility:Me,onViewDetails:Se})})}),Se=n=>{me(n),de(!0)},Ae=()=>{de(!1),me(null)},Me=n=>{const f=typeof n=="object"&&n?n:O.find(o=>o.id===n);if(le("Compatibilidade"),!f||!f.applications){console.debug("[BuscarPeca] no applications for peca",f),ae(e.jsx("div",{children:"Nenhuma aplicaÃ§Ã£o encontrada."})),Y(!0);return}const s=e.jsx("div",{className:"buscarpeca-compat-wrapper",children:e.jsx(Re,{applications:f.applications,usuarioLogado:r})});ae(s),Y(!0)},ke=async n=>{if(n&&n.preventDefault&&n.preventDefault(),X(""),!(m||a||l||t||d||h)){X("Por favor, preencha pelo menos um campo para realizar a busca."),p(""),E(""),Q(""),J("");return}k(!0),L("");const s={grupo:m,categoria:a,marca:l,modelo:t,ano:d,fabricante:h};try{const o=await te.buscarPecasML(s);console.log("ðŸ” Filtros aplicados:",s),console.log("ðŸ“¦ Dados retornados:",o),console.log("ðŸ“‹ PeÃ§as encontradas:",o.pecas?.length||0),console.log("ðŸŒ Fonte:",o.source||"local");const x=o.pecas||[];if(x.length===0){const j=[];s.marca&&j.push(`Marca: ${s.marca}`),s.modelo&&j.push(`Modelo: ${s.modelo}`),s.ano&&j.push(`Ano: ${s.ano}`),s.grupo&&j.push(`Grupo: ${s.grupo}`),s.categoria&&j.push(`PeÃ§a: ${s.categoria}`),s.fabricante&&j.push(`Fabricante: ${s.fabricante}`);const M=j.length>0?`Nenhuma peÃ§a encontrada para: ${j.join(", ")}. Tente remover alguns filtros ou buscar por termos mais genÃ©ricos.`:"Nenhuma peÃ§a encontrada para os filtros selecionados.";L(M)}else D(x),le(`Encontradas ${x.length} peÃ§a(s)`),ae(we(x)),Y(!0)}catch(o){console.error("âŒ Erro na busca:",o),L(o.message||"Erro ao buscar peÃ§as")}finally{k(!1)}},Le=()=>{u(""),v(""),y(""),N(""),b(""),C(""),D([]),L(""),p(""),E(""),Q(""),J(""),X("")};return e.jsxs(e.Fragment,{children:[r?e.jsx(_e,{}):e.jsx($e,{}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content buscarpeca-section",children:[e.jsx("h2",{className:"page-title",children:"CatÃ¡logo de PeÃ§as"}),e.jsx("div",{className:"buscarpeca-intro",children:e.jsx("p",{children:"Encontre peÃ§as automotivas compatÃ­veis com seu veÃ­culo. Busque por marca, modelo e ano."})}),e.jsx(ze,{selectedGrupo:m,setSelectedGrupo:u,selectedCategoria:a,setSelectedCategoria:v,selectedMarca:l,setSelectedMarca:y,selectedModelo:t,setSelectedModelo:N,selectedAno:d,setSelectedAno:b,selectedFabricante:h,setSelectedFabricante:C,grupos:B,todasPecas:ve(),marcas:Ne(),modelos:ye(),anos:Ce(),fabricantes:be(),onSearch:ke,onClear:Le,onCarroChange:H,loading:V,error:G,warningMarca:K,warningModelo:A,warningAno:oe,warningFabricante:ue,emptyFieldsWarning:pe})]})}),e.jsx(qe,{show:fe,onClose:()=>Y(!1),title:ce,titleIcon:ce==="Compatibilidade"?"./check.png":null,children:xe}),e.jsx(We,{isOpen:ge,onClose:Ae,productId:je})]})}export{Ye as default};
