import{r as t,u as q,A as T,j as e,a as z}from"./index-puzIFYVu.js";import{M as P}from"./index.esm-DLkgwHqG.js";function H(){const[x,M]=t.useState(""),[l,w]=t.useState(""),[d,A]=t.useState(""),[N,I]=t.useState(""),[D,V]=t.useState(""),[v,j]=t.useState(!1),[O,$]=t.useState(!1),[f,k]=t.useState(""),[u,S]=t.useState(""),[m,C]=t.useState(""),[h,p]=t.useState(""),[g,b]=t.useState(""),y=q(),{usuarioLogado:i,setUsuarioLogado:E}=t.useContext(T)||{};t.useEffect(()=>{i||y("/login",{state:{redirectTo:"/checkin"}})},[i,y]);function R(s){s.preventDefault(),k("");let a=!1;if(x.trim()||(S("Nome é obrigatório."),a=!0),l.replace(/\D/g,"").length<12&&(C("Número de cartão inválido."),a=!0),!/^\d{2}\/\d{2}$/.test(d))p("Validade inválida. Use MM/AA."),a=!0;else{const[c,n]=d.split("/").map(o=>parseInt(o,10));c>=1&&c<=12||(p("Mês inválido."),a=!0)}if(/^\d{3,4}$/.test(N)||(b("CVC inválido."),a=!0),a){k("Revise os campos destacados.");return}j(!0),setTimeout(()=>{j(!1),$(!0);try{const c=JSON.parse(localStorage.getItem("payments")||"[]"),n={id:Date.now(),user:i?i.email||i.nome:"guest",amount:9.9,currency:"BRL",date:new Date().toISOString(),card:"**** **** **** "+l.replace(/\s+/g,"").slice(-4)};c.push(n),localStorage.setItem("payments",JSON.stringify(c))}catch{}if(i&&E){const c=i.id||i.email,n=z(c,1);if(n){const o={...i,isPro:!0,subscription:n};E(o),localStorage.setItem("usuario-logado",JSON.stringify(o)),console.log("✅ Assinatura Pro ativada com sucesso:",n)}}else try{localStorage.setItem("versaoProAtiva","true")}catch{}},1200)}function F(s){M(s),u&&s.trim()&&S("")}function J(s){const a=s.replace(/\D/g,"").slice(0,19),c=(a.match(/\d{1,4}/g)||[]).join(" ");w(c),m&&a.length>=12&&C("")}function L(s){const a=s.replace(/\D/g,"").slice(0,4);let r=a;a.length>=3&&(r=a.slice(0,2)+"/"+a.slice(2)),A(r),h&&/^\d{2}\/\d{2}$/.test(r)&&p("")}function U(s){const a=s.replace(/\D/g,"").slice(0,4);I(a),g&&/^\d{3,4}$/.test(a)&&b("")}return O?e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content",children:[e.jsx("h2",{className:"page-title",children:"Pagamento concluído"}),e.jsx("p",{className:"checkin-success-text",children:"Obrigado — sua assinatura Pro foi ativada (simulado)."}),e.jsxs("p",{className:"checkin-success-text",children:["Você pode retornar à ",e.jsx("a",{href:"/",children:"página inicial"}),"."]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsx("div",{className:"page-content checkin-section",children:e.jsxs("div",{className:"checkin-container",children:[e.jsx("h2",{className:"page-title",children:"Finalizar Assinatura — Versão Pro"}),e.jsx("p",{className:"checkin-intro",children:"R$ 9,90/mês — cancelamento a qualquer momento."}),e.jsxs("form",{onSubmit:R,className:"checkin-form",children:[e.jsxs("label",{className:"checkin-label",children:["Nome no cartão",e.jsx("input",{className:"checkin-input checkin-input",value:x,onChange:s=>F(s.target.value),placeholder:"Nome completo"}),u&&e.jsx("div",{className:"checkin-error",children:u})]}),e.jsxs("label",{className:"checkin-label",children:["Número do cartão",e.jsx("input",{className:"checkin-input checkin-input",value:l,onChange:s=>J(s.target.value),placeholder:"1234 5678 9012 3456",inputMode:"numeric"}),m&&e.jsx("div",{className:"checkin-error",children:m})]}),e.jsxs("div",{className:"checkin-row",children:[e.jsxs("label",{className:"checkin-label checkin-row-item",children:["Validade",e.jsx("input",{className:"checkin-input checkin-input",value:d,onChange:s=>L(s.target.value),placeholder:"MM/AA",inputMode:"numeric"}),h&&e.jsx("div",{className:"checkin-error",children:h})]}),e.jsxs("label",{className:"checkin-label checkin-row-item-small",children:["CVC",e.jsx("input",{className:"checkin-input checkin-input",value:N,onChange:s=>U(s.target.value),placeholder:"123",inputMode:"numeric"}),g&&e.jsx("div",{className:"checkin-error",children:g})]})]}),e.jsxs("label",{className:"checkin-label",children:["Cupom (opcional)",e.jsx("input",{className:"checkin-input checkin-input",value:D,onChange:s=>V(s.target.value),placeholder:"CUPOM"})]}),f&&e.jsx("div",{className:"checkin-error-global",children:f}),e.jsxs("div",{className:"checkin-actions",children:[e.jsx("button",{type:"submit",disabled:v,className:"checkin-btn-primary",children:v?"Processando...":"Pagar R$ 9,90"}),e.jsx("button",{type:"button",onClick:()=>{window.history.back()},className:"checkin-btn-secondary",children:"Voltar"})]}),e.jsx("div",{className:"checkin-note",children:"Este é um formulário de pagamento simulado. Integre seu provedor de pagamentos (Stripe, PayPal, PagSeguro etc.) conforme necessário."})]})]})})})]})}export{H as default};
