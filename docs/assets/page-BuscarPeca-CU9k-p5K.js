import{j as e,r as t,A as ae,u as $e,M as De}from"./index-C9vyc2ME.js";import{a as oe}from"./apiService-BSYCPAs2.js";import{b as _e}from"./index-CTyEQ1Wo.js";import{M as Be}from"./index.esm-HLijuZai.js";import{a as qe}from"./maintenanceService-DOGDJ6m6.js";import{g as ue}from"./carService-B4lSvgg8.js";import"./glossarioData-8VebtgBN.js";import"./mlService-W3KBMVll.js";function Re({applications:s,usuarioLogado:m}){return m&&m.isPro||localStorage.getItem("versaoProAtiva"),e.jsxs("div",{className:"compatibility-grid",children:[e.jsxs("div",{className:"compatibility-grid-header",children:[e.jsx("div",{className:"compatibility-header-vehicle",children:e.jsx("strong",{children:"Carro"})}),e.jsx("div",{className:"compatibility-header-years",children:e.jsx("strong",{children:"Anos"})})]}),s.map((p,c)=>{let r=[],d="";return typeof p=="string"?((p.match(/\d{4}(?:-\d{4})?/g)||[]).forEach(u=>{if(u.includes("-")){const[b,o]=u.split("-").map(Number);for(let N=b;N<=o;N++)r.push(String(N))}else r.push(u)}),d=p.replace(/\d{4}(-\d{4})?/g,"").replace(/--/g,"").replace(/\(|\)|,/g,"").replace(/-+/g,"").trim()):typeof p=="object"&&(d=p.vehicle||"",r=p.years||[]),e.jsxs("div",{className:"compatibility-grid-row",children:[e.jsx("div",{className:"compatibility-grid-vehicle",children:e.jsx("div",{className:"compatibility-vehicle-text",children:d||"-"})}),e.jsx("div",{className:"compatibility-grid-years",children:e.jsx("div",{className:"compatibility-years-text",children:r.length?r.join(", "):"-"})})]},c)})]})}const W=[];function he(s,m){t.useEffect(()=>{const p=m?.current;if(!s||!p)return;const c=document.activeElement;W.push({container:p,prevActive:c});const r=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");function d(){return Array.from(p.querySelectorAll(r)).filter(o=>!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length))}function w(){const o=d();o.length?o[0].focus():(p.hasAttribute("tabindex")||p.setAttribute("tabindex","-1"),p.focus())}function u(){const o=W[W.length-1];return o&&o.container===p}function b(o){if(!u()||o.key!=="Tab")return;const N=d();if(N.length===0){o.preventDefault();return}const h=N[0],C=N[N.length-1];o.shiftKey?(document.activeElement===h||document.activeElement===p)&&(o.preventDefault(),C.focus()):document.activeElement===C&&(o.preventDefault(),h.focus())}return w(),document.addEventListener("keydown",b),()=>{for(let o=W.length-1;o>=0;o--)if(W[o].container===p){const N=W.splice(o,1)[0];try{N.prevActive&&typeof N.prevActive.focus=="function"&&N.prevActive.focus()}catch{}break}document.removeEventListener("keydown",b)}},[s,m])}function Te({show:s,onClose:m,title:p,titleIcon:c,children:r}){const d=t.useRef(null);if(he(s,d),t.useEffect(()=>{if(s){const u=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=u}}},[s]),!s)return null;const w=u=>{u.target.classList.contains("modal-overlay")&&m()};return e.jsx("div",{className:"modal-overlay",onClick:w,children:e.jsxs("div",{ref:d,className:"compat-modal",role:"dialog","aria-modal":"true","aria-label":p||"Modal",children:[e.jsxs("div",{className:"app-compat-header",children:[e.jsxs("div",{className:"app-compat-title-wrapper",children:[c&&e.jsx(_e,{className:"app-compat-title-icon",style:{color:"#10b981",fontSize:"1.5rem"}}),e.jsx("span",{className:"app-compat-title",children:p})]}),e.jsx("button",{className:"app-compat-close","aria-label":"Fechar",onClick:m,children:"âœ•"})]}),e.jsx("div",{className:"app-compat-body",children:r})]})})}function T({options:s=[],value:m,onChange:p,placeholder:c="",disabled:r=!1}){const[d,w]=t.useState(!1),u=t.useRef(null);t.useEffect(()=>{function h(C){u.current&&!u.current.contains(C.target)&&w(!1)}return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[]);function b(h){p(h),w(!1)}const o=s.find(h=>h.value===m)?.label||"",N=s;return e.jsxs("div",{className:`custom-dropdown${r?" disabled":""}`,ref:u,children:[e.jsxs("button",{className:`dropdown-btn${d?" open":""}`,onClick:()=>!r&&w(!d),disabled:r,type:"button",children:[e.jsx("span",{className:"dropdown-label",children:o||c}),e.jsx("span",{className:"dropdown-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"custom-dropdown-arrow-svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 6 L8 10 L12 6",stroke:"#444",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),d&&e.jsxs("div",{className:"dropdown-menu",children:[N.length===0&&e.jsx("div",{className:"dropdown-item disabled",children:"Nenhum item"}),N.map((h,C)=>e.jsx("div",{className:`dropdown-item${h.value===m?" selected":""}`,onClick:()=>b(h.value),children:h.label},`${h.value}${C}`))]})]})}const Ie=({size:s="medium",color:m="primary",text:p=""})=>e.jsxs("div",{className:`loading-spinner-container loading-spinner-${s}`,children:[e.jsxs("div",{className:`loading-spinner loading-spinner-${m}`,children:[e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"})]}),p&&e.jsx("p",{className:"loading-text",children:p})]});function Ge({peca:s,onViewCompatibility:m,onViewDetails:p}){const{usuarioLogado:c}=t.useContext(ae)||{},r=$e(),d=s.ml_product||s.permalink,w=(u,b="BRL")=>u?new Intl.NumberFormat("pt-BR",{style:"currency",currency:b}).format(u):null;return e.jsxs("div",{className:`peca-card ${d?"ml-product":""}`,children:[d&&s.thumbnail&&e.jsxs("div",{className:"peca-card-image",children:[e.jsx("img",{src:s.thumbnail,alt:s.name,loading:"lazy"}),s.shipping?.free_shipping&&e.jsx("span",{className:"free-shipping-badge",children:"Frete GrÃ¡tis"})]}),e.jsx("h3",{className:"peca-card-title",children:s.name}),d&&s.price&&e.jsxs("div",{className:"peca-card-price",children:[e.jsx("span",{className:"price-current",children:w(s.price,s.currency)}),s.original_price&&s.original_price>s.price&&e.jsx("span",{className:"price-original",children:w(s.original_price,s.currency)})]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Categoria:"})," ",s.category]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Fabricante:"})," ",s.manufacturer]}),d&&s.condition&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"CondiÃ§Ã£o:"})," ",s.condition==="new"?"Novo":"Usado"]}),d&&s.available_quantity!==void 0&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"DisponÃ­vel:"})," ",s.available_quantity," unidade(s)",s.sold_quantity>0&&` â€¢ ${s.sold_quantity} vendido(s)`]}),s.specifications&&e.jsxs("div",{className:"peca-card-specs",children:[e.jsx("strong",{children:"EspecificaÃ§Ãµes:"}),Object.entries(s.specifications).map(([u,b])=>e.jsxs("div",{className:"peca-card-spec-item",children:[u,": ",b]},u))]}),e.jsxs("div",{className:"peca-card-actions",children:[d&&s.permalink&&e.jsx("a",{href:s.permalink,target:"_blank",rel:"noopener noreferrer",className:"peca-card-buy-btn ml-btn",children:"ðŸ›’ Comprar no Mercado Livre"}),e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-compat-btn ${c?"":"btn-blocked"}`,onClick:()=>c&&m(s),disabled:!c,children:"Ver compatibilidade"}),!c&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para ver a compatibilidade completa desta peÃ§a"})]})]}),(!d||c)&&e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-details-btn ${c?"":"btn-blocked"}`,onClick:()=>c&&p&&p(s.id),disabled:!c,children:"Ver ficha completa"}),!c&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para acessar a ficha tÃ©cnica completa desta peÃ§a"})]})]})]}),!c&&e.jsxs("div",{className:"cta-login-box",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Quer acessar todos os detalhes?"})]}),e.jsx("button",{onClick:()=>r("/login"),className:"cta-login-button",children:"Fazer Login / Cadastrar GrÃ¡tis"})]})]})}function We({pecas:s,onViewCompatibility:m,onViewDetails:p}){return!s||s.length===0?e.jsx("div",{className:"pecas-grid-empty",children:e.jsx("p",{children:"Nenhuma peÃ§a encontrada para os filtros selecionados."})}):e.jsx("div",{className:"pecas-grid",children:s.map(c=>e.jsx(Ge,{peca:c,onViewCompatibility:m,onViewDetails:p},c.id))})}function ze({isOpen:s,onClose:m,productId:p,selectedCarId:c}){const[r,d]=t.useState(null),[w,u]=t.useState(!1),[b,o]=t.useState("geral"),[N,h]=t.useState(0),[C,I]=t.useState([]),{usuarioLogado:L}=t.useContext(ae)||{};t.useEffect(()=>{s&&p&&O(p)},[s,p]),t.useEffect(()=>{let i=!0;async function f(){try{if(!L)return I([]);const A=L.id||L.email,M=await ue(A);i&&I(Array.isArray(M)?M:[])}catch(A){console.warn("Failed to load user cars for ProductDetailModal",A)}}return s&&f(),()=>{i=!1}},[s,L]);const y=t.useRef(null);he(s,y);const q="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'><rect width='100%25' height='100%25' fill='%23f3f4f6'/><text x='50%25' y='50%25' fill='%239ca3af' font-size='24' font-family='Arial' dominant-baseline='middle' text-anchor='middle'>Imagem%20indispon%C3%ADvel</text></svg>",O=async i=>{u(!0);try{const f=await oe.getPecaById(i);if(f.error)throw console.error("ProductDetailModal: Error from API:",f.error),new Error(f.error);d(f),h(0)}catch(f){console.error("Erro ao carregar detalhes da peÃ§a:",f),d(null)}finally{u(!1)}},z=i=>{i.target===i.currentTarget&&m()};return s?e.jsx("div",{className:"product-modal-overlay",onClick:z,children:e.jsxs("div",{ref:y,className:"product-modal",role:"dialog","aria-modal":"true","aria-label":r?.nome||"Detalhes da peÃ§a",children:[e.jsxs("div",{className:"product-modal-header",children:[e.jsx("h2",{children:r?.nome||"Carregando..."}),e.jsx("div",{className:"product-modal-actions",children:e.jsx("button",{className:"btn product-modal-save",onClick:async()=>{try{const i=L;if(!i){window.showToast&&window.showToast("FaÃ§a login para salvar pesquisas","error",3e3);return}const f=i.id||i.email,A=f&&String(f).trim().toLowerCase();let M=null;c&&(M=C&&C.find(P=>String(P.id)===String(c))||null),M||(M=C&&C.find(P=>P.isDefault)||C&&C[0]||null);const U={veiculoId:M&&M.id||"",data:new Date().toISOString(),tipo:"preventiva",descricao:r?.nome||"",kmAtual:"",oficina:"",valor:"",observacoes:"",meta:{savedFrom:"search",mappedFields:{id:r?.id}}};await qe(A,U),m(),window.showToast&&window.showToast("Pesquisa salva no histÃ³rico","success",2500)}catch(i){console.error("Salvar pesquisa falhou",i),window.showToast&&window.showToast("Erro ao salvar pesquisa","error",3e3)}},"aria-label":"Salvar pesquisa",children:"Salvar pesquisa"})}),e.jsx("button",{className:"product-modal-close",onClick:m,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),w?e.jsxs("div",{className:"product-modal-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Carregando detalhes da peÃ§a..."})]}):r?e.jsxs("div",{className:"product-modal-content",children:[e.jsxs("div",{className:"product-header-section",children:[e.jsxs("div",{className:"product-images",children:[e.jsx("div",{className:"main-image",children:e.jsx("img",{src:r.imagens?.[N]||q,alt:r?.nome||"",onError:i=>{i.target.src=q}})}),r.imagens&&r.imagens.length>1&&e.jsx("div",{className:"image-thumbnails",children:r.imagens.map((i,f)=>e.jsx("img",{src:i,alt:r?.nome?`${r.nome} - ${f+1}`:"",className:N===f?"active":"",onClick:()=>h(f),onError:A=>{A.target.src=q}},f))})]}),e.jsxs("div",{className:"product-basic-info",children:[r.recall_relacionado&&e.jsxs("div",{className:"recall-alert",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M11 7h2v6h-2zM11 15h2v2h-2z",fill:"currentColor"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Recall Relacionado"}),e.jsx("p",{children:r.recall_detalhes?.descricao}),e.jsxs("small",{children:["Ref: ",r.recall_detalhes?.numero]})]})]}),e.jsxs("div",{className:"product-codes",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fabricante:"})," ",r.fabricante]}),r.codigos?.oem&&e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digos OEM:"})," ",r.codigos.oem.join(", ")]})]}),e.jsxs("div",{className:"installation-info",children:[e.jsxs("div",{className:"install-difficulty",children:[e.jsx("span",{className:"label",children:"Dificuldade:"}),e.jsx("span",{className:`difficulty ${r.instalacao?.dificuldade?.toLowerCase()}`,children:r.instalacao?.dificuldade})]}),e.jsxs("div",{className:"install-time",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2"})]}),r.instalacao?.tempo_estimado_min," min"]})]}),e.jsxs("div",{className:"contact-workshop",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ’¡ Para preÃ§os e disponibilidade:"})}),e.jsx("p",{children:"Consulte nossas oficinas parceiras prÃ³ximas ao seu local"})]})]})]}),e.jsxs("div",{className:"product-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsx("button",{className:b==="geral"?"active":"",onClick:()=>o("geral"),children:"Geral"}),e.jsx("button",{className:b==="especificacoes"?"active":"",onClick:()=>o("especificacoes"),children:"EspecificaÃ§Ãµes"}),e.jsx("button",{className:b==="compatibilidade"?"active":"",onClick:()=>o("compatibilidade"),children:"Compatibilidade"}),e.jsx("button",{className:b==="instalacao"?"active":"",onClick:()=>o("instalacao"),children:"InstalaÃ§Ã£o"}),e.jsx("button",{className:b==="avaliacoes"?"active":"",onClick:()=>o("avaliacoes"),children:"AvaliaÃ§Ãµes"})]}),e.jsxs("div",{className:"tab-content",children:[b==="geral"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Como Adquirir"}),e.jsxs("div",{className:"workshop-info",children:[e.jsx("div",{children:"ðŸª Consulte preÃ§os e disponibilidade com nossas oficinas parceiras"}),e.jsx("div",{children:"ðŸ› ï¸ InstalaÃ§Ã£o profissional disponÃ­vel"}),e.jsx("div",{children:"ï¿½ Garantia conforme polÃ­tica de cada oficina"})]}),r.pecas_relacionadas&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"PeÃ§as Relacionadas"}),e.jsx("div",{className:"related-parts",children:r.pecas_relacionadas.map((i,f)=>e.jsxs("div",{className:"related-part",children:[e.jsx("strong",{children:i.nome}),e.jsx("span",{children:i.relacao})]},f))})]})]}),b==="especificacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"EspecificaÃ§Ãµes TÃ©cnicas"}),e.jsx("div",{className:"specs-grid",children:r.especificacoes_tecnicas&&Object.entries(r.especificacoes_tecnicas).map(([i,f])=>e.jsxs("div",{className:"spec-item",children:[e.jsxs("span",{className:"spec-label",children:[i.replace(/_/g," "),":"]}),e.jsx("span",{className:"spec-value",children:f})]},i))})]}),b==="compatibilidade"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AplicaÃ§Ãµes Detalhadas"}),e.jsx("div",{className:"compatibility-table",children:r.aplicacoes_detalhadas?.map((i,f)=>e.jsxs("div",{className:"compatibility-row",children:[e.jsxs("div",{className:"app-main",children:[e.jsxs("strong",{children:[i.marca," ",i.modelo]}),e.jsxs("span",{children:[i.ano_inicio,"-",i.ano_fim]})]}),e.jsxs("div",{className:"app-details",children:[e.jsxs("span",{children:["Motor: ",i.motor]}),i.observacoes&&e.jsx("small",{children:i.observacoes})]})]},f))})]}),b==="instalacao"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Guia de InstalaÃ§Ã£o"}),e.jsxs("div",{className:"install-guide",children:[e.jsxs("div",{className:"install-requirements",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ferramentas necessÃ¡rias:"})}),e.jsx("ul",{children:r.instalacao?.ferramentas_necessarias?.map((i,f)=>e.jsx("li",{children:i},f))})]}),r.instalacao?.precaucoes&&e.jsxs("div",{className:"install-precautions",children:[e.jsx("div",{children:e.jsx("strong",{children:"âš ï¸ PrecauÃ§Ãµes:"})}),e.jsx("ul",{children:r.instalacao.precaucoes.map((i,f)=>e.jsx("li",{children:i},f))})]})]})]}),b==="avaliacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AvaliaÃ§Ãµes de Clientes"}),e.jsx("div",{className:"reviews",children:r.avaliacoes?.map((i,f)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("strong",{children:i.usuario}),e.jsxs("div",{className:"review-rating",children:["â˜…".repeat(i.nota),"â˜†".repeat(5-i.nota)]}),e.jsx("span",{className:"review-date",children:new Date(i.data).toLocaleDateString("pt-BR")})]}),e.jsx("p",{children:i.texto})]},f))}),r.perguntasFrequentes&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Perguntas Frequentes"}),e.jsx("div",{className:"faq",children:r.perguntasFrequentes.map((i,f)=>e.jsxs("div",{className:"faq-item",children:[e.jsxs("strong",{children:["Q: ",i.pergunta]}),e.jsxs("p",{children:["R: ",i.resposta]})]},f))})]})]})]})]})]}):e.jsx("div",{className:"product-modal-error",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da peÃ§a."})})]})}):null}function Ue({selectedGrupo:s,setSelectedGrupo:m,selectedCategoria:p,setSelectedCategoria:c,selectedMarca:r,setSelectedMarca:d,selectedModelo:w,setSelectedModelo:u,selectedAno:b,setSelectedAno:o,selectedFabricante:N,setSelectedFabricante:h,grupos:C,todasPecas:I,marcas:L,modelos:y,anos:q,fabricantes:O,onSearch:z,onClear:i,loading:f,error:A,warningMarca:M,warningModelo:U,warningAno:P,warningFabricante:H,emptyFieldsWarning:G,onCarroChange:K}){const{usuarioLogado:$}=t.useContext(ae)||{},[V,D]=t.useState([]),[_,Q]=t.useState("");t.useEffect(()=>{(async()=>{if($){const F=$.id||$.email,B=await ue(F);D(B)}else D([]),Q("")})()},[$]);const J=x=>{if(Q(x),K&&K(x),!x)return;const F=V.find(B=>B.id===x);F&&(d(F.marca),u(F.modelo),o(String(F.ano)))};return e.jsxs("form",{className:"search-form",onSubmit:z,"aria-label":"FormulÃ¡rio de busca de peÃ§as",children:[$&&V.length>0&&e.jsxs("div",{className:"search-form-car-selector",children:[e.jsx("label",{htmlFor:"carro-selecionado",children:"Buscar por um carro especÃ­fico (opcional)"}),e.jsx(T,{options:[{value:"",label:"-- Busca geral (deixar em branco) --"},...V.map(x=>({value:x.id,label:`${x.marca} ${x.modelo} ${x.ano}${x.isDefault?" â­":""}`}))],value:_,onChange:J,placeholder:"Selecione um carro cadastrado"})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"grupo",children:"Grupo"}),e.jsx(T,{options:[{value:"",label:""},...C.map(x=>({value:x,label:x}))],value:s,onChange:m,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"categoria",children:"PeÃ§a"}),e.jsx(T,{options:[{value:"",label:""},...I.map(x=>({value:x,label:x}))],value:p,onChange:c,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"marca",children:"Marca"}),e.jsx(T,{options:[{value:"",label:""},...L.map(x=>({value:x,label:x}))],value:r,onChange:d,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"modelo",children:"Modelo"}),e.jsx(T,{options:[{value:"",label:""},...y.map(x=>({value:x,label:x}))],value:w,onChange:u,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"ano",children:"Ano"}),e.jsx(T,{options:[{value:"",label:""},...q.map(x=>({value:x,label:x}))],value:b,onChange:o,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"fabricante",children:"Fabricante"}),e.jsx(T,{options:[{value:"",label:""},...O.map(x=>({value:x,label:x}))],value:N,onChange:h,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-actions",children:[e.jsxs("div",{className:"search-form-buttons-row",children:[e.jsxs("div",{className:"search-form-buttons",children:[e.jsx("button",{className:"search-form-btn search-form-btn-primary",type:"submit",disabled:f,children:f?e.jsxs("span",{className:"loading-inline",children:[e.jsx(Ie,{size:"small",color:"primary"}),"Buscando..."]}):"Buscar"}),e.jsx("button",{type:"button",className:"search-form-btn search-form-btn-secondary",onClick:i,children:"Limpar"})]}),e.jsx("div",{className:"search-form-warnings-container",children:G?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",G]}):M?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",M]}):U?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",U]}):P?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",P]}):H?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",H]}):null})]}),A&&e.jsx("div",{className:"search-form-error",role:"status","aria-live":"polite",children:A})]})]})}function ea(){const{usuarioLogado:s}=t.useContext(ae)||{},[m,p]=t.useState(""),[c,r]=t.useState(""),[d,w]=t.useState(""),[u,b]=t.useState(""),[o,N]=t.useState(""),[h,C]=t.useState(""),[I,L]=t.useState([]),[y,q]=t.useState([]),[O,z]=t.useState([]),[i,f]=t.useState([]),[A,M]=t.useState([]),[U,P]=t.useState([]),[H,G]=t.useState([]),[K,$]=t.useState(!1),[V,D]=t.useState(""),[_,Q]=t.useState(""),[J,x]=t.useState(""),[F,B]=t.useState(""),[ne,X]=t.useState(""),[pe,Y]=t.useState(""),[fe,Z]=t.useState(""),[xe,ee]=t.useState(!1),[ce,le]=t.useState(""),[ve,se]=t.useState(null),[ge,de]=t.useState(!1),[je,me]=t.useState(null);t.useEffect(()=>{const n=async()=>{try{const a=await oe.getPecasMeta();L(a.grupos||[]),q(a.pecas||[]),z(a.marcas||[]),f(a.modelos||[]),M(a.anos||[]),P(a.fabricantes||[]),a.pecas&&a.pecas.length>0&&G(a.pecas)}catch(a){console.warn("Failed to load metadata:",a&&a.message?a.message:a),D("NÃ£o foi possÃ­vel carregar os dados iniciais. Tente recarregar a pÃ¡gina.")}};n();const v=()=>n();return window.addEventListener("app-refresh",v),()=>window.removeEventListener("app-refresh",v)},[]),t.useEffect(()=>{if(x(""),B(""),X(""),Y(""),(m||c||d||u||o||h)&&Z(""),h&&y.length>0){const v=y.filter(a=>(!m||a.category===m)&&(!c||a.name===c)&&a.manufacturer===h);d&&v.length>0&&(v.some(l=>!l.applications||!Array.isArray(l.applications)?!1:l.applications.some(g=>String(g).toLowerCase().includes(d.toLowerCase())))||x(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com a marca "${d}"`)),u&&v.length>0&&(v.some(l=>!l.applications||!Array.isArray(l.applications)?!1:l.applications.some(g=>String(g).toLowerCase().includes(u.toLowerCase())))||B(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o modelo "${u}"`)),o&&v.length>0&&(v.some(l=>!l.applications||!Array.isArray(l.applications)?!1:l.applications.some(g=>String(g).toLowerCase().includes(o)))||X(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o ano "${o}"`))}(d||u||o)&&h&&y.filter(a=>{const l=!m||a.category===m,g=!c||a.name===c,j=a.manufacturer===h;return!l||!g||!j||!a.applications||!Array.isArray(a.applications)?!1:a.applications.some(E=>{const S=String(E).toLowerCase(),R=!d||S.includes(d.toLowerCase()),k=!u||S.includes(u.toLowerCase()),re=!o||S.includes(o);return R&&k&&re})}).length===0&&!J&&!F&&!ne&&Y("NÃ£o hÃ¡ peÃ§as que atendam todos os filtros selecionados")},[m,c,h,d,u,o,y]);const be=()=>{if(!y||y.length===0)return[];if(!m||m==="")return Array.from(new Set(y.map(l=>l.name||"").filter(Boolean)));const n=y.filter(a=>a.category?a.category.toLowerCase().trim()===m.toLowerCase().trim():!1),v=Array.from(new Set(n.map(a=>a.name||"").filter(Boolean)));return _&&c&&!v.includes(c)&&v.push(c),v},Ne=()=>{if(!Array.isArray(y))return[];let n=y;m&&(n=n.filter(a=>a&&a.category===m)),c&&(n=n.filter(a=>a&&a.name===c));const v=Array.from(new Set(n.map(a=>a&&a.manufacturer).filter(Boolean)));return _&&h&&!v.includes(h)&&v.push(h),v},ye=()=>{if(!Array.isArray(y))return[];let n=y;m&&(n=n.filter(l=>l&&l.category===m)),c&&(n=n.filter(l=>l&&l.name===c)),h&&(n=n.filter(l=>l&&l.manufacturer===h));const v=new Set;n.forEach(l=>{l&&l.applications&&Array.isArray(l.applications)&&l.applications.forEach(g=>{const j=String(g).toLowerCase();["ford","chevrolet","volkswagen","fiat","honda","toyota","hyundai","nissan","renault","peugeot","citroÃ«n","bmw","mercedes","audi","volvo","mitsubishi","kia","suzuki","jeep","land rover","jaguar"].forEach(S=>{j.includes(S)&&v.add(S.charAt(0).toUpperCase()+S.slice(1))})})});const a=Array.from(v);return _&&d&&!a.includes(d)&&a.push(d),a},we=()=>{if(!d)return Array.isArray(i)?i:[];if(!Array.isArray(y))return[];let n=y;m&&(n=n.filter(g=>g&&g.category===m)),c&&(n=n.filter(g=>g&&g.name===c)),h&&(n=n.filter(g=>g&&g.manufacturer===h));const v=new Set,a=d.toLowerCase();n.forEach(g=>{g&&g.applications&&Array.isArray(g.applications)&&g.applications.forEach(j=>{const E=String(j).toLowerCase();if(E.includes(a)){const S=E.split(" "),R=S.findIndex(k=>k.includes(a));if(R>=0&&R<S.length-1){const k=S[R+1];k&&k.length>1&&v.add(k.charAt(0).toUpperCase()+k.slice(1))}}})});const l=Array.from(v);return _&&u&&!l.includes(u)&&l.push(u),l},Ce=()=>{if(!d&&!u)return Array.isArray(A)?A:[];if(!Array.isArray(y))return[];let n=y;m&&(n=n.filter(j=>j&&j.category===m)),c&&(n=n.filter(j=>j&&j.name===c)),h&&(n=n.filter(j=>j&&j.manufacturer===h));const v=new Set,a=d?.toLowerCase(),l=u?.toLowerCase();n.forEach(j=>{j&&j.applications&&Array.isArray(j.applications)&&j.applications.forEach(E=>{const S=String(E).toLowerCase(),R=!a||S.includes(a),k=!l||S.includes(l);if(R&&k){const re=/\d{4}(?:-\d{4})?/g;(S.match(re)||[]).forEach(ie=>{if(ie.includes("-")){const[Ee,Pe]=ie.split("-").map(Number);for(let te=Ee;te<=Pe;te++)v.add(String(te))}else v.add(ie)})}})});const g=Array.from(v).sort();return _&&o&&!g.includes(o)&&(g.push(o),g.sort()),g},Se=n=>e.jsx("div",{className:"buscarpeca-modal-pecas",children:e.jsx("div",{className:"compat-results-grid",children:e.jsx(We,{pecas:n,onViewCompatibility:ke,onViewDetails:Ae})})}),Ae=n=>{me(n),de(!0)},Me=()=>{de(!1),me(null)},ke=n=>{const v=typeof n=="object"&&n?n:H.find(l=>l.id===n);if(le("Compatibilidade"),!v||!v.applications){console.debug("[BuscarPeca] no applications for peca",v),se(e.jsx("div",{children:"Nenhuma aplicaÃ§Ã£o encontrada."})),ee(!0);return}const a=e.jsx("div",{className:"buscarpeca-compat-wrapper",children:e.jsx(Re,{applications:v.applications,usuarioLogado:s})});se(a),ee(!0)},Le=async n=>{if(n&&n.preventDefault&&n.preventDefault(),Z(""),!(m||c||d||u||o||h)){Z("Por favor, preencha pelo menos um campo para realizar a busca."),x(""),B(""),X(""),Y("");return}$(!0),D("");const a={grupo:m,categoria:c,marca:d,modelo:u,ano:o,fabricante:h};try{const l=await oe.buscarPecasML(a);console.log("ðŸ” Filtros aplicados:",a),console.log("ðŸ“¦ Dados retornados:",l),console.log("ðŸ“‹ PeÃ§as encontradas:",l.pecas?.length||0),console.log("ðŸŒ Fonte:",l.source||"local");const g=l.pecas||[];if(g.length===0){const j=[];a.marca&&j.push(`Marca: ${a.marca}`),a.modelo&&j.push(`Modelo: ${a.modelo}`),a.ano&&j.push(`Ano: ${a.ano}`),a.grupo&&j.push(`Grupo: ${a.grupo}`),a.categoria&&j.push(`PeÃ§a: ${a.categoria}`),a.fabricante&&j.push(`Fabricante: ${a.fabricante}`);const E=j.length>0?`Nenhuma peÃ§a encontrada para: ${j.join(", ")}. Tente remover alguns filtros ou buscar por termos mais genÃ©ricos.`:"Nenhuma peÃ§a encontrada para os filtros selecionados.";D(E)}else G(g),le(`Encontradas ${g.length} peÃ§a(s)`),se(Se(g)),ee(!0)}catch(l){console.error("âŒ Erro na busca:",l),D(l.message||"Erro ao buscar peÃ§as")}finally{$(!1)}},Fe=()=>{p(""),r(""),w(""),b(""),N(""),C(""),G([]),D(""),x(""),B(""),X(""),Y(""),Z("")};return e.jsxs(e.Fragment,{children:[s?e.jsx(Be,{}):e.jsx(De,{}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content buscarpeca-section",children:[e.jsx("h2",{className:"page-title",children:"CatÃ¡logo de PeÃ§as"}),e.jsx("div",{className:"buscarpeca-intro",children:e.jsx("p",{children:"Encontre peÃ§as automotivas compatÃ­veis com seu veÃ­culo. Busque por marca, modelo e ano."})}),e.jsx(Ue,{selectedGrupo:m,setSelectedGrupo:p,selectedCategoria:c,setSelectedCategoria:r,selectedMarca:d,setSelectedMarca:w,selectedModelo:u,setSelectedModelo:b,selectedAno:o,setSelectedAno:N,selectedFabricante:h,setSelectedFabricante:C,grupos:I,todasPecas:be(),marcas:ye(),modelos:we(),anos:Ce(),fabricantes:Ne(),onSearch:Le,onClear:Fe,onCarroChange:Q,loading:K,error:V,warningMarca:J,warningModelo:F,warningAno:ne,warningFabricante:pe,emptyFieldsWarning:fe})]})}),e.jsx(Te,{show:xe,onClose:()=>ee(!1),title:ce,titleIcon:ce==="Compatibilidade"?"./check.png":null,children:ve}),e.jsx(ze,{isOpen:ge,onClose:Me,productId:je,selectedCarId:_})]})}export{ea as default};
