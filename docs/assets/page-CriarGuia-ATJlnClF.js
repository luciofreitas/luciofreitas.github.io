import{r as l,A as E,u as G,a as q,j as e}from"./index-CtwKFqaY.js";import{M as y}from"./index.esm-CzbLBf9s.js";import{g as p}from"./guiasService-DAw1oR7r.js";function P(){const{usuarioLogado:t}=l.useContext(E)||{},c=G(),{guiaId:n}=q(),i=!!n,[s,x]=l.useState({titulo:"",descricao:"",categoria:"",conteudo:"",imagem:""}),[o,j]=l.useState({}),[u,v]=l.useState(!1),[f,m]=l.useState(""),g=!!(t&&t.isPro||localStorage.getItem("versaoProAtiva")==="true");l.useEffect(()=>{if(!g){c("/seja-pro");return}if(i&&n){const a=p.getGuiaById(n);if(!a){alert("Guia não encontrado"),c("/guias");return}if(a.autorEmail!==t?.email){alert("Você não tem permissão para editar este guia"),c("/guias");return}x({titulo:a.titulo,descricao:a.descricao,categoria:a.categoria,conteudo:a.conteudo,imagem:a.imagem||""})}},[g,i,n,t,c]);const d=a=>{const{name:r,value:S}=a.target;x(h=>({...h,[r]:S})),o[r]&&j(h=>({...h,[r]:""}))},N=()=>{const a={};return s.titulo.trim()?s.titulo.length<10&&(a.titulo="Título deve ter pelo menos 10 caracteres"):a.titulo="Título é obrigatório",s.descricao.trim()?s.descricao.length<20&&(a.descricao="Descrição deve ter pelo menos 20 caracteres"):a.descricao="Descrição é obrigatória",s.categoria||(a.categoria="Selecione uma categoria"),s.conteudo.trim()?s.conteudo.length<100&&(a.conteudo="Conteúdo deve ter pelo menos 100 caracteres"):a.conteudo="Conteúdo é obrigatório",j(a),Object.keys(a).length===0},b=async a=>{if(a.preventDefault(),!!N()){v(!0),m("");try{if(i)await p.updateGuia(n,s,t.email),m("Guia atualizado com sucesso!");else{const r=await p.createGuia(s,t.email);m("Guia criado com sucesso!"),console.debug("createGuia returned",r&&r.id?r.id:"(no-id)")}setTimeout(()=>{c("/guias")},1e3)}catch(r){alert("Erro ao salvar guia: "+r.message)}finally{v(!1)}}},C=["Manutenção Preventiva","Instalação de Peças","Diagnóstico de Problemas","Elétrica Automotiva","Mecânica Geral","Suspensão e Freios","Motor e Transmissão","Ar Condicionado","Estética Automotiva","Outros"];return g?e.jsxs(e.Fragment,{children:[e.jsx(y,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content",id:"criar-guia",children:[e.jsx("h2",{className:"page-title",children:i?"✏️ Editar Guia":"📝 Criar Novo Guia"}),e.jsxs("div",{className:"criar-guia-intro",children:[e.jsx("p",{children:i?"Edite seu guia e compartilhe seu conhecimento atualizado com a comunidade.":"Compartilhe seu conhecimento criando um guia personalizado para a comunidade."}),e.jsx("p",{className:"pro-badge",children:"⭐ Recurso exclusivo para assinantes Pro"})]}),f&&e.jsxs("div",{className:"success-message",children:["✅ ",f]}),e.jsxs("form",{className:"guia-form",onSubmit:b,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"titulo",className:"form-label",children:["Título do Guia ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"titulo",name:"titulo",className:`form-input ${o.titulo?"error":""}`,value:s.titulo,onChange:d,placeholder:"Ex: Como trocar o óleo do motor passo a passo",maxLength:100}),o.titulo&&e.jsx("span",{className:"error-message",children:o.titulo}),e.jsxs("span",{className:"char-count",children:[s.titulo.length,"/100"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"descricao",className:"form-label",children:["Descrição Breve ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("textarea",{id:"descricao",name:"descricao",className:`form-textarea ${o.descricao?"error":""}`,value:s.descricao,onChange:d,placeholder:"Breve resumo do que o guia aborda (20-200 caracteres)",rows:3,maxLength:200}),o.descricao&&e.jsx("span",{className:"error-message",children:o.descricao}),e.jsxs("span",{className:"char-count",children:[s.descricao.length,"/200"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"categoria",className:"form-label",children:["Categoria ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"categoria",name:"categoria",className:`form-select ${o.categoria?"error":""}`,value:s.categoria,onChange:d,children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),C.map(a=>e.jsx("option",{value:a,children:a},a))]}),o.categoria&&e.jsx("span",{className:"error-message",children:o.categoria})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"imagem",className:"form-label",children:"URL da Imagem (opcional)"}),e.jsx("input",{type:"url",id:"imagem",name:"imagem",className:"form-input",value:s.imagem,onChange:d,placeholder:"https://exemplo.com/imagem.jpg"}),e.jsx("span",{className:"help-text",children:"Cole o link de uma imagem ilustrativa para seu guia"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"conteudo",className:"form-label",children:["Conteúdo do Guia ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("textarea",{id:"conteudo",name:"conteudo",className:`form-textarea large ${o.conteudo?"error":""}`,value:s.conteudo,onChange:d,placeholder:"Escreva aqui o conteúdo detalhado do seu guia. Seja claro e objetivo. Você pode usar quebras de linha para organizar melhor o conteúdo.",rows:15,maxLength:5e3}),o.conteudo&&e.jsx("span",{className:"error-message",children:o.conteudo}),e.jsxs("span",{className:"char-count",children:[s.conteudo.length,"/5000"]})]}),e.jsxs("div",{className:"form-tips",children:[e.jsx("h3",{children:"💡 Dicas para um bom guia:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Use uma linguagem clara e objetiva"}),e.jsx("li",{children:"Organize o conteúdo em passos numerados quando apropriado"}),e.jsx("li",{children:"Inclua avisos de segurança quando necessário"}),e.jsx("li",{children:"Mencione ferramentas e materiais necessários"}),e.jsx("li",{children:"Seja específico sobre modelos e anos de veículos quando relevante"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:()=>c("/guias"),disabled:u,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:u,children:u?i?"Salvando...":"Criando...":i?"Salvar Alterações":"Criar Guia"})]})]}),!i&&e.jsxs("div",{className:"evaluation-notice",children:[e.jsx("h3",{children:"📊 Sobre o sistema de avaliação"}),e.jsxs("p",{children:["Seu guia ficará disponível para avaliação da comunidade por ",e.jsx("strong",{children:"7 dias"}),". Se a média de avaliações for inferior a ",e.jsx("strong",{children:"3 estrelas"}),", o guia ficará oculto para outros usuários, permitindo que você o edite e melhore antes de republicá-lo."]})]})]})})]}):null}export{P as default};
