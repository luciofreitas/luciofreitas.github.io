import{r as h,A as V,u as H,j as e,M as L}from"./index-BEkn57OO.js";import{M as q}from"./index.esm-D5TItGL_.js";import{g as R}from"./carService-CkEnHevU.js";const f="pf_maintenances";async function u(s){if(!s)return[];try{return JSON.parse(localStorage.getItem(f)||"{}")[s]||[]}catch(t){return console.error("Erro ao carregar manuten√ß√µes:",t),[]}}async function N(s,t){if(!s)return!1;try{const i=JSON.parse(localStorage.getItem(f)||"{}");return i[s]=t,localStorage.setItem(f,JSON.stringify(i)),!0}catch(i){return console.error("Erro ao salvar manuten√ß√µes:",i),!1}}async function T(s,t){if(!s||!t)return null;try{const i=await u(s),n={...t,id:Date.now().toString(),createdAt:new Date().toISOString()},l=[...i,n];return await N(s,l),n}catch(i){return console.error("Erro ao adicionar manuten√ß√£o:",i),null}}async function $(s,t,i){if(!s||!t)return!1;try{const l=(await u(s)).map(v=>v.id===t?{...v,...i,updatedAt:new Date().toISOString()}:v);return await N(s,l),!0}catch(n){return console.error("Erro ao atualizar manuten√ß√£o:",n),!1}}async function z(s,t){if(!s||!t)return!1;try{const n=(await u(s)).filter(l=>l.id!==t);return await N(s,n),!0}catch(i){return console.error("Erro ao deletar manuten√ß√£o:",i),!1}}function Y(){const{usuarioLogado:s}=h.useContext(V)||{},t=H(),[i,n]=h.useState([]),[l,v]=h.useState([]),[w,b]=h.useState(!0),[y,m]=h.useState(!1),[p,C]=h.useState(null),[x,E]=h.useState("todos"),[M,j]=h.useState(""),[o,d]=h.useState({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""});h.useEffect(()=>{(async()=>{if(s){b(!0);try{const r=s.id||s.email,c=await R(r);v(c);const I=await u(r);n(I)}catch(r){console.error("Erro ao carregar dados:",r)}finally{b(!1)}}})()},[s]);const F=async a=>{if(a.preventDefault(),!s)return;const r=s.id||s.email;try{if(p){await $(r,p,o);const c=await u(r);n(c)}else{await T(r,o);const c=await u(r);n(c)}g(),m(!1)}catch(c){console.error("Erro ao salvar manuten√ß√£o:",c),alert("Erro ao salvar manuten√ß√£o. Tente novamente.")}},k=a=>{d(a),C(a.id),j(a.veiculoId),m(!0)},D=async a=>{if(!window.confirm("Tem certeza que deseja excluir este registro?")||!s)return;const r=s.id||s.email;try{await z(r,a);const c=await u(r);n(c)}catch(c){console.error("Erro ao deletar manuten√ß√£o:",c),alert("Erro ao deletar manuten√ß√£o. Tente novamente.")}},g=()=>{d({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),C(null),j("")},A=a=>{j(a),a&&d({...o,veiculoId:a})},O=a=>{const r=l.find(c=>c.id===a);return r?`${r.marca} ${r.modelo} (${r.ano})`:"Ve√≠culo n√£o encontrado"},S=[...x==="todos"?i:i.filter(a=>a.veiculoId===x)].sort((a,r)=>new Date(r.data)-new Date(a.data));return s?e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsx("div",{className:"historico-intro",children:e.jsx("p",{children:"Mantenha um registro completo de todas as manuten√ß√µes, trocas de pe√ßas e servi√ßos realizados nos seus ve√≠culos. Esse hist√≥rico digital facilita o acompanhamento de revis√µes peri√≥dicas e aumenta o valor de revenda."})}),w?e.jsx("div",{className:"historico-loading",children:e.jsx("p",{children:"Carregando dados..."})}):l.length===0?e.jsxs("div",{className:"historico-no-cars",children:[e.jsx("p",{children:"Voc√™ ainda n√£o possui ve√≠culos cadastrados."}),e.jsx("p",{children:"Cadastre seu primeiro ve√≠culo para come√ßar a registrar manuten√ß√µes."}),e.jsx("button",{onClick:()=>t("/meus-carros"),className:"historico-add-car-btn",children:"üìù Ir para Meus Carros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historico-actions",children:[e.jsxs("div",{className:"historico-filters",children:[e.jsx("label",{htmlFor:"filtro-veiculo",children:"Filtrar por ve√≠culo:"}),e.jsxs("select",{id:"filtro-veiculo",value:x,onChange:a=>E(a.target.value),className:"historico-select",children:[e.jsx("option",{value:"todos",children:"Todos os ve√≠culos"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsx("button",{className:"historico-add-btn",onClick:()=>{g(),m(!0)},children:"+ Nova Manuten√ß√£o"})]}),S.length===0?e.jsxs("div",{className:"historico-empty",children:[e.jsx("p",{children:"Nenhuma manuten√ß√£o registrada ainda."}),e.jsx("p",{children:'Clique em "Nova Manuten√ß√£o" para come√ßar.'})]}):e.jsx("div",{className:"historico-list",children:S.map(a=>e.jsxs("div",{className:"historico-card",children:[e.jsxs("div",{className:"historico-card-header",children:[e.jsx("div",{className:"historico-card-veiculo",children:O(a.veiculoId)}),e.jsx("div",{className:"historico-card-data",children:new Date(a.data).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"historico-card-body",children:[e.jsx("div",{className:"historico-card-tipo",children:e.jsx("span",{className:`historico-tipo-badge ${a.tipo}`,children:a.tipo==="preventiva"?"Preventiva":a.tipo==="corretiva"?"Corretiva":"Outro"})}),e.jsxs("div",{className:"historico-card-descricao",children:[e.jsx("strong",{children:"Descri√ß√£o:"})," ",a.descricao]}),a.kmAtual&&e.jsxs("div",{className:"historico-card-km",children:[e.jsx("strong",{children:"Quilometragem:"})," ",parseInt(a.kmAtual).toLocaleString("pt-BR")," km"]}),a.oficina&&e.jsxs("div",{className:"historico-card-oficina",children:[e.jsx("strong",{children:"Oficina:"})," ",a.oficina]}),a.valor&&e.jsxs("div",{className:"historico-card-valor",children:[e.jsx("strong",{children:"Valor:"})," R$ ",parseFloat(a.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.observacoes&&e.jsxs("div",{className:"historico-card-obs",children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",a.observacoes]})]}),e.jsxs("div",{className:"historico-card-actions",children:[e.jsx("button",{className:"historico-edit-btn",onClick:()=>k(a),children:"Editar"}),e.jsx("button",{className:"historico-delete-btn",onClick:()=>D(a.id),children:"Excluir"})]})]},a.id))})]}),y&&e.jsx("div",{className:"historico-modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"historico-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"historico-modal-header",children:[e.jsx("h3",{children:p?"Editar Manuten√ß√£o":"Nova Manuten√ß√£o"}),e.jsx("button",{className:"historico-modal-close",onClick:()=>m(!1),children:"√ó"})]}),e.jsxs("form",{onSubmit:F,className:"historico-form",children:[!p&&l.length>0&&e.jsxs("div",{className:"historico-form-group historico-car-helper",children:[e.jsx("label",{htmlFor:"carroHelper",children:"üöó Selecione um ve√≠culo cadastrado (facilita o preenchimento)"}),e.jsxs("select",{id:"carroHelper",value:M,onChange:a=>A(a.target.value),className:"historico-input historico-car-selector",children:[e.jsx("option",{value:"",children:"-- Selecione um carro cadastrado --"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")",a.isDefault?" ‚≠ê":""]},a.id))]}),e.jsx("small",{className:"historico-helper-text",children:'Ao selecionar um ve√≠culo, o campo "Ve√≠culo" ser√° preenchido automaticamente'})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"veiculoId",children:"Ve√≠culo *"}),e.jsxs("select",{id:"veiculoId",value:o.veiculoId,onChange:a=>d({...o,veiculoId:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"",children:"Selecione um ve√≠culo"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"data",children:"Data *"}),e.jsx("input",{type:"date",id:"data",value:o.data,onChange:a=>d({...o,data:a.target.value}),required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",value:o.tipo,onChange:a=>d({...o,tipo:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"preventiva",children:"Preventiva"}),e.jsx("option",{value:"corretiva",children:"Corretiva"}),e.jsx("option",{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"descricao",children:"Descri√ß√£o *"}),e.jsx("input",{type:"text",id:"descricao",value:o.descricao,onChange:a=>d({...o,descricao:a.target.value}),placeholder:"Ex: Troca de √≥leo e filtro",required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"kmAtual",children:"Quilometragem"}),e.jsx("input",{type:"number",id:"kmAtual",value:o.kmAtual,onChange:a=>d({...o,kmAtual:a.target.value}),placeholder:"Ex: 50000",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"valor",children:"Valor (R$)"}),e.jsx("input",{type:"number",step:"0.01",id:"valor",value:o.valor,onChange:a=>d({...o,valor:a.target.value}),placeholder:"Ex: 150.00",className:"historico-input"})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"oficina",children:"Oficina/Local"}),e.jsx("input",{type:"text",id:"oficina",value:o.oficina,onChange:a=>d({...o,oficina:a.target.value}),placeholder:"Ex: Auto Center XYZ",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"observacoes",children:"Observa√ß√µes"}),e.jsx("textarea",{id:"observacoes",value:o.observacoes,onChange:a=>d({...o,observacoes:a.target.value}),placeholder:"Informa√ß√µes adicionais sobre a manuten√ß√£o",rows:"3",className:"historico-textarea"})]}),e.jsxs("div",{className:"historico-form-actions",children:[e.jsx("button",{type:"button",className:"historico-cancel-btn",onClick:()=>{g(),m(!1)},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"historico-save-btn",children:p?"Salvar Altera√ß√µes":"Adicionar Manuten√ß√£o"})]})]})]})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsxs("div",{className:"historico-login-required",children:[e.jsx("p",{children:"Voc√™ precisa estar logado para acessar o hist√≥rico de manuten√ß√£o."}),e.jsx("a",{href:"/#/login",className:"historico-login-btn",children:"Fazer Login"})]})]})})]})}export{Y as default};
