const i="pf_user_cars";function l(t){try{return String(t||"").trim().toLowerCase()}catch{return String(t||"")}}async function c(t){if(!t)return[];try{const r=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),o=await fetch(`${r}/api/users/${encodeURIComponent(t)}/cars-auto`);if(o.ok)return await o.json()}catch(r){console.warn("API getCars failed, falling back to localStorage:",r)}try{const r=JSON.parse(localStorage.getItem(i)||"{}"),o=l(t);return r[o]||[]}catch(r){return console.error("Erro ao carregar carros:",r),[]}}async function s(t,r){if(!t)return!1;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"");if((await fetch(`${o}/api/users/${encodeURIComponent(t)}/cars`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({cars:r})})).ok)return!0}catch(o){console.warn("API saveCars failed, falling back to localStorage:",o)}try{const o=JSON.parse(localStorage.getItem(i)||"{}"),e=l(t);return o[e]=r,localStorage.setItem(i,JSON.stringify(o)),!0}catch(o){return console.error("Erro ao salvar carros:",o),!1}}async function w(t,r){if(!t||!r)return null;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),e=await fetch(`${o}/api/users/${encodeURIComponent(t)}/cars-auto`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(e.ok){const a=await e.json();return console.log("üöó Car added via API automatically:",a),a}}catch(o){console.warn("Auto API addCar failed, falling back to localStorage:",o)}try{const o=await c(t),e={id:Date.now().toString()+Math.random().toString(36).substr(2,9),...r,createdAt:new Date().toISOString()};return o.push(e),await s(t,o),e}catch(o){return console.error("Erro ao adicionar carro:",o),null}}async function d(t,r){if(!t||!r)return console.error("üóëÔ∏è removeCar: Missing userId or carId",{userId:t,carId:r}),!1;console.log(`üóëÔ∏è AUTO-REMOVE: Attempting to remove car ${r} for user ${t}`);try{const e=`${typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"")}/api/users/${encodeURIComponent(t)}/cars-auto/${encodeURIComponent(r)}`;console.log(`üóëÔ∏è DELETE URL: ${e}`);const a=await fetch(e,{method:"DELETE"});if(console.log(`üóëÔ∏è DELETE Response: ${a.status} ${a.statusText}`),a.ok){const n=await a.json();return console.log("üóëÔ∏è Car deleted via API automatically:",n),!0}else{const n=await a.text();console.error("üóëÔ∏è DELETE API failed:",a.status,n)}}catch(o){console.error("üóëÔ∏è API removeCar failed, falling back to localStorage:",o)}console.log("üóëÔ∏è Falling back to localStorage removal");try{const o=await c(t);console.log(`üóëÔ∏è Current cars in localStorage: ${o.length}`);const e=o.filter(a=>a.id!==r);return console.log(`üóëÔ∏è Cars after filtering: ${e.length}`),await s(t,e),console.log("üóëÔ∏è Car removed from localStorage successfully"),!0}catch(o){return console.error("üóëÔ∏è Erro ao remover carro do localStorage:",o),!1}}async function f(t,r,o){if(!t||!r||!o)return!1;try{const a=(await c(t)).map(n=>n.id===r?{...n,...o,updatedAt:new Date().toISOString()}:n);return await s(t,a),!0}catch(e){return console.error("Erro ao atualizar carro:",e),!1}}async function u(t,r){if(!t||!r)return!1;try{const e=(await c(t)).map(a=>({...a,isDefault:a.id===r}));return await s(t,e),!0}catch(o){return console.error("Erro ao definir carro padr√£o:",o),!1}}export{w as a,c as g,d as r,u as s,f as u};
