import{r as n,f as Pe,j as e,A as ie,u as $e,M as Re}from"./index-BjzxRI5r.js";import{a as te}from"./apiService-BXPplyL7.js";import{F as Be,b as De}from"./index-vKZgbekf.js";import{M as _e}from"./index.esm-C0Y5t7xP.js";import{g as Te}from"./carService-CkEnHevU.js";import"./glossarioData-8VebtgBN.js";import"./mlService-Bx3cZaWs.js";function We({anchorRef:r,children:c,visible:p}){const a=n.useRef(null),[w,i]=n.useState({top:0,left:0});return n.useEffect(()=>{if(!p)return;function j(){const b=r&&r.current,l=a.current;if(!b||!l)return;const N=b.getBoundingClientRect(),o=l.getBoundingClientRect();let y=N.top-o.height-8,S=N.left+N.width/2-o.width/2;const h=8;S<h&&(S=h),S+o.width>window.innerWidth-h&&(S=window.innerWidth-o.width-h),y<h&&(y=N.bottom+8),i({top:y,left:S})}j(),window.addEventListener("resize",j),window.addEventListener("scroll",j,!0);let t;return typeof window.ResizeObserver<"u"&&(t=new window.ResizeObserver(j),t.observe(document.body)),()=>{window.removeEventListener("resize",j),window.removeEventListener("scroll",j,!0),t&&t.disconnect()}},[p,r]),p?Pe.createPortal(e.jsx("div",{ref:a,className:"whatsapp-portal-tooltip-text",role:"status","aria-hidden":!p,style:{position:"fixed",top:w.top,left:w.left},children:c}),document.body):null}const ze=""+new URL("padlock-zslNzK7s.png",import.meta.url).href;function Ie({vehicle:r,isPro:c}){const p=`https://api.whatsapp.com/send?text=${encodeURIComponent("OlÃ¡, tenho interesse na peÃ§a para: "+(r||""))}`,a=n.useRef(null),[w,i]=n.useState(!1),j=()=>i(!0),t=()=>i(!1);return e.jsxs("div",{className:"whatsapp-button-container",children:[e.jsxs("div",{className:"whatsapp-button-wrapper",children:[e.jsx("a",{className:"whatsapp-button",href:p,target:"_blank",rel:"noopener noreferrer","aria-label":`Contato via WhatsApp: ${r||""}`,children:e.jsx(Be,{})}),!c&&e.jsx("div",{className:"whatsapp-button-blur"})]}),!c&&e.jsxs("div",{className:"whatsapp-tooltip",onMouseEnter:j,onMouseLeave:t,children:[e.jsx("div",{className:"whatsapp-tooltip-icon",ref:a,onFocus:j,onBlur:t,tabIndex:0,children:e.jsx("img",{src:ze,alt:"Cadeado",className:"whatsapp-padlock"})}),e.jsx(We,{anchorRef:a,visible:w,children:"Seja Pro, para liberar o contato da oficina"})]})]})}function qe({applications:r,usuarioLogado:c}){const p=!!(c&&c.isPro||localStorage.getItem("versaoProAtiva")==="true");return e.jsxs("div",{className:"compatibility-grid",children:[e.jsxs("div",{className:"compatibility-grid-header",children:[e.jsx("div",{className:"compatibility-header-vehicle",children:e.jsx("strong",{children:"Carro"})}),e.jsx("div",{className:"compatibility-header-years",children:e.jsx("strong",{children:"Anos"})}),e.jsx("div",{className:"compatibility-header-contact",children:e.jsx("strong",{children:"Contato"})})]}),r.map((a,w)=>{let i=[],j="";return typeof a=="string"?((a.match(/\d{4}(?:-\d{4})?/g)||[]).forEach(b=>{if(b.includes("-")){const[l,N]=b.split("-").map(Number);for(let o=l;o<=N;o++)i.push(String(o))}else i.push(b)}),j=a.replace(/\d{4}(-\d{4})?/g,"").replace(/--/g,"").replace(/\(|\)|,/g,"").replace(/-+/g,"").trim()):typeof a=="object"&&(j=a.vehicle||"",i=a.years||[]),e.jsxs("div",{className:"compatibility-grid-row",children:[e.jsx("div",{className:"compatibility-grid-vehicle",children:e.jsx("div",{className:"compatibility-vehicle-text",children:j||"-"})}),e.jsx("div",{className:"compatibility-grid-years",children:e.jsx("div",{className:"compatibility-years-text",children:i.length?i.join(", "):"-"})}),e.jsx("div",{className:"compatibility-grid-contact",children:e.jsx(Ie,{vehicle:j,isPro:p})})]},w)})]})}const D=[];function he(r,c){n.useEffect(()=>{const p=c?.current;if(!r||!p)return;const a=document.activeElement;D.push({container:p,prevActive:a});const w=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");function i(){return Array.from(p.querySelectorAll(w)).filter(l=>!!(l.offsetWidth||l.offsetHeight||l.getClientRects().length))}function j(){const l=i();l.length?l[0].focus():(p.hasAttribute("tabindex")||p.setAttribute("tabindex","-1"),p.focus())}function t(){const l=D[D.length-1];return l&&l.container===p}function b(l){if(!t()||l.key!=="Tab")return;const N=i();if(N.length===0){l.preventDefault();return}const o=N[0],y=N[N.length-1];l.shiftKey?(document.activeElement===o||document.activeElement===p)&&(l.preventDefault(),y.focus()):document.activeElement===y&&(l.preventDefault(),o.focus())}return j(),document.addEventListener("keydown",b),()=>{for(let l=D.length-1;l>=0;l--)if(D[l].container===p){const N=D.splice(l,1)[0];try{N.prevActive&&typeof N.prevActive.focus=="function"&&N.prevActive.focus()}catch{}break}document.removeEventListener("keydown",b)}},[r,c])}function Ge({show:r,onClose:c,title:p,titleIcon:a,children:w}){const i=n.useRef(null);if(he(r,i),n.useEffect(()=>{if(r){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[r]),!r)return null;const j=t=>{t.target.classList.contains("modal-overlay")&&c()};return e.jsx("div",{className:"modal-overlay",onClick:j,children:e.jsxs("div",{ref:i,className:"compat-modal",role:"dialog","aria-modal":"true","aria-label":p||"Modal",children:[e.jsxs("div",{className:"app-compat-header",children:[e.jsxs("div",{className:"app-compat-title-wrapper",children:[a&&e.jsx(De,{className:"app-compat-title-icon",style:{color:"#10b981",fontSize:"1.5rem"}}),e.jsx("span",{className:"app-compat-title",children:p})]}),e.jsx("button",{className:"app-compat-close","aria-label":"Fechar",onClick:c,children:"âœ•"})]}),e.jsx("div",{className:"app-compat-body",children:w})]})})}function R({options:r=[],value:c,onChange:p,placeholder:a="",disabled:w=!1}){const[i,j]=n.useState(!1),t=n.useRef(null);n.useEffect(()=>{function o(y){t.current&&!t.current.contains(y.target)&&j(!1)}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]);function b(o){p(o),j(!1)}const l=r.find(o=>o.value===c)?.label||"",N=r;return e.jsxs("div",{className:`custom-dropdown${w?" disabled":""}`,ref:t,children:[e.jsxs("button",{className:`dropdown-btn${i?" open":""}`,onClick:()=>!w&&j(!i),disabled:w,type:"button",children:[e.jsx("span",{className:"dropdown-label",children:l||a}),e.jsx("span",{className:"dropdown-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"custom-dropdown-arrow-svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 6 L8 10 L12 6",stroke:"#444",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),i&&e.jsxs("div",{className:"dropdown-menu",children:[N.length===0&&e.jsx("div",{className:"dropdown-item disabled",children:"Nenhum item"}),N.map((o,y)=>e.jsx("div",{className:`dropdown-item${o.value===c?" selected":""}`,onClick:()=>b(o.value),children:o.label},`${o.value}${y}`))]})]})}const Ue=({size:r="medium",color:c="primary",text:p=""})=>e.jsxs("div",{className:`loading-spinner-container loading-spinner-${r}`,children:[e.jsxs("div",{className:`loading-spinner loading-spinner-${c}`,children:[e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"})]}),p&&e.jsx("p",{className:"loading-text",children:p})]});function Oe({peca:r,onViewCompatibility:c,onViewDetails:p}){const{usuarioLogado:a}=n.useContext(ie)||{},w=$e(),i=r.ml_product||r.permalink,j=(t,b="BRL")=>t?new Intl.NumberFormat("pt-BR",{style:"currency",currency:b}).format(t):null;return e.jsxs("div",{className:`peca-card ${i?"ml-product":""}`,children:[i&&r.thumbnail&&e.jsxs("div",{className:"peca-card-image",children:[e.jsx("img",{src:r.thumbnail,alt:r.name,loading:"lazy"}),r.shipping?.free_shipping&&e.jsx("span",{className:"free-shipping-badge",children:"Frete GrÃ¡tis"})]}),e.jsx("h3",{className:"peca-card-title",children:r.name}),i&&r.price&&e.jsxs("div",{className:"peca-card-price",children:[e.jsx("span",{className:"price-current",children:j(r.price,r.currency)}),r.original_price&&r.original_price>r.price&&e.jsx("span",{className:"price-original",children:j(r.original_price,r.currency)})]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Categoria:"})," ",r.category]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Fabricante:"})," ",r.manufacturer]}),i&&r.condition&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"CondiÃ§Ã£o:"})," ",r.condition==="new"?"Novo":"Usado"]}),i&&r.available_quantity!==void 0&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"DisponÃ­vel:"})," ",r.available_quantity," unidade(s)",r.sold_quantity>0&&` â€¢ ${r.sold_quantity} vendido(s)`]}),r.specifications&&e.jsxs("div",{className:"peca-card-specs",children:[e.jsx("strong",{children:"EspecificaÃ§Ãµes:"}),Object.entries(r.specifications).map(([t,b])=>e.jsxs("div",{className:"peca-card-spec-item",children:[t,": ",b]},t))]}),e.jsxs("div",{className:"peca-card-actions",children:[i&&r.permalink&&e.jsx("a",{href:r.permalink,target:"_blank",rel:"noopener noreferrer",className:"peca-card-buy-btn ml-btn",children:"ðŸ›’ Comprar no Mercado Livre"}),e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-compat-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&c(r),disabled:!a,children:"Ver compatibilidade"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para ver a compatibilidade completa desta peÃ§a"})]})]}),(!i||a)&&e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-details-btn ${a?"":"btn-blocked"}`,onClick:()=>a&&p&&p(r.id),disabled:!a,children:"Ver ficha completa"}),!a&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para acessar a ficha tÃ©cnica completa desta peÃ§a"})]})]})]}),!a&&e.jsxs("div",{className:"cta-login-box",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Quer acessar todos os detalhes?"})]}),e.jsx("button",{onClick:()=>w("/login"),className:"cta-login-button",children:"Fazer Login / Cadastrar GrÃ¡tis"})]})]})}function Ve({pecas:r,onViewCompatibility:c,onViewDetails:p}){return!r||r.length===0?e.jsx("div",{className:"pecas-grid-empty",children:e.jsx("p",{children:"Nenhuma peÃ§a encontrada para os filtros selecionados."})}):e.jsx("div",{className:"pecas-grid",children:r.map(a=>e.jsx(Oe,{peca:a,onViewCompatibility:c,onViewDetails:p},a.id))})}function Ke({isOpen:r,onClose:c,productId:p}){const[a,w]=n.useState(null),[i,j]=n.useState(!1),[t,b]=n.useState("geral"),[l,N]=n.useState(0);n.useEffect(()=>{r&&p&&y(p)},[r,p]);const o=n.useRef(null);he(r,o);const y=async h=>{j(!0);try{const u=await te.getPecaById(h);if(u.error)throw console.error("ProductDetailModal: Error from API:",u.error),new Error(u.error);w(u),N(0)}catch(u){console.error("Erro ao carregar detalhes da peÃ§a:",u),w(null)}finally{j(!1)}},S=h=>{h.target===h.currentTarget&&c()};return r?e.jsx("div",{className:"product-modal-overlay",onClick:S,children:e.jsxs("div",{ref:o,className:"product-modal",role:"dialog","aria-modal":"true","aria-label":a?.nome||"Detalhes da peÃ§a",children:[e.jsxs("div",{className:"product-modal-header",children:[e.jsx("h2",{children:a?.nome||"Carregando..."}),e.jsx("button",{className:"product-modal-close",onClick:c,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),i?e.jsxs("div",{className:"product-modal-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Carregando detalhes da peÃ§a..."})]}):a?e.jsxs("div",{className:"product-modal-content",children:[e.jsxs("div",{className:"product-header-section",children:[e.jsxs("div",{className:"product-images",children:[e.jsx("div",{className:"main-image",children:e.jsx("img",{src:a.imagens?.[l]||"/images/placeholderPart.jpg",alt:a?.nome||"",onError:h=>{h.target.src="/images/placeholderPart.jpg"}})}),a.imagens&&a.imagens.length>1&&e.jsx("div",{className:"image-thumbnails",children:a.imagens.map((h,u)=>e.jsx("img",{src:h,alt:a?.nome?`${a.nome} - ${u+1}`:"",className:l===u?"active":"",onClick:()=>N(u),onError:_=>{_.target.src="/images/placeholderPart.jpg"}},u))})]}),e.jsxs("div",{className:"product-basic-info",children:[a.recall_relacionado&&e.jsxs("div",{className:"recall-alert",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M11 7h2v6h-2zM11 15h2v2h-2z",fill:"currentColor"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Recall Relacionado"}),e.jsx("p",{children:a.recall_detalhes?.descricao}),e.jsxs("small",{children:["Ref: ",a.recall_detalhes?.numero]})]})]}),e.jsxs("div",{className:"product-codes",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fabricante:"})," ",a.fabricante]}),a.codigos?.oem&&e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digos OEM:"})," ",a.codigos.oem.join(", ")]})]}),e.jsxs("div",{className:"installation-info",children:[e.jsxs("div",{className:"install-difficulty",children:[e.jsx("span",{className:"label",children:"Dificuldade:"}),e.jsx("span",{className:`difficulty ${a.instalacao?.dificuldade?.toLowerCase()}`,children:a.instalacao?.dificuldade})]}),e.jsxs("div",{className:"install-time",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2"})]}),a.instalacao?.tempo_estimado_min," min"]})]}),e.jsxs("div",{className:"contact-workshop",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ’¡ Para preÃ§os e disponibilidade:"})}),e.jsx("p",{children:"Consulte nossas oficinas parceiras prÃ³ximas ao seu local"})]})]})]}),e.jsxs("div",{className:"product-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsx("button",{className:t==="geral"?"active":"",onClick:()=>b("geral"),children:"Geral"}),e.jsx("button",{className:t==="especificacoes"?"active":"",onClick:()=>b("especificacoes"),children:"EspecificaÃ§Ãµes"}),e.jsx("button",{className:t==="compatibilidade"?"active":"",onClick:()=>b("compatibilidade"),children:"Compatibilidade"}),e.jsx("button",{className:t==="instalacao"?"active":"",onClick:()=>b("instalacao"),children:"InstalaÃ§Ã£o"}),e.jsx("button",{className:t==="avaliacoes"?"active":"",onClick:()=>b("avaliacoes"),children:"AvaliaÃ§Ãµes"})]}),e.jsxs("div",{className:"tab-content",children:[t==="geral"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Como Adquirir"}),e.jsxs("div",{className:"workshop-info",children:[e.jsx("div",{children:"ðŸª Consulte preÃ§os e disponibilidade com nossas oficinas parceiras"}),e.jsx("div",{children:"ðŸ› ï¸ InstalaÃ§Ã£o profissional disponÃ­vel"}),e.jsx("div",{children:"ï¿½ Garantia conforme polÃ­tica de cada oficina"})]}),a.pecas_relacionadas&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"PeÃ§as Relacionadas"}),e.jsx("div",{className:"related-parts",children:a.pecas_relacionadas.map((h,u)=>e.jsxs("div",{className:"related-part",children:[e.jsx("strong",{children:h.nome}),e.jsx("span",{children:h.relacao})]},u))})]})]}),t==="especificacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"EspecificaÃ§Ãµes TÃ©cnicas"}),e.jsx("div",{className:"specs-grid",children:a.especificacoes_tecnicas&&Object.entries(a.especificacoes_tecnicas).map(([h,u])=>e.jsxs("div",{className:"spec-item",children:[e.jsxs("span",{className:"spec-label",children:[h.replace(/_/g," "),":"]}),e.jsx("span",{className:"spec-value",children:u})]},h))})]}),t==="compatibilidade"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AplicaÃ§Ãµes Detalhadas"}),e.jsx("div",{className:"compatibility-table",children:a.aplicacoes_detalhadas?.map((h,u)=>e.jsxs("div",{className:"compatibility-row",children:[e.jsxs("div",{className:"app-main",children:[e.jsxs("strong",{children:[h.marca," ",h.modelo]}),e.jsxs("span",{children:[h.ano_inicio,"-",h.ano_fim]})]}),e.jsxs("div",{className:"app-details",children:[e.jsxs("span",{children:["Motor: ",h.motor]}),h.observacoes&&e.jsx("small",{children:h.observacoes})]})]},u))})]}),t==="instalacao"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Guia de InstalaÃ§Ã£o"}),e.jsxs("div",{className:"install-guide",children:[e.jsxs("div",{className:"install-requirements",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ferramentas necessÃ¡rias:"})}),e.jsx("ul",{children:a.instalacao?.ferramentas_necessarias?.map((h,u)=>e.jsx("li",{children:h},u))})]}),a.instalacao?.precaucoes&&e.jsxs("div",{className:"install-precautions",children:[e.jsx("div",{children:e.jsx("strong",{children:"âš ï¸ PrecauÃ§Ãµes:"})}),e.jsx("ul",{children:a.instalacao.precaucoes.map((h,u)=>e.jsx("li",{children:h},u))})]})]})]}),t==="avaliacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AvaliaÃ§Ãµes de Clientes"}),e.jsx("div",{className:"reviews",children:a.avaliacoes?.map((h,u)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("strong",{children:h.usuario}),e.jsxs("div",{className:"review-rating",children:["â˜…".repeat(h.nota),"â˜†".repeat(5-h.nota)]}),e.jsx("span",{className:"review-date",children:new Date(h.data).toLocaleDateString("pt-BR")})]}),e.jsx("p",{children:h.texto})]},u))}),a.perguntasFrequentes&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Perguntas Frequentes"}),e.jsx("div",{className:"faq",children:a.perguntasFrequentes.map((h,u)=>e.jsxs("div",{className:"faq-item",children:[e.jsxs("strong",{children:["Q: ",h.pergunta]}),e.jsxs("p",{children:["R: ",h.resposta]})]},u))})]})]})]})]})]}):e.jsx("div",{className:"product-modal-error",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da peÃ§a."})})]})}):null}function Qe({selectedGrupo:r,setSelectedGrupo:c,selectedCategoria:p,setSelectedCategoria:a,selectedMarca:w,setSelectedMarca:i,selectedModelo:j,setSelectedModelo:t,selectedAno:b,setSelectedAno:l,selectedFabricante:N,setSelectedFabricante:o,grupos:y,todasPecas:S,marcas:h,modelos:u,anos:_,fabricantes:oe,onSearch:Y,onClear:z,loading:I,error:T,warningMarca:q,warningModelo:Z,warningAno:G,warningFabricante:U,emptyFieldsWarning:B,onCarroChange:O}){const{usuarioLogado:L}=n.useContext(ie)||{},[W,E]=n.useState([]),[P,V]=n.useState("");n.useEffect(()=>{(async()=>{if(L){const M=L.id||L.email,F=await Te(M);E(F)}else E([]),V("")})()},[L]);const K=f=>{if(V(f),O&&O(f),!f)return;const M=W.find(F=>F.id===f);M&&(i(M.marca),t(M.modelo),l(String(M.ano)))};return e.jsxs("form",{className:"search-form",onSubmit:Y,"aria-label":"FormulÃ¡rio de busca de peÃ§as",children:[L&&W.length>0&&e.jsxs("div",{className:"search-form-car-selector",children:[e.jsx("label",{htmlFor:"carro-selecionado",children:"Buscar por um carro especÃ­fico (opcional)"}),e.jsx(R,{options:[{value:"",label:"-- Busca geral (deixar em branco) --"},...W.map(f=>({value:f.id,label:`${f.marca} ${f.modelo} ${f.ano}${f.isDefault?" â­":""}`}))],value:P,onChange:K,placeholder:"Selecione um carro cadastrado"})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"grupo",children:"Grupo"}),e.jsx(R,{options:[{value:"",label:""},...y.map(f=>({value:f,label:f}))],value:r,onChange:c,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"categoria",children:"PeÃ§a"}),e.jsx(R,{options:[{value:"",label:""},...S.map(f=>({value:f,label:f}))],value:p,onChange:a,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"marca",children:"Marca"}),e.jsx(R,{options:[{value:"",label:""},...h.map(f=>({value:f,label:f}))],value:w,onChange:i,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"modelo",children:"Modelo"}),e.jsx(R,{options:[{value:"",label:""},...u.map(f=>({value:f,label:f}))],value:j,onChange:t,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"ano",children:"Ano"}),e.jsx(R,{options:[{value:"",label:""},..._.map(f=>({value:f,label:f}))],value:b,onChange:l,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"fabricante",children:"Fabricante"}),e.jsx(R,{options:[{value:"",label:""},...oe.map(f=>({value:f,label:f}))],value:N,onChange:o,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-actions",children:[e.jsxs("div",{className:"search-form-buttons-row",children:[e.jsxs("div",{className:"search-form-buttons",children:[e.jsx("button",{className:"search-form-btn search-form-btn-primary",type:"submit",disabled:I,children:I?e.jsxs("span",{className:"loading-inline",children:[e.jsx(Ue,{size:"small",color:"primary"}),"Buscando..."]}):"Buscar"}),e.jsx("button",{type:"button",className:"search-form-btn search-form-btn-secondary",onClick:z,children:"Limpar"})]}),e.jsx("div",{className:"search-form-warnings-container",children:B?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",B]}):q?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",q]}):Z?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",Z]}):G?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",G]}):U?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",U]}):null})]}),T&&e.jsx("div",{className:"search-form-error",role:"status","aria-live":"polite",children:T})]})]})}function ra(){const{usuarioLogado:r}=n.useContext(ie)||{},[c,p]=n.useState(""),[a,w]=n.useState(""),[i,j]=n.useState(""),[t,b]=n.useState(""),[l,N]=n.useState(""),[o,y]=n.useState(""),[S,h]=n.useState([]),[u,_]=n.useState([]),[oe,Y]=n.useState([]),[z,I]=n.useState([]),[T,q]=n.useState([]),[Z,G]=n.useState([]),[U,B]=n.useState([]),[O,L]=n.useState(!1),[W,E]=n.useState(""),[P,V]=n.useState(""),[K,f]=n.useState(""),[M,F]=n.useState(""),[ne,Q]=n.useState(""),[ue,H]=n.useState(""),[pe,J]=n.useState(""),[fe,X]=n.useState(!1),[ce,le]=n.useState(""),[xe,ee]=n.useState(null),[je,de]=n.useState(!1),[ve,me]=n.useState(null);n.useEffect(()=>{const d=async()=>{try{const s=await te.getPecasMeta();h(s.grupos||[]),_(s.pecas||[]),Y(s.marcas||[]),I(s.modelos||[]),q(s.anos||[]),G(s.fabricantes||[]),s.pecas&&s.pecas.length>0&&B(s.pecas)}catch(s){console.warn("Failed to load metadata:",s&&s.message?s.message:s),E("NÃ£o foi possÃ­vel carregar os dados iniciais. Tente recarregar a pÃ¡gina.")}};d();const x=()=>d();return window.addEventListener("app-refresh",x),()=>window.removeEventListener("app-refresh",x)},[]),n.useEffect(()=>{if(f(""),F(""),Q(""),H(""),(c||a||i||t||l||o)&&J(""),o&&u.length>0){const x=u.filter(s=>(!c||s.category===c)&&(!a||s.name===a)&&s.manufacturer===o);i&&x.length>0&&(x.some(m=>!m.applications||!Array.isArray(m.applications)?!1:m.applications.some(v=>String(v).toLowerCase().includes(i.toLowerCase())))||f(`NÃ£o hÃ¡ peÃ§as do fabricante "${o}" compatÃ­veis com a marca "${i}"`)),t&&x.length>0&&(x.some(m=>!m.applications||!Array.isArray(m.applications)?!1:m.applications.some(v=>String(v).toLowerCase().includes(t.toLowerCase())))||F(`NÃ£o hÃ¡ peÃ§as do fabricante "${o}" compatÃ­veis com o modelo "${t}"`)),l&&x.length>0&&(x.some(m=>!m.applications||!Array.isArray(m.applications)?!1:m.applications.some(v=>String(v).toLowerCase().includes(l)))||Q(`NÃ£o hÃ¡ peÃ§as do fabricante "${o}" compatÃ­veis com o ano "${l}"`))}(i||t||l)&&o&&u.filter(s=>{const m=!c||s.category===c,v=!a||s.name===a,g=s.manufacturer===o;return!m||!v||!g||!s.applications||!Array.isArray(s.applications)?!1:s.applications.some(k=>{const C=String(k).toLowerCase(),$=!i||C.includes(i.toLowerCase()),A=!t||C.includes(t.toLowerCase()),ae=!l||C.includes(l);return $&&A&&ae})}).length===0&&!K&&!M&&!ne&&H("NÃ£o hÃ¡ peÃ§as que atendam todos os filtros selecionados")},[c,a,o,i,t,l,u]);const ge=()=>{if(!u||u.length===0)return[];if(!c||c==="")return Array.from(new Set(u.map(m=>m.name||"").filter(Boolean)));const d=u.filter(s=>s.category?s.category.toLowerCase().trim()===c.toLowerCase().trim():!1),x=Array.from(new Set(d.map(s=>s.name||"").filter(Boolean)));return P&&a&&!x.includes(a)&&x.push(a),x},be=()=>{if(!Array.isArray(u))return[];let d=u;c&&(d=d.filter(s=>s&&s.category===c)),a&&(d=d.filter(s=>s&&s.name===a));const x=Array.from(new Set(d.map(s=>s&&s.manufacturer).filter(Boolean)));return P&&o&&!x.includes(o)&&x.push(o),x},Ne=()=>{if(!Array.isArray(u))return[];let d=u;c&&(d=d.filter(m=>m&&m.category===c)),a&&(d=d.filter(m=>m&&m.name===a)),o&&(d=d.filter(m=>m&&m.manufacturer===o));const x=new Set;d.forEach(m=>{m&&m.applications&&Array.isArray(m.applications)&&m.applications.forEach(v=>{const g=String(v).toLowerCase();["ford","chevrolet","volkswagen","fiat","honda","toyota","hyundai","nissan","renault","peugeot","citroÃ«n","bmw","mercedes","audi","volvo","mitsubishi","kia","suzuki","jeep","land rover","jaguar"].forEach(C=>{g.includes(C)&&x.add(C.charAt(0).toUpperCase()+C.slice(1))})})});const s=Array.from(x);return P&&i&&!s.includes(i)&&s.push(i),s},we=()=>{if(!i)return Array.isArray(z)?z:[];if(!Array.isArray(u))return[];let d=u;c&&(d=d.filter(v=>v&&v.category===c)),a&&(d=d.filter(v=>v&&v.name===a)),o&&(d=d.filter(v=>v&&v.manufacturer===o));const x=new Set,s=i.toLowerCase();d.forEach(v=>{v&&v.applications&&Array.isArray(v.applications)&&v.applications.forEach(g=>{const k=String(g).toLowerCase();if(k.includes(s)){const C=k.split(" "),$=C.findIndex(A=>A.includes(s));if($>=0&&$<C.length-1){const A=C[$+1];A&&A.length>1&&x.add(A.charAt(0).toUpperCase()+A.slice(1))}}})});const m=Array.from(x);return P&&t&&!m.includes(t)&&m.push(t),m},ye=()=>{if(!i&&!t)return Array.isArray(T)?T:[];if(!Array.isArray(u))return[];let d=u;c&&(d=d.filter(g=>g&&g.category===c)),a&&(d=d.filter(g=>g&&g.name===a)),o&&(d=d.filter(g=>g&&g.manufacturer===o));const x=new Set,s=i?.toLowerCase(),m=t?.toLowerCase();d.forEach(g=>{g&&g.applications&&Array.isArray(g.applications)&&g.applications.forEach(k=>{const C=String(k).toLowerCase(),$=!s||C.includes(s),A=!m||C.includes(m);if($&&A){const ae=/\d{4}(?:-\d{4})?/g;(C.match(ae)||[]).forEach(se=>{if(se.includes("-")){const[Ee,Fe]=se.split("-").map(Number);for(let re=Ee;re<=Fe;re++)x.add(String(re))}else x.add(se)})}})});const v=Array.from(x).sort();return P&&l&&!v.includes(l)&&(v.push(l),v.sort()),v},Ce=d=>e.jsx("div",{className:"buscarpeca-modal-pecas",children:e.jsx("div",{className:"compat-results-grid",children:e.jsx(Ve,{pecas:d,onViewCompatibility:Me,onViewDetails:Se})})}),Se=d=>{me(d),de(!0)},Ae=()=>{de(!1),me(null)},Me=d=>{const x=typeof d=="object"&&d?d:U.find(m=>m.id===d);if(le("Compatibilidade"),!x||!x.applications){console.debug("[BuscarPeca] no applications for peca",x),ee(e.jsx("div",{children:"Nenhuma aplicaÃ§Ã£o encontrada."})),X(!0);return}const s=e.jsx("div",{className:"buscarpeca-compat-wrapper",children:e.jsx(qe,{applications:x.applications,usuarioLogado:r})});ee(s),X(!0)},ke=async d=>{if(d&&d.preventDefault&&d.preventDefault(),J(""),!(c||a||i||t||l||o)){J("Por favor, preencha pelo menos um campo para realizar a busca."),f(""),F(""),Q(""),H("");return}L(!0),E("");const s={grupo:c,categoria:a,marca:i,modelo:t,ano:l,fabricante:o};try{const m=await te.buscarPecasML(s);console.log("ðŸ” Filtros aplicados:",s),console.log("ðŸ“¦ Dados retornados:",m),console.log("ðŸ“‹ PeÃ§as encontradas:",m.pecas?.length||0),console.log("ðŸŒ Fonte:",m.source||"local");const v=m.pecas||[];if(v.length===0){const g=[];s.marca&&g.push(`Marca: ${s.marca}`),s.modelo&&g.push(`Modelo: ${s.modelo}`),s.ano&&g.push(`Ano: ${s.ano}`),s.grupo&&g.push(`Grupo: ${s.grupo}`),s.categoria&&g.push(`PeÃ§a: ${s.categoria}`),s.fabricante&&g.push(`Fabricante: ${s.fabricante}`);const k=g.length>0?`Nenhuma peÃ§a encontrada para: ${g.join(", ")}. Tente remover alguns filtros ou buscar por termos mais genÃ©ricos.`:"Nenhuma peÃ§a encontrada para os filtros selecionados.";E(k)}else B(v),le(`Encontradas ${v.length} peÃ§a(s)`),ee(Ce(v)),X(!0)}catch(m){console.error("âŒ Erro na busca:",m),E(m.message||"Erro ao buscar peÃ§as")}finally{L(!1)}},Le=()=>{p(""),w(""),j(""),b(""),N(""),y(""),B([]),E(""),f(""),F(""),Q(""),H(""),J("")};return e.jsxs(e.Fragment,{children:[r?e.jsx(_e,{}):e.jsx(Re,{}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content buscarpeca-section",children:[e.jsx("h2",{className:"page-title",children:"CatÃ¡logo de PeÃ§as"}),e.jsx("div",{className:"buscarpeca-intro",children:e.jsx("p",{children:"Encontre peÃ§as automotivas compatÃ­veis com seu veÃ­culo. Busque por marca, modelo e ano."})}),e.jsx(Qe,{selectedGrupo:c,setSelectedGrupo:p,selectedCategoria:a,setSelectedCategoria:w,selectedMarca:i,setSelectedMarca:j,selectedModelo:t,setSelectedModelo:b,selectedAno:l,setSelectedAno:N,selectedFabricante:o,setSelectedFabricante:y,grupos:S,todasPecas:ge(),marcas:Ne(),modelos:we(),anos:ye(),fabricantes:be(),onSearch:ke,onClear:Le,onCarroChange:V,loading:O,error:W,warningMarca:K,warningModelo:M,warningAno:ne,warningFabricante:ue,emptyFieldsWarning:pe})]})}),e.jsx(Ge,{show:fe,onClose:()=>X(!1),title:ce,titleIcon:ce==="Compatibilidade"?"./check.png":null,children:xe}),e.jsx(Ke,{isOpen:je,onClose:Ae,productId:ve})]})}export{ra as default};
