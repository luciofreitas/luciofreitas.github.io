const s="pf_user_cars";async function e(a){if(!a)return[];try{const t=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),o=await fetch(`${t}/api/users/${encodeURIComponent(a)}/cars-auto`);if(o.ok)return await o.json()}catch(t){console.warn("API getCars failed, falling back to localStorage:",t)}try{return JSON.parse(localStorage.getItem(s)||"{}")[a]||[]}catch(t){return console.error("Erro ao carregar carros:",t),[]}}async function c(a,t){if(!a)return!1;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"");if((await fetch(`${o}/api/users/${encodeURIComponent(a)}/cars`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({cars:t})})).ok)return!0}catch(o){console.warn("API saveCars failed, falling back to localStorage:",o)}try{const o=JSON.parse(localStorage.getItem(s)||"{}");return o[a]=t,localStorage.setItem(s,JSON.stringify(o)),!0}catch(o){return console.error("Erro ao salvar carros:",o),!1}}async function l(a,t){if(!a||!t)return null;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),n=await fetch(`${o}/api/users/${encodeURIComponent(a)}/cars-auto`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const r=await n.json();return console.log("üöó Car added via API automatically:",r),r}}catch(o){console.warn("Auto API addCar failed, falling back to localStorage:",o)}try{const o=await e(a),n={id:Date.now().toString()+Math.random().toString(36).substr(2,9),...t,createdAt:new Date().toISOString()};return o.push(n),await c(a,o),n}catch(o){return console.error("Erro ao adicionar carro:",o),null}}async function w(a,t){if(!a||!t)return!1;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"");if((await fetch(`${o}/api/users/${encodeURIComponent(a)}/cars/${encodeURIComponent(t)}`,{method:"DELETE"})).ok)return!0}catch(o){console.warn("API removeCar failed, falling back to localStorage:",o)}try{const n=(await e(a)).filter(r=>r.id!==t);return await c(a,n),!0}catch(o){return console.error("Erro ao remover carro:",o),!1}}async function d(a,t,o){if(!a||!t||!o)return!1;try{const r=(await e(a)).map(i=>i.id===t?{...i,...o,updatedAt:new Date().toISOString()}:i);return await c(a,r),!0}catch(n){return console.error("Erro ao atualizar carro:",n),!1}}async function f(a,t){if(!a||!t)return!1;try{const n=(await e(a)).map(r=>({...r,isDefault:r.id===t}));return await c(a,n),!0}catch(o){return console.error("Erro ao definir carro padr√£o:",o),!1}}export{l as a,e as g,w as r,f as s,d as u};
