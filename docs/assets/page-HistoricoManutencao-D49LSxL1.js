import{r as c,A as T,a as q,u as O,j as e,M as R}from"./index-Cx0psiek.js";import{M as B}from"./index.esm-wgFnErRE.js";import{g as p,u as z,a as P,d as Q}from"./maintenanceService-DOGDJ6m6.js";import{g as Y}from"./carService-B4lSvgg8.js";function U(){const{usuarioLogado:t}=c.useContext(T)||{},[l,v]=c.useState([]),[n,w]=c.useState([]),[M,N]=c.useState(!0),[F,d]=c.useState(!1),[u,f]=c.useState(null),[x,y]=c.useState("todos"),[D,j]=c.useState(""),[o,r]=c.useState({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),m=q(),b=O();c.useEffect(()=>{(async()=>{if(t){N(!0);try{const s=t.id||t.email,i=await Y(s);w(i);const h=await p(s);v(h)}catch(s){console.error("Erro ao carregar dados:",s)}finally{N(!1)}}})()},[t]),c.useEffect(()=>{try{const a=m&&m.state&&m.state.openMaintenanceId;if(a&&l&&l.length>0){const s=l.find(i=>String(i.id)===String(a));if(s){C(s);try{b(m.pathname+(window.location.hash||""),{replace:!0})}catch{}}}}catch{}},[m,l]);const I=async a=>{if(a.preventDefault(),!t)return;const s=t.id||t.email;try{if(u){await z(s,u,o);const i=await p(s);v(i)}else{await P(s,o);const i=await p(s);v(i)}g(),d(!1)}catch(i){console.error("Erro ao salvar manuten√ß√£o:",i),alert("Erro ao salvar manuten√ß√£o. Tente novamente.")}},C=a=>{const s=a&&(a.data||a.createdAt||new Date().toISOString());let i="";if(s){const h=new Date(s);if(!isNaN(h.getTime())){const V=h.getFullYear(),$=String(h.getMonth()+1).padStart(2,"0"),H=String(h.getDate()).padStart(2,"0");i=`${V}-${$}-${H}`}}r({...a,data:i}),f(a.id),j(a.veiculoId),d(!0)},E=async a=>{if(!window.confirm("Tem certeza que deseja excluir este registro?")||!t)return;const s=t.id||t.email;try{await Q(s,a);const i=await p(s);v(i)}catch(i){console.error("Erro ao deletar manuten√ß√£o:",i),alert("Erro ao deletar manuten√ß√£o. Tente novamente.")}},g=()=>{r({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),f(null),j("")},k=a=>{j(a),a&&r({...o,veiculoId:a})},A=a=>{const s=n.find(i=>String(i.id)===String(a));return s?`${s.marca} ${s.modelo} (${s.ano})`:"Ve√≠culo n√£o encontrado"},L=a=>{const s=a&&(a.data||a.createdAt||a.createdAt)||"",i=s?new Date(s):new Date;return isNaN(i.getTime())?new Date().toLocaleDateString("pt-BR"):i.toLocaleDateString("pt-BR")},S=[...x==="todos"?l:l.filter(a=>a.veiculoId===x)].sort((a,s)=>new Date(s.data)-new Date(a.data));return t?e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page historico-page",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsx("div",{className:"historico-intro",children:e.jsx("p",{children:"Mantenha um registro completo de todas as manuten√ß√µes, trocas de pe√ßas e servi√ßos realizados nos seus ve√≠culos. Esse hist√≥rico digital facilita o acompanhamento de revis√µes peri√≥dicas e aumenta o valor de revenda."})}),M?e.jsx("div",{className:"historico-loading",children:e.jsx("p",{children:"Carregando dados..."})}):n.length===0?e.jsxs("div",{className:"historico-no-cars",children:[e.jsx("p",{children:"Voc√™ ainda n√£o possui ve√≠culos cadastrados."}),e.jsx("p",{children:"Cadastre seu primeiro ve√≠culo para come√ßar a registrar manuten√ß√µes."}),e.jsx("button",{onClick:()=>b("/meus-carros"),className:"historico-add-car-btn",children:"üìù Ir para Meus Carros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historico-actions",children:[e.jsxs("div",{className:"historico-filters",children:[e.jsx("label",{htmlFor:"filtro-veiculo",children:"Filtrar por ve√≠culo:"}),e.jsxs("select",{id:"filtro-veiculo",value:x,onChange:a=>y(a.target.value),className:"historico-select",children:[e.jsx("option",{value:"todos",children:"Todos os ve√≠culos"}),n.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsx("button",{className:"historico-add-btn",onClick:()=>{g(),d(!0)},children:"+ Nova Manuten√ß√£o"})]}),S.length===0?e.jsxs("div",{className:"historico-empty",children:[e.jsx("p",{children:"Nenhuma manuten√ß√£o registrada ainda."}),e.jsx("p",{children:'Clique em "Nova Manuten√ß√£o" para come√ßar.'})]}):e.jsx("div",{className:"historico-list",children:S.map(a=>e.jsxs("div",{className:"historico-card",children:[e.jsxs("div",{className:"historico-card-header",children:[e.jsx("div",{className:"historico-card-veiculo",children:A(a.veiculoId)}),e.jsx("div",{className:"historico-card-data",children:L(a)})]}),e.jsxs("div",{className:"historico-card-body",children:[e.jsx("div",{className:"historico-card-tipo",children:e.jsx("span",{className:`historico-tipo-badge ${a.tipo}`,children:a.tipo==="preventiva"?"Preventiva":a.tipo==="corretiva"?"Corretiva":"Outro"})}),e.jsxs("div",{className:"historico-card-descricao",children:[e.jsx("strong",{children:"Descri√ß√£o:"})," ",a.descricao]}),a.kmAtual&&e.jsxs("div",{className:"historico-card-km",children:[e.jsx("strong",{children:"Quilometragem:"})," ",parseInt(a.kmAtual).toLocaleString("pt-BR")," km"]}),a.oficina&&e.jsxs("div",{className:"historico-card-oficina",children:[e.jsx("strong",{children:"Oficina:"})," ",a.oficina]}),a.valor&&e.jsxs("div",{className:"historico-card-valor",children:[e.jsx("strong",{children:"Valor:"})," R$ ",parseFloat(a.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.observacoes&&e.jsxs("div",{className:"historico-card-obs",children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",a.observacoes]})]}),e.jsxs("div",{className:"historico-card-actions",children:[e.jsx("button",{className:"historico-edit-btn",onClick:()=>C(a),children:"Editar"}),e.jsx("button",{className:"historico-delete-btn",onClick:()=>E(a.id),children:"Excluir"})]})]},a.id))})]}),F&&e.jsx("div",{className:"historico-modal-overlay",onClick:()=>d(!1),children:e.jsxs("div",{className:"historico-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"historico-modal-header",children:[e.jsx("h3",{children:u?"Editar Manuten√ß√£o":"Nova Manuten√ß√£o"}),e.jsx("button",{className:"historico-modal-close",onClick:()=>d(!1),children:"√ó"})]}),e.jsxs("form",{onSubmit:I,className:"historico-form",children:[!u&&n.length>0&&e.jsxs("div",{className:"historico-form-group historico-car-helper",children:[e.jsx("label",{htmlFor:"carroHelper",children:"üöó Selecione um ve√≠culo cadastrado (facilita o preenchimento)"}),e.jsxs("select",{id:"carroHelper",value:D,onChange:a=>k(a.target.value),className:"historico-input historico-car-selector",children:[e.jsx("option",{value:"",children:"-- Selecione um carro cadastrado --"}),n.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")",a.isDefault?" ‚≠ê":""]},a.id))]}),e.jsx("small",{className:"historico-helper-text",children:'Ao selecionar um ve√≠culo, o campo "Ve√≠culo" ser√° preenchido automaticamente'})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"veiculoId",children:"Ve√≠culo *"}),e.jsxs("select",{id:"veiculoId",value:o.veiculoId,onChange:a=>r({...o,veiculoId:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"",children:"Selecione um ve√≠culo"}),n.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"data",children:"Data *"}),e.jsx("input",{type:"date",id:"data",value:o.data,onChange:a=>r({...o,data:a.target.value}),required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",value:o.tipo,onChange:a=>r({...o,tipo:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"preventiva",children:"Preventiva"}),e.jsx("option",{value:"corretiva",children:"Corretiva"}),e.jsx("option",{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"descricao",children:"Descri√ß√£o *"}),e.jsx("input",{type:"text",id:"descricao",value:o.descricao,onChange:a=>r({...o,descricao:a.target.value}),placeholder:"Ex: Troca de √≥leo e filtro",required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"kmAtual",children:"Quilometragem"}),e.jsx("input",{type:"number",id:"kmAtual",value:o.kmAtual,onChange:a=>r({...o,kmAtual:a.target.value}),placeholder:"Ex: 50000",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"valor",children:"Valor (R$)"}),e.jsx("input",{type:"number",step:"0.01",id:"valor",value:o.valor,onChange:a=>r({...o,valor:a.target.value}),placeholder:"Ex: 150.00",className:"historico-input"})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"oficina",children:"Oficina/Local"}),e.jsx("input",{type:"text",id:"oficina",value:o.oficina,onChange:a=>r({...o,oficina:a.target.value}),placeholder:"Ex: Auto Center XYZ",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"observacoes",children:"Observa√ß√µes"}),e.jsx("textarea",{id:"observacoes",value:o.observacoes,onChange:a=>r({...o,observacoes:a.target.value}),placeholder:"Informa√ß√µes adicionais sobre a manuten√ß√£o",rows:"3",className:"historico-textarea"})]}),e.jsxs("div",{className:"historico-form-actions",children:[e.jsx("button",{type:"button",className:"historico-cancel-btn",onClick:()=>{g(),d(!1)},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"historico-save-btn",children:u?"Salvar Altera√ß√µes":"Adicionar Manuten√ß√£o"})]})]})]})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsxs("div",{className:"historico-login-required",children:[e.jsx("p",{children:"Voc√™ precisa estar logado para acessar o hist√≥rico de manuten√ß√£o."}),e.jsx("a",{href:"/#/login",className:"historico-login-btn",children:"Fazer Login"})]})]})})]})}export{U as default};
