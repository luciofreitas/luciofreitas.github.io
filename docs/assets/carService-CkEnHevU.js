const l="pf_user_cars";async function s(t){if(!t)return[];try{const a=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),o=await fetch(`${a}/api/users/${encodeURIComponent(t)}/cars-auto`);if(o.ok)return await o.json()}catch(a){console.warn("API getCars failed, falling back to localStorage:",a)}try{return JSON.parse(localStorage.getItem(l)||"{}")[t]||[]}catch(a){return console.error("Erro ao carregar carros:",a),[]}}async function c(t,a){if(!t)return!1;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"");if((await fetch(`${o}/api/users/${encodeURIComponent(t)}/cars`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({cars:a})})).ok)return!0}catch(o){console.warn("API saveCars failed, falling back to localStorage:",o)}try{const o=JSON.parse(localStorage.getItem(l)||"{}");return o[t]=a,localStorage.setItem(l,JSON.stringify(o)),!0}catch(o){return console.error("Erro ao salvar carros:",o),!1}}async function i(t,a){if(!t||!a)return null;try{const o=typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:""),e=await fetch(`${o}/api/users/${encodeURIComponent(t)}/cars-auto`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok){const r=await e.json();return console.log("üöó Car added via API automatically:",r),r}}catch(o){console.warn("Auto API addCar failed, falling back to localStorage:",o)}try{const o=await s(t),e={id:Date.now().toString()+Math.random().toString(36).substr(2,9),...a,createdAt:new Date().toISOString()};return o.push(e),await c(t,o),e}catch(o){return console.error("Erro ao adicionar carro:",o),null}}async function w(t,a){if(!t||!a)return console.error("üóëÔ∏è removeCar: Missing userId or carId",{userId:t,carId:a}),!1;console.log(`üóëÔ∏è AUTO-REMOVE: Attempting to remove car ${a} for user ${t}`);try{const e=`${typeof window<"u"&&window.__API_BASE||(typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?`${window.location.protocol}//${window.location.hostname}:3001`:"")}/api/users/${encodeURIComponent(t)}/cars-auto/${encodeURIComponent(a)}`;console.log(`üóëÔ∏è DELETE URL: ${e}`);const r=await fetch(e,{method:"DELETE"});if(console.log(`üóëÔ∏è DELETE Response: ${r.status} ${r.statusText}`),r.ok){const n=await r.json();return console.log("üóëÔ∏è Car deleted via API automatically:",n),!0}else{const n=await r.text();console.error("üóëÔ∏è DELETE API failed:",r.status,n)}}catch(o){console.error("üóëÔ∏è API removeCar failed, falling back to localStorage:",o)}console.log("üóëÔ∏è Falling back to localStorage removal");try{const o=await s(t);console.log(`üóëÔ∏è Current cars in localStorage: ${o.length}`);const e=o.filter(r=>r.id!==a);return console.log(`üóëÔ∏è Cars after filtering: ${e.length}`),await c(t,e),console.log("üóëÔ∏è Car removed from localStorage successfully"),!0}catch(o){return console.error("üóëÔ∏è Erro ao remover carro do localStorage:",o),!1}}async function d(t,a,o){if(!t||!a||!o)return!1;try{const r=(await s(t)).map(n=>n.id===a?{...n,...o,updatedAt:new Date().toISOString()}:n);return await c(t,r),!0}catch(e){return console.error("Erro ao atualizar carro:",e),!1}}async function f(t,a){if(!t||!a)return!1;try{const e=(await s(t)).map(r=>({...r,isDefault:r.id===a}));return await c(t,e),!0}catch(o){return console.error("Erro ao definir carro padr√£o:",o),!1}}export{i as a,s as g,w as r,f as s,d as u};
