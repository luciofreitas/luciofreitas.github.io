import{r as h,A,u as O,j as e,M as I}from"./index-DGPunZac.js";import{M as V}from"./index.esm-o8hKI7DH.js";import{g as L}from"./carService-CkEnHevU.js";const g="pf_maintenances";async function u(s){if(!s)return[];try{return JSON.parse(localStorage.getItem(g)||"{}")[s]||[]}catch(t){return console.error("Erro ao carregar manuten√ß√µes:",t),[]}}async function f(s,t){if(!s)return!1;try{const i=JSON.parse(localStorage.getItem(g)||"{}");return i[s]=t,localStorage.setItem(g,JSON.stringify(i)),!0}catch(i){return console.error("Erro ao salvar manuten√ß√µes:",i),!1}}async function q(s,t){if(!s||!t)return null;try{const i=await u(s),n={...t,id:Date.now().toString(),createdAt:new Date().toISOString()},l=[...i,n];return await f(s,l),n}catch(i){return console.error("Erro ao adicionar manuten√ß√£o:",i),null}}async function R(s,t,i){if(!s||!t)return!1;try{const l=(await u(s)).map(v=>v.id===t?{...v,...i,updatedAt:new Date().toISOString()}:v);return await f(s,l),!0}catch(n){return console.error("Erro ao atualizar manuten√ß√£o:",n),!1}}async function T(s,t){if(!s||!t)return!1;try{const n=(await u(s)).filter(l=>l.id!==t);return await f(s,n),!0}catch(i){return console.error("Erro ao deletar manuten√ß√£o:",i),!1}}function J(){const{usuarioLogado:s}=h.useContext(A)||{},t=O(),[i,n]=h.useState([]),[l,v]=h.useState([]),[C,N]=h.useState(!0),[y,m]=h.useState(!1),[p,b]=h.useState(null),[x,S]=h.useState("todos"),[r,d]=h.useState({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""});h.useEffect(()=>{(async()=>{if(s){N(!0);try{const o=s.id||s.email,c=await L(o);v(c);const D=await u(o);n(D)}catch(o){console.error("Erro ao carregar dados:",o)}finally{N(!1)}}})()},[s]);const E=async a=>{if(a.preventDefault(),!s)return;const o=s.id||s.email;try{if(p){await R(o,p,r);const c=await u(o);n(c)}else{await q(o,r);const c=await u(o);n(c)}j(),m(!1)}catch(c){console.error("Erro ao salvar manuten√ß√£o:",c),alert("Erro ao salvar manuten√ß√£o. Tente novamente.")}},M=a=>{d(a),b(a.id),m(!0)},F=async a=>{if(!window.confirm("Tem certeza que deseja excluir este registro?")||!s)return;const o=s.id||s.email;try{await T(o,a);const c=await u(o);n(c)}catch(c){console.error("Erro ao deletar manuten√ß√£o:",c),alert("Erro ao deletar manuten√ß√£o. Tente novamente.")}},j=()=>{d({veiculoId:"",data:"",tipo:"preventiva",descricao:"",kmAtual:"",oficina:"",valor:"",observacoes:""}),b(null)},k=a=>{const o=l.find(c=>c.id===a);return o?`${o.marca} ${o.modelo} (${o.ano})`:"Ve√≠culo n√£o encontrado"},w=[...x==="todos"?i:i.filter(a=>a.veiculoId===x)].sort((a,o)=>new Date(o.data)-new Date(a.data));return s?e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx("div",{className:"site-header-spacer"}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsx("div",{className:"historico-intro",children:e.jsx("p",{children:"Mantenha um registro completo de todas as manuten√ß√µes, trocas de pe√ßas e servi√ßos realizados nos seus ve√≠culos. Esse hist√≥rico digital facilita o acompanhamento de revis√µes peri√≥dicas e aumenta o valor de revenda."})}),C?e.jsx("div",{className:"historico-loading",children:e.jsx("p",{children:"Carregando dados..."})}):l.length===0?e.jsxs("div",{className:"historico-no-cars",children:[e.jsx("p",{children:"Voc√™ ainda n√£o possui ve√≠culos cadastrados."}),e.jsx("p",{children:"Cadastre seu primeiro ve√≠culo para come√ßar a registrar manuten√ß√µes."}),e.jsx("button",{onClick:()=>t("/meus-carros"),className:"historico-add-car-btn",children:"üìù Ir para Meus Carros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"historico-actions",children:[e.jsxs("div",{className:"historico-filters",children:[e.jsx("label",{htmlFor:"filtro-veiculo",children:"Filtrar por ve√≠culo:"}),e.jsxs("select",{id:"filtro-veiculo",value:x,onChange:a=>S(a.target.value),className:"historico-select",children:[e.jsx("option",{value:"todos",children:"Todos os ve√≠culos"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsx("button",{className:"historico-add-btn",onClick:()=>{j(),m(!0)},children:"+ Nova Manuten√ß√£o"})]}),w.length===0?e.jsxs("div",{className:"historico-empty",children:[e.jsx("p",{children:"Nenhuma manuten√ß√£o registrada ainda."}),e.jsx("p",{children:'Clique em "Nova Manuten√ß√£o" para come√ßar.'})]}):e.jsx("div",{className:"historico-list",children:w.map(a=>e.jsxs("div",{className:"historico-card",children:[e.jsxs("div",{className:"historico-card-header",children:[e.jsx("div",{className:"historico-card-veiculo",children:k(a.veiculoId)}),e.jsx("div",{className:"historico-card-data",children:new Date(a.data).toLocaleDateString("pt-BR")})]}),e.jsxs("div",{className:"historico-card-body",children:[e.jsx("div",{className:"historico-card-tipo",children:e.jsx("span",{className:`historico-tipo-badge ${a.tipo}`,children:a.tipo==="preventiva"?"Preventiva":a.tipo==="corretiva"?"Corretiva":"Outro"})}),e.jsxs("div",{className:"historico-card-descricao",children:[e.jsx("strong",{children:"Descri√ß√£o:"})," ",a.descricao]}),a.kmAtual&&e.jsxs("div",{className:"historico-card-km",children:[e.jsx("strong",{children:"Quilometragem:"})," ",parseInt(a.kmAtual).toLocaleString("pt-BR")," km"]}),a.oficina&&e.jsxs("div",{className:"historico-card-oficina",children:[e.jsx("strong",{children:"Oficina:"})," ",a.oficina]}),a.valor&&e.jsxs("div",{className:"historico-card-valor",children:[e.jsx("strong",{children:"Valor:"})," R$ ",parseFloat(a.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),a.observacoes&&e.jsxs("div",{className:"historico-card-obs",children:[e.jsx("strong",{children:"Observa√ß√µes:"})," ",a.observacoes]})]}),e.jsxs("div",{className:"historico-card-actions",children:[e.jsx("button",{className:"historico-edit-btn",onClick:()=>M(a),children:"Editar"}),e.jsx("button",{className:"historico-delete-btn",onClick:()=>F(a.id),children:"Excluir"})]})]},a.id))})]}),y&&e.jsx("div",{className:"historico-modal-overlay",onClick:()=>m(!1),children:e.jsxs("div",{className:"historico-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"historico-modal-header",children:[e.jsx("h3",{children:p?"Editar Manuten√ß√£o":"Nova Manuten√ß√£o"}),e.jsx("button",{className:"historico-modal-close",onClick:()=>m(!1),children:"√ó"})]}),e.jsxs("form",{onSubmit:E,className:"historico-form",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"veiculoId",children:"Ve√≠culo *"}),e.jsxs("select",{id:"veiculoId",value:r.veiculoId,onChange:a=>d({...r,veiculoId:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"",children:"Selecione um ve√≠culo"}),l.map(a=>e.jsxs("option",{value:a.id,children:[a.marca," ",a.modelo," (",a.ano,")"]},a.id))]})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"data",children:"Data *"}),e.jsx("input",{type:"date",id:"data",value:r.data,onChange:a=>d({...r,data:a.target.value}),required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",value:r.tipo,onChange:a=>d({...r,tipo:a.target.value}),required:!0,className:"historico-input",children:[e.jsx("option",{value:"preventiva",children:"Preventiva"}),e.jsx("option",{value:"corretiva",children:"Corretiva"}),e.jsx("option",{value:"outro",children:"Outro"})]})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"descricao",children:"Descri√ß√£o *"}),e.jsx("input",{type:"text",id:"descricao",value:r.descricao,onChange:a=>d({...r,descricao:a.target.value}),placeholder:"Ex: Troca de √≥leo e filtro",required:!0,className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-row",children:[e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"kmAtual",children:"Quilometragem"}),e.jsx("input",{type:"number",id:"kmAtual",value:r.kmAtual,onChange:a=>d({...r,kmAtual:a.target.value}),placeholder:"Ex: 50000",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"valor",children:"Valor (R$)"}),e.jsx("input",{type:"number",step:"0.01",id:"valor",value:r.valor,onChange:a=>d({...r,valor:a.target.value}),placeholder:"Ex: 150.00",className:"historico-input"})]})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"oficina",children:"Oficina/Local"}),e.jsx("input",{type:"text",id:"oficina",value:r.oficina,onChange:a=>d({...r,oficina:a.target.value}),placeholder:"Ex: Auto Center XYZ",className:"historico-input"})]}),e.jsxs("div",{className:"historico-form-group",children:[e.jsx("label",{htmlFor:"observacoes",children:"Observa√ß√µes"}),e.jsx("textarea",{id:"observacoes",value:r.observacoes,onChange:a=>d({...r,observacoes:a.target.value}),placeholder:"Informa√ß√µes adicionais sobre a manuten√ß√£o",rows:"3",className:"historico-textarea"})]}),e.jsxs("div",{className:"historico-form-actions",children:[e.jsx("button",{type:"button",className:"historico-cancel-btn",onClick:()=>{j(),m(!1)},children:"Cancelar"}),e.jsx("button",{type:"submit",className:"historico-save-btn",children:p?"Salvar Altera√ß√µes":"Adicionar Manuten√ß√£o"})]})]})]})})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx("div",{className:"page-wrapper",children:e.jsxs("div",{className:"page-content historico-section",children:[e.jsx("h2",{className:"page-title",children:"Hist√≥rico de Manuten√ß√£o"}),e.jsxs("div",{className:"historico-login-required",children:[e.jsx("p",{children:"Voc√™ precisa estar logado para acessar o hist√≥rico de manuten√ß√£o."}),e.jsx("a",{href:"/login",className:"historico-login-btn",children:"Fazer Login"})]})]})})]})}export{J as default};
