import{u as w,a as M,e as k,r as i,A as y,j as e,M as C}from"./index-q4vRdyBN.js";const j="http://localhost:3001",L=async s=>{try{if(!s)throw new Error("userId is required");const a=await fetch(`${j}/api/ml/auth?userId=${encodeURIComponent(s)}`);if(!a.ok){const r=await a.json();throw new Error(r.error||"Failed to initiate ML auth")}const o=await a.json();o.state&&sessionStorage.setItem("ml_oauth_state",o.state),window.location.href=o.authUrl}catch(a){throw console.error("Error initiating ML auth:",a),a}},b=async()=>{try{const s=p();if(s&&s.accessToken)try{await fetch(`${j}/api/ml/revoke`,{method:"POST",headers:{Authorization:`Bearer ${s.accessToken}`}})}catch(a){console.warn("Failed to revoke ML token:",a)}v()}catch(s){throw console.error("Error disconnecting ML:",s),v(),s}},h=()=>{const s=p();return!s||!s.accessToken?{connected:!1,expired:!1}:{connected:!0,expired:s.expiresAt&&Date.now()>s.expiresAt,connectedAt:s.connectedAt,expiresAt:s.expiresAt,userId:s.userId}},p=()=>{try{const s=localStorage.getItem("ml_token_data");return s?JSON.parse(s):null}catch(s){return console.error("Error parsing stored ML tokens:",s),null}},v=()=>{localStorage.removeItem("ml_token_data"),sessionStorage.removeItem("ml_oauth_state"),console.log("ML tokens cleared")};function S(){const s=w(),a=M(),{theme:o,toggleTheme:r,isDark:c}=k(),{usuarioLogado:l}=i.useContext(y)||{},[t,d]=i.useState(null),[m,x]=i.useState(!1),[u,g]=i.useState(!1);i.useEffect(()=>{const n=h();d(n),new URLSearchParams(a.search).get("ml_success")==="true"&&(g(!0),d(h()),setTimeout(()=>g(!1),5e3),s("/configuracoes",{replace:!0}))},[a,s]);const f=async()=>{try{if(!l||!l.id){alert("Usuário não autenticado");return}x(!0),await L(l.id)}catch(n){console.error("Error connecting to ML:",n),alert("Erro ao conectar com Mercado Livre. Tente novamente."),x(!1)}},N=async()=>{try{confirm("Deseja realmente desconectar sua conta do Mercado Livre?")&&(await b(),d(h()),alert("Conta do Mercado Livre desconectada com sucesso!"))}catch(n){console.error("Error disconnecting from ML:",n),alert("Erro ao desconectar. Tente novamente.")}};return e.jsxs(e.Fragment,{children:[e.jsx(C,{}),e.jsx("div",{className:"page-wrapper",children:e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"config-container",children:[e.jsxs("div",{className:"config-header",children:[e.jsxs("button",{className:"config-back-btn",onClick:()=>s(-1),"aria-label":"Voltar",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"})}),"Voltar"]}),e.jsx("h1",{className:"config-title",children:"Configurações"}),e.jsx("p",{className:"config-subtitle",children:"Personalize sua experiência no Garagem Smart"})]}),e.jsxs("div",{className:"config-sections",children:[e.jsxs("section",{className:"config-section",children:[e.jsxs("div",{className:"config-section-header",children:[e.jsx("div",{className:"config-section-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),e.jsxs("div",{className:"config-section-info",children:[e.jsx("h2",{className:"config-section-title",children:"Aparência"}),e.jsx("p",{className:"config-section-description",children:"Escolha o tema que melhor se adapta ao seu estilo"})]})]}),e.jsxs("div",{className:"config-option",children:[e.jsx("div",{className:"config-option-content",children:e.jsxs("label",{htmlFor:"theme-toggle",className:"config-option-label",children:[e.jsx("span",{className:"config-option-title",children:"Modo Escuro"}),e.jsx("span",{className:"config-option-description",children:c?"Ativado - Interface com cores escuras":"Desativado - Interface com cores claras"})]})}),e.jsxs("div",{className:"theme-toggle-wrapper",children:[e.jsx("input",{type:"checkbox",id:"theme-toggle",className:"theme-toggle-input",checked:c,onChange:r,"aria-label":"Alternar modo escuro"}),e.jsx("label",{htmlFor:"theme-toggle",className:"theme-toggle-label",children:e.jsx("span",{className:"theme-toggle-button",children:e.jsx("span",{className:"theme-toggle-icon",children:c?e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:e.jsx("path",{d:"M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"})}):e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:e.jsx("path",{d:"M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"})})})})})]})]}),e.jsxs("div",{className:"theme-preview",children:[e.jsxs("div",{className:`theme-preview-card ${c?"":"active"}`,children:[e.jsxs("div",{className:"theme-preview-header light",children:[e.jsx("div",{className:"theme-preview-dot"}),e.jsx("div",{className:"theme-preview-dot"}),e.jsx("div",{className:"theme-preview-dot"})]}),e.jsxs("div",{className:"theme-preview-body light",children:[e.jsx("div",{className:"theme-preview-line light"}),e.jsx("div",{className:"theme-preview-line light short"})]}),e.jsx("span",{className:"theme-preview-label",children:"Claro"})]}),e.jsxs("div",{className:`theme-preview-card ${c?"active":""}`,children:[e.jsxs("div",{className:"theme-preview-header dark",children:[e.jsx("div",{className:"theme-preview-dot"}),e.jsx("div",{className:"theme-preview-dot"}),e.jsx("div",{className:"theme-preview-dot"})]}),e.jsxs("div",{className:"theme-preview-body dark",children:[e.jsx("div",{className:"theme-preview-line dark"}),e.jsx("div",{className:"theme-preview-line dark short"})]}),e.jsx("span",{className:"theme-preview-label",children:"Escuro"})]})]})]}),e.jsxs("section",{className:"config-section",children:[e.jsxs("div",{className:"config-section-header",children:[e.jsx("div",{className:"config-section-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"}),e.jsx("circle",{cx:"4",cy:"4",r:"2"})]})}),e.jsxs("div",{className:"config-section-info",children:[e.jsx("h2",{className:"config-section-title",children:"Integrações"}),e.jsx("p",{className:"config-section-description",children:"Conecte sua conta com serviços externos"})]})]}),u&&e.jsxs("div",{className:"ml-success-banner",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"Mercado Livre conectado com sucesso!"})]}),e.jsxs("div",{className:"integration-card",children:[e.jsxs("div",{className:"integration-info",children:[e.jsx("div",{className:"integration-logo",children:"ML"}),e.jsxs("div",{children:[e.jsx("h3",{className:"integration-title",children:"Mercado Livre"}),e.jsx("p",{className:"integration-description",children:t?.connected?t.expired?"Conexão expirada - Reconecte para continuar":"Conta conectada e ativa":"Conecte sua conta para acessar funcionalidades adicionais"}),t?.connected&&t?.connectedAt&&e.jsxs("p",{className:"integration-meta",children:["Conectado em: ",new Date(t.connectedAt).toLocaleDateString("pt-BR")]})]})]}),t?.connected?e.jsx("button",{className:"integration-btn disconnect",onClick:N,children:"Desconectar"}):e.jsx("button",{className:"integration-btn connect",onClick:f,disabled:m,children:m?"Conectando...":"Conectar"})]})]}),e.jsx("section",{className:"config-section config-section-disabled",children:e.jsxs("div",{className:"config-section-header",children:[e.jsx("div",{className:"config-section-icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),e.jsx("path",{d:"M2 17l10 5 10-5M2 12l10 5 10-5"})]})}),e.jsxs("div",{className:"config-section-info",children:[e.jsx("h2",{className:"config-section-title",children:"Mais Configurações"}),e.jsx("p",{className:"config-section-description",children:"Em breve mais opções de personalização"})]})]})})]})]})})})]})}export{S as default};
