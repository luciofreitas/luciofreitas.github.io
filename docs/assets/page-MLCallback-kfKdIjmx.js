import{u as f,a as y,r as s,A as k,j as e}from"./index-DQuTNYeI.js";const S=()=>{const o=f(),u=y(),{usuarioLogado:n}=s.useContext(k)||{},[a,t]=s.useState("processing"),[g,c]=s.useState(null);return s.useEffect(()=>{(async()=>{try{const r=new URLSearchParams(u.search),i=r.get("access_token"),m=r.get("refresh_token"),l=r.get("expires_in"),d=r.get("ml_error")||r.get("error");if(d){console.error("ML OAuth error:",d),c(`Erro na autorização: ${d}`),t("error"),setTimeout(()=>o("/#/configuracoes"),3e3);return}if(!i){console.error("No access token received"),c("Nenhum token de acesso recebido"),t("error"),setTimeout(()=>o("/#/configuracoes"),3e3);return}const h=Date.now()+parseInt(l)*1e3,x={accessToken:i,refreshToken:m,expiresIn:parseInt(l),expiresAt:h,userId:n?.id,connectedAt:new Date().toISOString()};localStorage.setItem("ml_token_data",JSON.stringify(x)),console.log("ML tokens stored successfully");try{await fetch("https://luciofreitas-github-io.onrender.com/api/ml/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:i,refresh_token:m,expires_in:parseInt(l),userId:n?.id})}),console.log("ML token sent to backend for persistence")}catch(p){console.warn("Failed to send ML token to backend:",p)}t("success"),setTimeout(()=>o("/#/configuracoes?ml_success=true"),1500)}catch(r){console.error("Error processing ML callback:",r),c("Erro ao processar autorização"),t("error"),setTimeout(()=>o("/#/configuracoes"),3e3)}})()},[u,o,n]),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",padding:"2rem",backgroundColor:"#f5f5f5"},children:[e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"3rem",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",maxWidth:"500px",textAlign:"center"},children:[a==="processing"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"60px",height:"60px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1.5rem"}}),e.jsx("h2",{style:{color:"#333",marginBottom:"1rem"},children:"Processando autorização..."}),e.jsx("p",{style:{color:"#666"},children:"Aguarde enquanto conectamos sua conta do Mercado Livre"})]}),a==="success"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"60px",height:"60px",backgroundColor:"#27ae60",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},children:e.jsx("span",{style:{color:"white",fontSize:"2rem"},children:"✓"})}),e.jsx("h2",{style:{color:"#27ae60",marginBottom:"1rem"},children:"Conexão realizada com sucesso!"}),e.jsx("p",{style:{color:"#666"},children:"Sua conta do Mercado Livre foi conectada. Redirecionando..."})]}),a==="error"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"60px",height:"60px",backgroundColor:"#e74c3c",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},children:e.jsx("span",{style:{color:"white",fontSize:"2rem"},children:"✕"})}),e.jsx("h2",{style:{color:"#e74c3c",marginBottom:"1rem"},children:"Erro na conexão"}),e.jsx("p",{style:{color:"#666"},children:g||"Ocorreu um erro ao conectar com o Mercado Livre"}),e.jsx("p",{style:{color:"#999",fontSize:"0.9rem",marginTop:"1rem"},children:"Redirecionando para configurações..."})]})]}),e.jsx("style",{children:`
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `})]})};export{S as default};
