import{r as p,j as a,u as S,A as y}from"./index-BjzxRI5r.js";import{M as k}from"./index.esm-C0Y5t7xP.js";import{o as V}from"./glossarioData-8VebtgBN.js";import{u as F}from"./useAvaliacoes-CTxDtDCu.js";import{g}from"./guiasService-DAw1oR7r.js";const G=({guiaId:t,mediaAtual:o,totalVotos:x,votosUsuario:h,onAvaliar:N,somenteLeitura:d=!1})=>{const[u,c]=p.useState(0),n=h[t]!==void 0,m=r=>{if(console.debug("[ComponenteEstrelas] click",{guiaId:t,estrela:r,somenteLeitura:d,jaVotou:n}),!d)try{N(t,r)}catch(j){console.warn("[ComponenteEstrelas] onAvaliar threw",j)}},b=r=>{const j=r<=(u||o),f=n?r<=h[t]?"#FFAB00":"#d1d5db":j?"#FFAB00":"#d1d5db";return a.jsx("button",{type:"button","aria-label":`${r} ${r===1?"estrela":"estrelas"}`,className:`estrela ${!d&&!n?"estrela-interativa":""}`,style:{color:f,fontSize:"1.2rem"},onClick:()=>m(r),onMouseEnter:()=>!d&&!n&&c(r),onMouseLeave:()=>!d&&!n&&c(0),children:"‚òÖ"},r)};return a.jsxs("div",{className:"sistema-avaliacao",children:[a.jsx("div",{className:"estrelas-container",children:[1,2,3,4,5].map(b)}),a.jsxs("div",{className:"avaliacao-info",children:[a.jsx("span",{className:"media-nota",children:o.toFixed(1)}),a.jsxs("span",{className:"total-votos",children:["(",x," avalia√ß√£o",x!==1?"√µes":"",")"]})]}),n&&a.jsxs("div",{className:"voto-confirmado",children:["Sua avalia√ß√£o: ",h[t]," ‚òÖ"]})]})};function M(){const t=S(),{usuarioLogado:o}=p.useContext(y)||{},{avaliacoes:x,votosUsuario:h,avaliarGuia:N}=F(o?.email),[d,u]=p.useState([]),[c,n]=p.useState(""),m=!!(o&&o.isPro||localStorage.getItem("versaoProAtiva")==="true");p.useEffect(()=>{let s=!0;return(async()=>{try{const e=await g.getVisibleGuias(o?.email);s&&u(e||[])}catch(e){console.error("Erro ao carregar guias vis√≠veis:",e),s&&u([])}})(),()=>{s=!1}},[o]);const r=[{id:"glossario-automotivo",titulo:"Luzes do Painel",subtitulo:"Entenda os avisos do seu ve√≠culo",descricao:"Aprenda sobre as luzes de aviso do painel e o que fazer quando elas acendem.",icone:"‚ö†Ô∏è",categoria:"Diagn√≥stico",rota:"/luzes-do-painel"},...V],j=(s,e)=>{if(!o?.email){alert("Fa√ßa login para avaliar guias");return}try{N(s,e)}catch(i){console.warn("avaliarGuia hook failed:",i)}(async()=>{try{const i=await g.addRating(s,o.email,e);u(l=>l.map(v=>v.id===s?{...v,...i||{}}:v))}catch(i){console.warn("guiaService.addRating failed:",i)}})(),(async()=>{try{const i=await g.getVisibleGuias(o?.email);u(i||[])}catch(i){console.error("Erro ao recarregar guias ap√≥s avalia√ß√£o:",i)}})(),u(i=>i.map(l=>{if(l.id!==s||(l.ratings||[]).some(z=>z.userEmail===o.email))return l;const C={userEmail:o.email,rating:e,timestamp:new Date().toISOString()};return{...l,ratings:[...l.ratings||[],C]}}))},f=s=>{g.incrementViews(s),t(`/guia/${s}`)},E=s=>{if(!c.trim())return s;const e=c.toLowerCase().trim();return s.filter(i=>i.titulo?.toLowerCase().includes(e)||i.subtitulo?.toLowerCase().includes(e)||i.descricao?.toLowerCase().includes(e)||i.categoria?.toLowerCase().includes(e))},w=E(r),A=E(d);return a.jsxs(a.Fragment,{children:[a.jsx(k,{}),a.jsx("div",{className:"site-header-spacer"}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsxs("div",{className:"page-content",children:[a.jsx("h2",{className:"page-title",children:"Guias"}),a.jsx("div",{className:"guias-intro-wrapper",children:a.jsx("div",{className:"guias-intro",children:a.jsx("p",{children:"Encontre guias completos sobre manuten√ß√£o, diagn√≥stico, pe√ßas e tudo relacionado ao seu ve√≠culo."})})}),!m&&a.jsxs("div",{className:"guias-pro-notice",children:[a.jsx("div",{className:"pro-notice-icon",children:"‚≠ê"}),a.jsxs("div",{className:"pro-notice-content",children:[a.jsx("h3",{children:"Crie seus pr√≥prios guias!"}),a.jsxs("p",{children:["Assinantes ",a.jsx("strong",{children:"Pro"})," podem ",a.jsx("span",{className:"highlight-orange",children:"criar"})," e ",a.jsx("span",{className:"highlight-orange",children:"compartilhar"})," guias customizados com a comunidade.",a.jsx("a",{className:"btn-seja-pro-inline",href:"#/versao-pro",children:"Vers√£o Pro ‚Üí"})]})]})]}),m&&a.jsx("div",{className:"criar-guia-section",children:a.jsx("button",{className:"btn-criar-guia",onClick:()=>t("/criar-guia"),children:"‚úèÔ∏è Criar Novo Guia"})}),a.jsx("div",{className:"guias-search-section",children:a.jsxs("div",{className:"search-container",children:[a.jsx("div",{className:"search-icon",children:"üîç"}),a.jsx("input",{type:"text",placeholder:"Pesquisar guias por t√≠tulo, descri√ß√£o ou categoria...",value:c,onChange:s=>n(s.target.value),className:"search-input"}),c&&a.jsx("button",{className:"clear-search-btn",onClick:()=>n(""),title:"Limpar pesquisa",children:"‚úï"})]})}),a.jsx("h3",{className:"section-title",children:"üìñ Guias Oficiais"}),w.length>0?a.jsx("div",{className:"guias-grid",children:w.map(s=>a.jsxs("div",{className:"guia-card guia-oficial",children:[a.jsxs("div",{className:"guia-header",children:[a.jsx("div",{className:"guia-icone",children:s.icone}),a.jsx("div",{className:"guia-categoria oficial",children:s.categoria})]}),a.jsxs("div",{className:"guia-content",children:[a.jsxs("div",{className:"guia-info",children:[a.jsx("h3",{className:"guia-titulo",children:s.titulo}),a.jsx("p",{className:"guia-descricao",children:s.subtitulo})]}),a.jsx("div",{className:"guia-avaliacao",children:a.jsx(G,{guiaId:s.id,mediaAtual:x[s.id]?.media||0,totalVotos:x[s.id]?.total||0,votosUsuario:h,onAvaliar:N})})]}),a.jsx("div",{className:"guia-footer",children:a.jsx("span",{className:"guia-cta",onClick:()=>t(s.rota),children:"Ver guia completo ‚Üí"})})]},s.id))}):c&&a.jsx("div",{className:"search-no-results",children:a.jsxs("p",{children:['Nenhum guia oficial encontrado para "',c,'"']})}),a.jsx("h3",{className:"section-title",children:"ÔøΩ Guias da Comunidade"}),A.length>0?a.jsx("div",{className:"guias-grid",children:A.map(s=>{const e=o?.email===s.autorEmail;g.calculateAverageRating(s);const i=s.status==="oculto";return a.jsxs("div",{className:`guia-card guia-comunidade ${i?"guia-oculto":""} ${!m&&!e?"locked":""}`,children:[a.jsxs("div",{className:"guia-header",children:[a.jsx("div",{className:"guia-icone",children:"üìÑ"}),a.jsx("div",{className:"guia-categoria comunidade",children:s.categoria||"MEC√ÇNICA GERAL"}),e&&a.jsx("div",{className:"guia-author-badge",title:"Voc√™ √© o autor deste guia",children:"üë§ Seu Guia"})]}),s.imagem&&a.jsx("div",{className:"guia-imagem",children:a.jsx("img",{src:s.imagem,alt:s.titulo})}),a.jsxs("div",{className:"guia-content",children:[a.jsxs("div",{className:"guia-info",children:[a.jsx("h3",{className:"guia-titulo",children:s.titulo}),a.jsx("p",{className:"guia-descricao",children:s.descricao||"Guia da comunidade"}),i&&e&&a.jsx("div",{className:"guia-status-warning",children:"‚ö†Ô∏è Este guia est√° oculto devido a avalia√ß√µes baixas. Edite-o para melhorar!"})]}),a.jsxs("div",{className:"guia-avaliacao",children:[(()=>{const l=g.getGuiaStats(s);return a.jsx(G,{guiaId:s.id,mediaAtual:Number((l.averageRating||0).toFixed(1)),totalVotos:l.totalRatings,votosUsuario:h,onAvaliar:(v,C)=>j(v,C),somenteLeitura:e||!o})})(),s.views>0&&a.jsxs("span",{className:"guia-views",children:["üëÅÔ∏è ",s.views," visualiza√ß√µes"]})]})]}),a.jsxs("div",{className:"guia-footer",children:[e&&a.jsx("button",{className:"btn-editar-guia",onClick:()=>t(`/criar-guia/${s.id}`),children:"‚úèÔ∏è Editar"}),!m&&!e?a.jsx("div",{className:"guia-locked-wrapper",children:a.jsx("button",{className:"btn-locked",onClick:()=>t("/versao-pro"),children:"üîí Somente Pro ‚Äî Assine para abrir"})}):a.jsx("span",{className:"guia-cta",onClick:()=>f(s.id),children:"Ver guia completo ‚Üí"})]})]},s.id)})}):c?a.jsx("div",{className:"search-no-results",children:a.jsxs("p",{children:['Nenhum guia da comunidade encontrado para "',c,'"']})}):a.jsxs("p",{className:"guias-empty-message",children:["Nenhum guia da comunidade criado ainda. ",m?"Seja o primeiro!":"Seja Pro para criar o primeiro guia!"]}),a.jsx("div",{className:"guias-footer",children:a.jsxs("div",{className:"info-section",children:[a.jsx("h3",{children:"üí° Dica"}),a.jsx("p",{children:"Nossos guias s√£o atualizados regularmente com as melhores pr√°ticas e informa√ß√µes mais recentes do setor automotivo. Marque esta p√°gina nos favoritos para consultar sempre que precisar!"})]})})]})})]})}export{M as default};
