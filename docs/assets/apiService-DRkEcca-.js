import{g as w}from"./glossarioData-8VebtgBN.js";class g{constructor(){this.isLocal=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",this.getBaseUrl=()=>typeof window>"u"?"":window.__API_BASE?window.__API_BASE:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?`${window.location.protocol}//${window.location.hostname}:3001`:""}async fetchWithFallback(a,t=null){const i=this.getBaseUrl()+a;try{const e=await fetch(i);if(e.ok)return await e.json()}catch(e){console.warn(`API call failed for ${i}, falling back to local data:`,e)}if(t)return t;try{const e=this.getJsonFallbackPath(a);if(e){const n=await fetch(e);if(n.ok)return await n.json()}}catch(e){console.warn(`JSON fallback failed for ${a}:`,e)}return{data:[],message:"No data available"}}getJsonFallbackPath(a){return{"/api/glossario-dashboard":null,"/api/luzes-painel":"/data/luzes_painel.json","/api/pecas/meta":"/data/parts_db.json"}[a]||null}async getGlossarioDashboard(){return this.fetchWithFallback("/api/glossario-dashboard",w)}async getLuzesPainel(){try{const a=await fetch("/data/luzes_painel.json"),t=a.ok?await a.json():null;return this.fetchWithFallback("/api/luzes-painel",t)}catch{return this.fetchWithFallback("/api/luzes-painel")}}async getPecasMeta(){try{const a=await fetch("/data/parts_db.json");if(a.ok){const t=await a.json(),i=[...new Set(t.map(c=>c.category).filter(Boolean))].sort(),e=[...new Set(t.map(c=>c.manufacturer).filter(Boolean))].sort(),n=new Set,o=new Set,r=new Set;let u=0;return t.forEach(c=>{c.applications&&Array.isArray(c.applications)&&c.applications.forEach(s=>{if(u++,typeof s=="string"){const l=s.trim().split(/\s+/);if(l.length>=2){const d=l[0],p=l[1];r.add(d),n.add(`${d} ${p}`);const f=s.match(/\b(19|20)\d{2}\b/g);f&&f.forEach(h=>o.add(h))}}else typeof s=="object"&&(s.model&&n.add(s.model),s.year&&o.add(s.year),s.make&&r.add(s.make))})}),{grupos:i,pecas:t,marcas:[...r].sort(),modelos:[...n].sort(),anos:[...o].sort(),fabricantes:e}}}catch(a){console.warn("Error loading parts_db.json:",a)}return this.fetchWithFallback("/api/pecas/meta")}async filtrarPecas(a){if(this.isLocal)try{const t=await fetch("/api/pecas/filtrar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(t.ok)return await t.json();console.warn("ApiService: API response not ok:",t.status)}catch(t){console.warn("API filter call failed, using local data:",t)}try{const t=await fetch("/data/parts_db.json");if(t.ok){let e=await t.json();if(a.grupo){const o=e.length;console.log("üîç Filtrando por grupo:",a.grupo),console.log("üìä Categorias dispon√≠veis:",[...new Set(e.map(r=>r.category))]),e=e.filter(r=>(console.log(`Comparando: "${r.category}" === "${a.grupo}"`,r.category===a.grupo),r.category===a.grupo)),console.log(`‚úÖ Filtrado: ${o} ‚Üí ${e.length} pe√ßas`)}const n=(a.peca||a.categoria||"").toString().toLowerCase().trim();return n&&(e=e.filter(o=>(o.name||"").toString().toLowerCase().trim()===n)),a.marca&&(e=e.filter(o=>o.applications&&o.applications.some(r=>typeof r=="string"?r.toLowerCase().includes(a.marca.toLowerCase()):!1))),a.modelo&&(e=e.filter(o=>o.applications&&o.applications.some(r=>typeof r=="string"?r.toLowerCase().includes(a.modelo.toLowerCase()):!1))),a.ano&&(e=e.filter(o=>o.applications&&o.applications.some(r=>typeof r=="string"?r.includes(a.ano):!1))),a.fabricante&&(e=e.filter(o=>o.manufacturer&&o.manufacturer.toLowerCase().includes(a.fabricante.toLowerCase()))),{pecas:e,total:e.length}}else console.error("ApiService: Failed to load /data/parts_db.json:",t.status)}catch(t){console.warn("Error filtering local data:",t)}return{pecas:[],total:0}}async getPecaById(a){if(this.isLocal)try{const t=await fetch(`/api/pecas/${a}`);if(t.ok)return await t.json()}catch(t){console.warn(`API call failed for piece ${a}, using local data:`,t)}try{const t=await fetch("/data/parts_detailed.json");if(t.ok){const n=(await t.json()).find(o=>o.id===a||o.id===parseInt(a)||o.id===String(a));if(n)return n}const i=await fetch("/data/parts_db.json");if(i.ok)return(await i.json()).find(o=>o.id===a||o.id===parseInt(a)||o.id===String(a))||{error:"Pe√ßa n√£o encontrada"}}catch(t){console.warn("Error finding piece in local data:",t)}return{error:"Pe√ßa n√£o encontrada"}}}const k=new g;export{k as a};
