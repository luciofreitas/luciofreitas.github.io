import{r as d,R as w,j as a,a as C,u as L,A as k,L as R}from"./index-VModOzao.js";import{M as v}from"./index.esm-CbLAFu9b.js";import{g as S}from"./guiasService-DAw1oR7r.js";function A({rating:n=0,totalRatings:o=0,onRate:t=null,readOnly:e=!1,size:p="medium"}){const[f,l]=d.useState(0),[N,g]=d.useState(!1),[h,m]=d.useState(null),b=i=>{!e&&t&&(g(!0),t(i),m(i),setTimeout(()=>g(!1),300))},E=i=>{e||l(i)},u=()=>{e||l(0)},j=f||h||n;return w.useEffect(()=>{h!==null&&n&&Number(n)>0&&m(null)},[n,h]),a.jsxs("div",{className:`rating-stars-container ${p} ${e?"read-only":"interactive"}`,children:[a.jsx("div",{className:"stars-wrapper",onMouseLeave:u,children:[1,2,3,4,5].map(i=>a.jsx("button",{type:"button",className:`star-button ${i<=j?"filled":"empty"} ${N?"animating":""}`,onClick:()=>b(i),onMouseEnter:()=>E(i),disabled:e,"aria-label":`${i} ${i===1?"estrela":"estrelas"}`,children:a.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:a.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})},i))}),o>0&&n>0&&a.jsxs("div",{className:"rating-info",children:[a.jsx("span",{className:"rating-average",children:n.toFixed(1)}),a.jsxs("span",{className:"rating-count",children:["(",o," ",o===1?"avaliação":"avaliações",")"]})]}),!e&&o===0&&a.jsx("span",{className:"rating-prompt",children:"Seja o primeiro a avaliar"}),e&&o===0&&a.jsx("span",{className:"rating-prompt",children:"Sem avaliações ainda"})]})}function T(){const{guiaId:n}=C(),o=L(),{usuarioLogado:t}=d.useContext(k)||{},[e,p]=d.useState(null),[f,l]=d.useState(!0),[N,g]=d.useState(!1),[h,m]=d.useState(null);d.useEffect(()=>{let c=!0,r=null;return(async()=>{try{m(null),l(!0),r=setTimeout(()=>{c&&(m("Tempo de carregamento excedido. Verifique sua conexão e tente novamente."),l(!1))},8e3);const s=await S.getGuiaById(n);if(!c)return;if(clearTimeout(r),!s){g(!0),l(!1);return}if(s.status==="oculto"&&t?.email!==s.autorEmail){g(!0),l(!1);return}s.descricao=s.descricao||"",s.conteudo=s.conteudo||"",s.ratings=s.ratings||[],s.views=s.views||0,p(s),l(!1)}catch(s){console.error("Erro ao carregar guia:",s),c&&(m("Erro ao carregar o guia. Veja o console para detalhes."),l(!1))}})(),()=>{c=!1,r&&clearTimeout(r)}},[n,t]);const b=()=>{g(!1),m(null),l(!0),window.location.reload()},E=c=>{if(!t?.email){alert("Faça login para avaliar este guia"),o("/login");return}if(t.email===e.autorEmail){alert("Você não pode avaliar seu próprio guia");return}(async()=>{try{const r=await S.addRating(n,t.email,c);p(x=>({...x||{},...r||{}}))}catch(r){console.error("Erro ao avaliar guia:",r)}})()};if(f)return a.jsxs(a.Fragment,{children:[a.jsx(v,{}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsx("div",{className:"page-content",children:a.jsx("div",{className:"loading-message",children:"Carregando guia..."})})})]});if(h)return a.jsxs(a.Fragment,{children:[a.jsx(v,{}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsx("div",{className:"page-content",children:a.jsxs("div",{className:"not-found-message",children:[a.jsx("h2",{children:"⚠️ Problema ao carregar"}),a.jsx("p",{children:h}),a.jsx("div",{style:{marginTop:"1rem"},children:a.jsx("button",{className:"btn-voltar",onClick:b,children:"Tentar novamente"})})]})})})]});if(N)return a.jsxs(a.Fragment,{children:[a.jsx(v,{}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsx("div",{className:"page-content",children:a.jsxs("div",{className:"not-found-message",children:[a.jsx("h2",{children:"❌ Guia não encontrado"}),a.jsx("p",{children:"O guia que você está procurando não existe ou não está mais disponível."}),a.jsx("button",{className:"btn-voltar",onClick:()=>o("/guias"),children:"← Voltar para Guias"})]})})})]});const u=t?.email===e.autorEmail,j=!!(t&&t.isPro||localStorage.getItem("versaoProAtiva")==="true"),i=S.calculateAverageRating(e);return a.jsxs(a.Fragment,{children:[a.jsx(v,{}),a.jsx("div",{className:"page-wrapper menu-page",children:a.jsxs("div",{className:"page-content visualizar-guia",children:[a.jsx(R,{to:"/guias",className:"voltar-link",children:"← Voltar para Guias"}),a.jsxs("div",{className:"guia-header-full",children:[a.jsxs("div",{className:"guia-meta",children:[a.jsx("span",{className:"guia-categoria-badge",children:e.categoria}),u&&a.jsx("span",{className:"guia-author-badge",children:"👤 Seu Guia"})]}),a.jsx("h1",{className:"guia-titulo-full",children:e.titulo}),a.jsxs("div",{className:"guia-info",children:[a.jsxs("span",{className:"guia-autor",children:["Por: ",e.autorNome||"Anônimo"]}),a.jsxs("span",{className:"guia-data",children:["Criado em: ",new Date(e.criadoEm).toLocaleDateString("pt-BR")]}),e.views>0&&a.jsxs("span",{className:"guia-views",children:["👁️ ",e.views," visualizações"]})]}),a.jsx("div",{className:"guia-rating-section",children:a.jsx(A,{rating:i,totalRatings:e.ratings&&e.ratings.length||0,onRate:E,readOnly:u||!t,size:"large"})})]}),e.imagem&&a.jsx("div",{className:"guia-imagem-full",children:a.jsx("img",{src:e.imagem,alt:e.titulo})}),a.jsxs("div",{className:"guia-descricao-section",children:[a.jsx("h3",{children:"📝 Descrição"}),a.jsx("p",{className:"guia-descricao-texto",children:!j&&!u?e.descricao?e.descricao.split(`
`).slice(0,2).join(`
`)+"...":"":e.descricao})]}),a.jsxs("div",{className:"guia-conteudo-section",children:[a.jsx("h3",{children:"📖 Conteúdo"}),a.jsx("div",{className:"guia-conteudo-texto",children:(()=>{const c=e.conteudo.split(`
`).filter(Boolean);return!j&&!u?c.slice(0,3).map((r,x)=>a.jsx("p",{children:r},x)).concat(a.jsx("div",{className:"visual-lock-cta",children:a.jsx("button",{className:"btn-locked",onClick:()=>o("/versao-pro"),children:"🔒 Somente Pro — Assine para ler o conteúdo completo"})},"locked-cta")):c.map((r,x)=>r.trim()&&a.jsx("p",{children:r},x))})()})]}),u&&a.jsx("div",{className:"guia-actions",children:a.jsx("button",{className:"btn-editar-guia-full",onClick:()=>o(`/criar-guia/${n}`),children:"✏️ Editar este guia"})}),e.status==="oculto"&&u&&a.jsxs("div",{className:"guia-warning-oculto",children:[a.jsx("h3",{children:"⚠️ Guia Oculto"}),a.jsx("p",{children:"Este guia está oculto devido a avaliações baixas (média abaixo de 2.5 estrelas). Edite o conteúdo para melhorar e aumentar a nota!"})]}),a.jsx("div",{className:"guia-footer-info",children:a.jsxs("p",{children:["💡 ",a.jsx("strong",{children:"Dica:"})," Se este guia foi útil para você, não esqueça de avaliá-lo!"]})})]})})]})}export{T as default};
