const a="http://localhost:3001",u=async t=>{try{if(!t)throw new Error("userId is required");const r=await fetch(`${a}/api/ml/auth?userId=${encodeURIComponent(t)}`);if(!r.ok){const s=await r.json();throw new Error(s.error||"Failed to initiate ML auth")}const e=await r.json();e.state&&sessionStorage.setItem("ml_oauth_state",e.state),window.location.href=e.authUrl}catch(r){throw console.error("Error initiating ML auth:",r),r}},w=async()=>{try{const t=d();if(t&&t.accessToken)try{await fetch(`${a}/api/ml/revoke`,{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}})}catch(r){console.warn("Failed to revoke ML token:",r)}l()}catch(t){throw console.error("Error disconnecting ML:",t),l(),t}},p=()=>{const t=d();return!t||!t.accessToken?{connected:!1,expired:!1}:{connected:!0,expired:t.expiresAt&&Date.now()>t.expiresAt,connectedAt:t.connectedAt,expiresAt:t.expiresAt,userId:t.userId}},d=()=>{try{const t=localStorage.getItem("ml_token_data");return t?JSON.parse(t):null}catch(t){return console.error("Error parsing stored ML tokens:",t),null}},l=()=>{localStorage.removeItem("ml_token_data"),sessionStorage.removeItem("ml_oauth_state"),console.log("ML tokens cleared")},g=async(t,r={})=>{try{if(!t)throw new Error("Search query is required");const{limit:e=50,offset:s=0,category:c}=r,i=new URLSearchParams({q:t,limit:e.toString(),offset:s.toString()});c&&i.set("category",c);const n=await fetch(`${a}/api/ml/products/search?${i.toString()}`);if(!n.ok){const h=await n.json();throw new Error(h.error||"Failed to search products")}const o=await n.json();return{products:o.results||[],total:o.total||0,paging:o.paging||{},filters:o.filters||[],availableFilters:o.available_filters||[]}}catch(e){throw console.error("Error searching ML products:",e),e}},f=async t=>{try{if(!t)throw new Error("Product ID is required");const r=await fetch(`${a}/api/ml/products/${t}`);if(!r.ok){const e=await r.json();throw new Error(e.error||"Failed to get product details")}return await r.json()}catch(r){throw console.error("Error getting ML product details:",r),r}};export{p as a,w as d,f as g,u as i,g as s};
