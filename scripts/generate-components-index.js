const fs = require('fs');
const path = require('path');

const componentsDir = path.join(__dirname, '..', 'src', 'components');
const outFile = path.join(componentsDir, 'index.js');

function isComponentFile(name) {
  if (!name) return false;
  const ext = path.extname(name).toLowerCase();
  if (ext !== '.jsx' && ext !== '.js') return false;
  if (name.startsWith('__') || name.startsWith('.')) return false;
  if (name.toLowerCase().includes('index')) return false;
  return true;
}

function toExportName(fileName) {
  const base = path.basename(fileName, path.extname(fileName));
  return base;
}

function generate() {
  const files = fs.readdirSync(componentsDir).filter(isComponentFile).sort();
  const exports = files.map(f => {
    const name = toExportName(f);
    return `export { default as ${name} } from './${name}';`;
  });

  const header = `// Auto-generated by scripts/generate-components-index.js
// Do not edit by hand â€” run "npm run generate-barrel" to regenerate
\n`;
  const content = header + exports.join('\n') + '\n';
  fs.writeFileSync(outFile, content, 'utf8');
  console.log(`Wrote ${outFile} with ${exports.length} exports.`);
}

if (require.main === module) {
  try {
    generate();
  } catch (e) {
    console.error('Failed to generate components index', e);
    process.exit(1);
  }
}
