import{j as e,r as i,A as ie,u as me,M as Ie}from"./index-DybRcGxg.js";import{a as de}from"./apiService-Bu_7w97N.js";import{b as Re}from"./index-Cf-9cD5y.js";import{M as Te}from"./index.esm-CWpXVLZg.js";import{g as xe}from"./carService-B4lSvgg8.js";import{a as Ge}from"./maintenanceService-DOGDJ6m6.js";import"./glossarioData-8VebtgBN.js";import"./mlService-CCxBbQYh.js";function We({veiculo:s,anosList:c}){const m=Array.from(new Set(c.map(String))).sort(),[l,r]=i.useState(m.length?m[0]:"");return e.jsxs("div",{className:"compatibility-grid-row",children:[e.jsx("div",{className:"compatibility-grid-vehicle",children:e.jsx("div",{className:"compatibility-vehicle-text",children:s||"-"})}),e.jsx("div",{className:"compatibility-grid-years",children:m.length?e.jsx("select",{className:"compatibility-year-select","aria-label":`Selecionar ano para ${s}`,value:l,onChange:t=>r(t.target.value),children:m.map(t=>e.jsx("option",{value:t,children:t},t))}):e.jsx("div",{className:"compatibility-years-text",children:"-"})})]})}function ze({applications:s,usuarioLogado:c}){return c&&c.isPro||localStorage.getItem("versaoProAtiva"),e.jsxs("div",{className:"compatibility-grid",children:[e.jsxs("div",{className:"compatibility-grid-header",children:[e.jsx("div",{className:"compatibility-header-vehicle",children:e.jsx("strong",{children:"Carro"})}),e.jsx("div",{className:"compatibility-header-years",children:e.jsx("strong",{children:"Anos"})})]}),s.map((m,l)=>{let r=[],t="";return typeof m=="string"?((m.match(/\d{4}(?:-\d{4})?/g)||[]).forEach(f=>{if(f.includes("-")){const[j,o]=f.split("-").map(Number);for(let w=j;w<=o;w++)r.push(String(w))}else r.push(f)}),t=m.replace(/\d{4}(-\d{4})?/g,"").replace(/--/g,"").replace(/\(|\)|,/g,"").replace(/-+/g,"").trim()):typeof m=="object"&&(t=m.vehicle||"",r=m.years||[]),e.jsx(We,{veiculo:t,anosList:r},l)})]})}const U=[];function ge(s,c){i.useEffect(()=>{const m=c?.current;if(!s||!m)return;const l=document.activeElement;U.push({container:m,prevActive:l});const r=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed",'[tabindex]:not([tabindex="-1"])',"[contenteditable]"].join(",");function t(){return Array.from(m.querySelectorAll(r)).filter(o=>!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length))}function S(){const o=t();o.length?o[0].focus():(m.hasAttribute("tabindex")||m.setAttribute("tabindex","-1"),m.focus())}function f(){const o=U[U.length-1];return o&&o.container===m}function j(o){if(!f()||o.key!=="Tab")return;const w=t();if(w.length===0){o.preventDefault();return}const h=w[0],M=w[w.length-1];o.shiftKey?(document.activeElement===h||document.activeElement===m)&&(o.preventDefault(),M.focus()):document.activeElement===M&&(o.preventDefault(),h.focus())}return S(),document.addEventListener("keydown",j),()=>{for(let o=U.length-1;o>=0;o--)if(U[o].container===m){const w=U.splice(o,1)[0];try{w.prevActive&&typeof w.prevActive.focus=="function"&&w.prevActive.focus()}catch{}break}document.removeEventListener("keydown",j)}},[s,c])}function Ue({show:s,onClose:c,title:m,titleIcon:l,children:r,onSave:t}){const S=i.useRef(null);if(ge(s,S),i.useEffect(()=>{if(s){const j=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=j}}},[s]),!s)return null;const f=j=>{j.target.classList.contains("modal-overlay")&&c()};return e.jsx("div",{className:"modal-overlay",onClick:f,children:e.jsxs("div",{ref:S,className:"compat-modal",role:"dialog","aria-modal":"true","aria-label":m||"Modal",children:[e.jsxs("div",{className:"app-compat-header",children:[e.jsxs("div",{className:"app-compat-title-wrapper",children:[l&&e.jsx(Re,{className:"app-compat-title-icon",style:{color:"#10b981",fontSize:"1.5rem"}}),e.jsx("span",{className:"app-compat-title",children:m})]}),e.jsx("button",{className:"app-compat-close","aria-label":"Fechar",onClick:c,children:"âœ•"})]}),e.jsx("div",{className:"app-compat-body",children:r}),t&&e.jsx("div",{className:"app-compat-footer",children:e.jsx("button",{className:"btn btn-primary compat-save-btn",onClick:t,"aria-label":"Salvar pesquisa",children:"Salvar pesquisa"})})]})})}function R({options:s=[],value:c,onChange:m,placeholder:l="",disabled:r=!1}){const[t,S]=i.useState(!1),f=i.useRef(null);i.useEffect(()=>{function h(M){f.current&&!f.current.contains(M.target)&&S(!1)}return document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[]);function j(h){m(h),S(!1)}const o=s.find(h=>h.value===c)?.label||"",w=s;return e.jsxs("div",{className:`custom-dropdown${r?" disabled":""}`,ref:f,children:[e.jsxs("button",{className:`dropdown-btn${t?" open":""}`,onClick:()=>!r&&S(!t),disabled:r,type:"button",children:[e.jsx("span",{className:"dropdown-label",children:o||l}),e.jsx("span",{className:"dropdown-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"custom-dropdown-arrow-svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 6 L8 10 L12 6",stroke:"#444",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})})]}),t&&e.jsxs("div",{className:"dropdown-menu",children:[w.length===0&&e.jsx("div",{className:"dropdown-item disabled",children:"Nenhum item"}),w.map((h,M)=>e.jsx("div",{className:`dropdown-item${h.value===c?" selected":""}`,onClick:()=>j(h.value),children:h.label},`${h.value}${M}`))]})]})}const He=({size:s="medium",color:c="primary",text:m=""})=>e.jsxs("div",{className:`loading-spinner-container loading-spinner-${s}`,children:[e.jsxs("div",{className:`loading-spinner loading-spinner-${c}`,children:[e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"}),e.jsx("div",{className:"spinner-ring"})]}),m&&e.jsx("p",{className:"loading-text",children:m})]});function Oe({peca:s,onViewCompatibility:c,onViewDetails:m}){const{usuarioLogado:l}=i.useContext(ie)||{},r=me(),t=s.ml_product||s.permalink,S=(f,j="BRL")=>f?new Intl.NumberFormat("pt-BR",{style:"currency",currency:j}).format(f):null;return e.jsxs("div",{className:`peca-card ${t?"ml-product":""}`,children:[t&&s.thumbnail&&e.jsxs("div",{className:"peca-card-image",children:[e.jsx("img",{src:s.thumbnail,alt:s.name,loading:"lazy"}),s.shipping?.free_shipping&&e.jsx("span",{className:"free-shipping-badge",children:"Frete GrÃ¡tis"})]}),e.jsx("h3",{className:"peca-card-title",children:s.name}),t&&s.price&&e.jsxs("div",{className:"peca-card-price",children:[e.jsx("span",{className:"price-current",children:S(s.price,s.currency)}),s.original_price&&s.original_price>s.price&&e.jsx("span",{className:"price-original",children:S(s.original_price,s.currency)})]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Categoria:"})," ",s.category]}),e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"Fabricante:"})," ",s.manufacturer]}),t&&s.condition&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"CondiÃ§Ã£o:"})," ",s.condition==="new"?"Novo":"Usado"]}),t&&s.available_quantity!==void 0&&e.jsxs("p",{className:"peca-card-info",children:[e.jsx("strong",{children:"DisponÃ­vel:"})," ",s.available_quantity," unidade(s)",s.sold_quantity>0&&` â€¢ ${s.sold_quantity} vendido(s)`]}),s.specifications&&e.jsxs("div",{className:"peca-card-specs",children:[e.jsx("strong",{children:"EspecificaÃ§Ãµes:"}),Object.entries(s.specifications).map(([f,j])=>e.jsxs("div",{className:"peca-card-spec-item",children:[f,": ",j]},f))]}),e.jsxs("div",{className:"peca-card-actions",children:[t&&s.permalink&&e.jsx("a",{href:s.permalink,target:"_blank",rel:"noopener noreferrer",className:"peca-card-buy-btn ml-btn",children:"ðŸ›’ Comprar no Mercado Livre"}),e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-compat-btn ${l?"":"btn-blocked"}`,onClick:()=>l&&c(s),disabled:!l,children:"Ver compatibilidade"}),!l&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para ver a compatibilidade completa desta peÃ§a"})]})]}),(!t||l)&&e.jsxs("div",{className:"button-with-lock",children:[e.jsx("button",{className:`peca-card-details-btn ${l?"":"btn-blocked"}`,onClick:()=>l&&m&&m(s.id),disabled:!l,children:"Ver ficha completa"}),!l&&e.jsxs("div",{className:"lock-icon-wrapper",children:[e.jsx("span",{className:"lock-icon",children:"ðŸ”’"}),e.jsx("span",{className:"lock-tooltip",children:"FaÃ§a login para acessar a ficha tÃ©cnica completa desta peÃ§a"})]})]})]}),!l&&e.jsxs("div",{className:"cta-login-box",children:[e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:"Quer acessar todos os detalhes?"})]}),e.jsx("button",{onClick:()=>r("/login"),className:"cta-login-button",children:"Fazer Login / Cadastrar GrÃ¡tis"})]})]})}function Ye({pecas:s,onViewCompatibility:c,onViewDetails:m}){return!s||s.length===0?e.jsx("div",{className:"pecas-grid-empty",children:e.jsx("p",{children:"Nenhuma peÃ§a encontrada para os filtros selecionados."})}):e.jsx("div",{className:"pecas-grid",children:s.map(l=>e.jsx(Oe,{peca:l,onViewCompatibility:c,onViewDetails:m},l.id))})}function Ve({isOpen:s,onClose:c,productId:m,selectedCarId:l}){const[r,t]=i.useState(null),[S,f]=i.useState(!1),[j,o]=i.useState("geral"),[w,h]=i.useState(0),[M,T]=i.useState([]),{usuarioLogado:$}=i.useContext(ie)||{};me(),i.useEffect(()=>{s&&m&&V(m)},[s,m]),i.useEffect(()=>{let u=!0;async function g(){try{if(!$)return T([]);const k=$.id||$.email,I=await xe(k);u&&T(Array.isArray(I)?I:[])}catch(k){console.warn("Failed to load user cars for ProductDetailModal",k)}}return s&&g(),()=>{u=!1}},[s,$]);const C=i.useRef(null);ge(s,C);const B="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'><rect width='100%25' height='100%25' fill='%23f3f4f6'/><text x='50%25' y='50%25' fill='%239ca3af' font-size='24' font-family='Arial' dominant-baseline='middle' text-anchor='middle'>Imagem%20indispon%C3%ADvel</text></svg>",V=async u=>{f(!0);try{const g=await de.getPecaById(u);if(g.error)throw console.error("ProductDetailModal: Error from API:",g.error),new Error(g.error);t(g),h(0)}catch(g){console.error("Erro ao carregar detalhes da peÃ§a:",g),t(null)}finally{f(!1)}},H=u=>{u.target===u.currentTarget&&c()};return s?e.jsx("div",{className:"product-modal-overlay",onClick:H,children:e.jsxs("div",{ref:C,className:"product-modal",role:"dialog","aria-modal":"true","aria-label":r?.nome||"Detalhes da peÃ§a",children:[e.jsxs("div",{className:"product-modal-header",children:[e.jsx("h2",{children:r?.nome||"Carregando..."}),e.jsx("div",{className:"product-modal-actions"}),e.jsx("button",{className:"product-modal-close",onClick:c,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),S?e.jsxs("div",{className:"product-modal-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Carregando detalhes da peÃ§a..."})]}):r?e.jsxs("div",{className:"product-modal-content",children:[e.jsxs("div",{className:"product-header-section",children:[e.jsxs("div",{className:"product-images",children:[e.jsx("div",{className:"main-image",children:e.jsx("img",{src:r.imagens?.[w]||B,alt:r?.nome||"",onError:u=>{u.target.src=B}})}),r.imagens&&r.imagens.length>1&&e.jsx("div",{className:"image-thumbnails",children:r.imagens.map((u,g)=>e.jsx("img",{src:u,alt:r?.nome?`${r.nome} - ${g+1}`:"",className:w===g?"active":"",onClick:()=>h(g),onError:k=>{k.target.src=B}},g))})]}),e.jsxs("div",{className:"product-basic-info",children:[r.recall_relacionado&&e.jsxs("div",{className:"recall-alert",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M11 7h2v6h-2zM11 15h2v2h-2z",fill:"currentColor"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Recall Relacionado"}),e.jsx("p",{children:r.recall_detalhes?.descricao}),e.jsxs("small",{children:["Ref: ",r.recall_detalhes?.numero]})]})]}),e.jsxs("div",{className:"product-codes",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fabricante:"})," ",r.fabricante]}),r.codigos?.oem&&e.jsxs("div",{children:[e.jsx("strong",{children:"CÃ³digos OEM:"})," ",r.codigos.oem.join(", ")]})]}),e.jsxs("div",{className:"installation-info",children:[e.jsxs("div",{className:"install-difficulty",children:[e.jsx("span",{className:"label",children:"Dificuldade:"}),e.jsx("span",{className:`difficulty ${r.instalacao?.dificuldade?.toLowerCase()}`,children:r.instalacao?.dificuldade})]}),e.jsxs("div",{className:"install-time",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 6V12L16 14",stroke:"currentColor",strokeWidth:"2"})]}),r.instalacao?.tempo_estimado_min," min"]})]}),e.jsxs("div",{className:"contact-workshop",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ’¡ Para preÃ§os e disponibilidade:"})}),e.jsx("p",{children:"Consulte nossas oficinas parceiras prÃ³ximas ao seu local"})]})]})]}),e.jsxs("div",{className:"product-tabs",children:[e.jsxs("div",{className:"tab-buttons",children:[e.jsx("button",{className:j==="geral"?"active":"",onClick:()=>o("geral"),children:"Geral"}),e.jsx("button",{className:j==="especificacoes"?"active":"",onClick:()=>o("especificacoes"),children:"EspecificaÃ§Ãµes"}),e.jsx("button",{className:j==="compatibilidade"?"active":"",onClick:()=>o("compatibilidade"),children:"Compatibilidade"}),e.jsx("button",{className:j==="instalacao"?"active":"",onClick:()=>o("instalacao"),children:"InstalaÃ§Ã£o"}),e.jsx("button",{className:j==="avaliacoes"?"active":"",onClick:()=>o("avaliacoes"),children:"AvaliaÃ§Ãµes"})]}),e.jsxs("div",{className:"tab-content",children:[j==="geral"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Como Adquirir"}),e.jsxs("div",{className:"workshop-info",children:[e.jsx("div",{children:"ðŸª Consulte preÃ§os e disponibilidade com nossas oficinas parceiras"}),e.jsx("div",{children:"ðŸ› ï¸ InstalaÃ§Ã£o profissional disponÃ­vel"}),e.jsx("div",{children:"ï¿½ Garantia conforme polÃ­tica de cada oficina"})]}),r.pecas_relacionadas&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"PeÃ§as Relacionadas"}),e.jsx("div",{className:"related-parts",children:r.pecas_relacionadas.map((u,g)=>e.jsxs("div",{className:"related-part",children:[e.jsx("strong",{children:u.nome}),e.jsx("span",{children:u.relacao})]},g))})]})]}),j==="especificacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"EspecificaÃ§Ãµes TÃ©cnicas"}),e.jsx("div",{className:"specs-grid",children:r.especificacoes_tecnicas&&Object.entries(r.especificacoes_tecnicas).map(([u,g])=>e.jsxs("div",{className:"spec-item",children:[e.jsxs("span",{className:"spec-label",children:[u.replace(/_/g," "),":"]}),e.jsx("span",{className:"spec-value",children:g})]},u))})]}),j==="compatibilidade"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AplicaÃ§Ãµes Detalhadas"}),e.jsx("div",{className:"compatibility-table",children:r.aplicacoes_detalhadas?.map((u,g)=>e.jsxs("div",{className:"compatibility-row",children:[e.jsxs("div",{className:"app-main",children:[e.jsxs("strong",{children:[u.marca," ",u.modelo]}),e.jsxs("span",{children:[u.ano_inicio,"-",u.ano_fim]})]}),e.jsxs("div",{className:"app-details",children:[e.jsxs("span",{children:["Motor: ",u.motor]}),u.observacoes&&e.jsx("small",{children:u.observacoes})]})]},g))})]}),j==="instalacao"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"Guia de InstalaÃ§Ã£o"}),e.jsxs("div",{className:"install-guide",children:[e.jsxs("div",{className:"install-requirements",children:[e.jsx("div",{children:e.jsx("strong",{children:"Ferramentas necessÃ¡rias:"})}),e.jsx("ul",{children:r.instalacao?.ferramentas_necessarias?.map((u,g)=>e.jsx("li",{children:u},g))})]}),r.instalacao?.precaucoes&&e.jsxs("div",{className:"install-precautions",children:[e.jsx("div",{children:e.jsx("strong",{children:"âš ï¸ PrecauÃ§Ãµes:"})}),e.jsx("ul",{children:r.instalacao.precaucoes.map((u,g)=>e.jsx("li",{children:u},g))})]})]})]}),j==="avaliacoes"&&e.jsxs("div",{className:"tab-panel",children:[e.jsx("h3",{children:"AvaliaÃ§Ãµes de Clientes"}),e.jsx("div",{className:"reviews",children:r.avaliacoes?.map((u,g)=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsx("strong",{children:u.usuario}),e.jsxs("div",{className:"review-rating",children:["â˜…".repeat(u.nota),"â˜†".repeat(5-u.nota)]}),e.jsx("span",{className:"review-date",children:new Date(u.data).toLocaleDateString("pt-BR")})]}),e.jsx("p",{children:u.texto})]},g))}),r.perguntasFrequentes&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Perguntas Frequentes"}),e.jsx("div",{className:"faq",children:r.perguntasFrequentes.map((u,g)=>e.jsxs("div",{className:"faq-item",children:[e.jsxs("strong",{children:["Q: ",u.pergunta]}),e.jsxs("p",{children:["R: ",u.resposta]})]},g))})]})]})]})]})]}):e.jsx("div",{className:"product-modal-error",children:e.jsx("p",{children:"NÃ£o foi possÃ­vel carregar os detalhes da peÃ§a."})})]})}):null}function Ke({show:s=!1,text:c="Buscando..."}){return s?e.jsx("div",{className:"small-loading-overlay",role:"status","aria-live":"polite",children:e.jsxs("div",{className:"small-loading-box",children:[e.jsx(He,{size:"small",color:"primary"}),e.jsx("div",{className:"small-loading-text",children:c})]})}):null}function Qe({selectedGrupo:s,setSelectedGrupo:c,selectedCategoria:m,setSelectedCategoria:l,selectedMarca:r,setSelectedMarca:t,selectedModelo:S,setSelectedModelo:f,selectedAno:j,setSelectedAno:o,selectedFabricante:w,setSelectedFabricante:h,grupos:M,todasPecas:T,marcas:$,modelos:C,anos:B,fabricantes:V,onSearch:H,onClear:u,loading:g,error:k,warningMarca:I,warningModelo:oe,warningAno:K,warningFabricante:Q,emptyFieldsWarning:G,onCarroChange:J}){const{usuarioLogado:D}=i.useContext(ie)||{},[O,_]=i.useState([]),[F,X]=i.useState("");i.useEffect(()=>{(async()=>{if(D){const P=D.id||D.email,q=await xe(P);_(q)}else _([]),X("")})()},[D]);const Z=x=>{if(X(x),J&&J(x),!x)return;const P=O.find(q=>q.id===x);P&&(t(P.marca),f(P.modelo),o(String(P.ano)))};return e.jsxs("form",{className:"search-form",onSubmit:H,"aria-label":"FormulÃ¡rio de busca de peÃ§as",children:[D&&O.length>0&&e.jsxs("div",{className:"search-form-car-selector",children:[e.jsx("label",{htmlFor:"carro-selecionado",children:"Buscar por um carro especÃ­fico (opcional)"}),e.jsx(R,{options:[{value:"",label:"-- Busca geral (deixar em branco) --"},...O.map(x=>({value:x.id,label:`${x.marca} ${x.modelo} ${x.ano}${x.isDefault?" â­":""}`}))],value:F,onChange:Z,placeholder:"Selecione um carro cadastrado"})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"grupo",children:"Grupo"}),e.jsx(R,{options:[{value:"",label:""},...M.map(x=>({value:x,label:x}))],value:s,onChange:c,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"categoria",children:"PeÃ§a"}),e.jsx(R,{options:[{value:"",label:""},...T.map(x=>({value:x,label:x}))],value:m,onChange:l,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"marca",children:"Marca"}),e.jsx(R,{options:[{value:"",label:""},...$.map(x=>({value:x,label:x}))],value:r,onChange:t,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"modelo",children:"Modelo"}),e.jsx(R,{options:[{value:"",label:""},...C.map(x=>({value:x,label:x}))],value:S,onChange:f,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-row",children:[e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"ano",children:"Ano"}),e.jsx(R,{options:[{value:"",label:""},...B.map(x=>({value:x,label:x}))],value:j,onChange:o,placeholder:""})]}),e.jsxs("div",{className:"search-form-field",children:[e.jsx("label",{htmlFor:"fabricante",children:"Fabricante"}),e.jsx(R,{options:[{value:"",label:""},...V.map(x=>({value:x,label:x}))],value:w,onChange:h,placeholder:""})]})]}),e.jsxs("div",{className:"search-form-actions",children:[e.jsxs("div",{className:"search-form-buttons-row",children:[e.jsxs("div",{className:"search-form-buttons",children:[e.jsx("button",{className:"search-form-btn search-form-btn-primary",type:"submit",disabled:g,children:"Buscar"}),e.jsx("button",{type:"button",className:"search-form-btn search-form-btn-secondary",onClick:u,children:"Limpar"})]}),e.jsx("div",{className:"search-form-warnings-container",children:G?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",G]}):I?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",I]}):oe?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",oe]}):K?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",K]}):Q?e.jsxs("div",{className:"search-form-inline-warning",role:"alert",children:["âš ï¸ ",Q]}):null})]}),k&&e.jsx("div",{className:"search-form-error",role:"status","aria-live":"polite",children:k})]}),e.jsx(Ke,{show:g,text:"Buscando..."})]})}function ia(){const{usuarioLogado:s}=i.useContext(ie)||{},[c,m]=i.useState(""),[l,r]=i.useState(""),[t,S]=i.useState(""),[f,j]=i.useState(""),[o,w]=i.useState(""),[h,M]=i.useState(""),[T,$]=i.useState([]),[C,B]=i.useState([]),[V,H]=i.useState([]),[u,g]=i.useState([]),[k,I]=i.useState([]),[oe,K]=i.useState([]),[Q,G]=i.useState([]),[J,D]=i.useState(!1),[O,_]=i.useState(""),[F,X]=i.useState(""),[Z,x]=i.useState(""),[P,q]=i.useState(""),[ue,ee]=i.useState(""),[je,ae]=i.useState(""),[be,se]=i.useState(""),[Ne,Y]=i.useState(!1),[ne,he]=i.useState(""),[ye,ce]=i.useState(null),[we,Ce]=i.useState(null),pe=me(),[Se,fe]=i.useState(!1),[Ae,ve]=i.useState(null);i.useEffect(()=>{const n=async()=>{try{const a=await de.getPecasMeta();$(a.grupos||[]),B(a.pecas||[]),H(a.marcas||[]),g(a.modelos||[]),I(a.anos||[]),K(a.fabricantes||[]),a.pecas&&a.pecas.length>0&&G(a.pecas)}catch(a){console.warn("Failed to load metadata:",a&&a.message?a.message:a),_("NÃ£o foi possÃ­vel carregar os dados iniciais. Tente recarregar a pÃ¡gina.")}};n();const v=()=>n();return window.addEventListener("app-refresh",v),()=>window.removeEventListener("app-refresh",v)},[]),i.useEffect(()=>{if(x(""),q(""),ee(""),ae(""),(c||l||t||f||o||h)&&se(""),h&&C.length>0){const v=C.filter(a=>(!c||a.category===c)&&(!l||a.name===l)&&a.manufacturer===h);t&&v.length>0&&(v.some(d=>!d.applications||!Array.isArray(d.applications)?!1:d.applications.some(p=>String(p).toLowerCase().includes(t.toLowerCase())))||x(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com a marca "${t}"`)),f&&v.length>0&&(v.some(d=>!d.applications||!Array.isArray(d.applications)?!1:d.applications.some(p=>String(p).toLowerCase().includes(f.toLowerCase())))||q(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o modelo "${f}"`)),o&&v.length>0&&(v.some(d=>!d.applications||!Array.isArray(d.applications)?!1:d.applications.some(p=>String(p).toLowerCase().includes(o)))||ee(`NÃ£o hÃ¡ peÃ§as do fabricante "${h}" compatÃ­veis com o ano "${o}"`))}(t||f||o)&&h&&C.filter(a=>{const d=!c||a.category===c,p=!l||a.name===l,b=a.manufacturer===h;return!d||!p||!b||!a.applications||!Array.isArray(a.applications)?!1:a.applications.some(A=>{const N=String(A).toLowerCase(),L=!t||N.includes(t.toLowerCase()),y=!f||N.includes(f.toLowerCase()),E=!o||N.includes(o);return L&&y&&E})}).length===0&&!Z&&!P&&!ue&&ae("NÃ£o hÃ¡ peÃ§as que atendam todos os filtros selecionados")},[c,l,h,t,f,o,C]);const Me=()=>{if(!C||C.length===0)return[];if(!c||c==="")return Array.from(new Set(C.map(d=>d.name||"").filter(Boolean)));const n=C.filter(a=>a.category?a.category.toLowerCase().trim()===c.toLowerCase().trim():!1),v=Array.from(new Set(n.map(a=>a.name||"").filter(Boolean)));return F&&l&&!v.includes(l)&&v.push(l),v},ke=()=>{if(!Array.isArray(C))return[];let n=C;c&&(n=n.filter(a=>a&&a.category===c)),l&&(n=n.filter(a=>a&&a.name===l));const v=Array.from(new Set(n.map(a=>a&&a.manufacturer).filter(Boolean)));return F&&h&&!v.includes(h)&&v.push(h),v},Le=()=>{if(!Array.isArray(C))return[];let n=C;c&&(n=n.filter(d=>d&&d.category===c)),l&&(n=n.filter(d=>d&&d.name===l)),h&&(n=n.filter(d=>d&&d.manufacturer===h));const v=new Set;n.forEach(d=>{d&&d.applications&&Array.isArray(d.applications)&&d.applications.forEach(p=>{const b=String(p).toLowerCase();["ford","chevrolet","volkswagen","fiat","honda","toyota","hyundai","nissan","renault","peugeot","citroÃ«n","bmw","mercedes","audi","volvo","mitsubishi","kia","suzuki","jeep","land rover","jaguar"].forEach(N=>{b.includes(N)&&v.add(N.charAt(0).toUpperCase()+N.slice(1))})})});const a=Array.from(v);return F&&t&&!a.includes(t)&&a.push(t),a},Ee=()=>{if(!t)return Array.isArray(u)?u:[];if(!Array.isArray(C))return[];let n=C;c&&(n=n.filter(p=>p&&p.category===c)),l&&(n=n.filter(p=>p&&p.name===l)),h&&(n=n.filter(p=>p&&p.manufacturer===h));const v=new Set,a=t.toLowerCase();n.forEach(p=>{p&&p.applications&&Array.isArray(p.applications)&&p.applications.forEach(b=>{const A=String(b).toLowerCase();if(A.includes(a)){const N=A.split(" "),L=N.findIndex(y=>y.includes(a));if(L>=0&&L<N.length-1){const y=N[L+1];y&&y.length>1&&v.add(y.charAt(0).toUpperCase()+y.slice(1))}}})});const d=Array.from(v);return F&&f&&!d.includes(f)&&d.push(f),d},Fe=()=>{if(!t&&!f)return Array.isArray(k)?k:[];if(!Array.isArray(C))return[];let n=C;c&&(n=n.filter(b=>b&&b.category===c)),l&&(n=n.filter(b=>b&&b.name===l)),h&&(n=n.filter(b=>b&&b.manufacturer===h));const v=new Set,a=t?.toLowerCase(),d=f?.toLowerCase();n.forEach(b=>{b&&b.applications&&Array.isArray(b.applications)&&b.applications.forEach(A=>{const N=String(A).toLowerCase(),L=!a||N.includes(a),y=!d||N.includes(d);if(L&&y){const E=/\d{4}(?:-\d{4})?/g;(N.match(E)||[]).forEach(z=>{if(z.includes("-")){const[re,te]=z.split("-").map(Number);for(let le=re;le<=te;le++)v.add(String(le))}else v.add(z)})}})});const p=Array.from(v).sort();return F&&o&&!p.includes(o)&&(p.push(o),p.sort()),p},Pe=n=>e.jsx("div",{className:"buscarpeca-modal-pecas",children:e.jsx("div",{className:"compat-results-grid",children:e.jsx(Ye,{pecas:n,onViewCompatibility:_e,onViewDetails:$e})})}),$e=n=>{ve(n),fe(!0)},De=()=>{fe(!1),ve(null)},_e=n=>{const v=typeof n=="object"&&n?n:Q.find(p=>p.id===n);if(he("Compatibilidade"),!v||!v.applications){console.debug("[BuscarPeca] no applications for peca",v),ce(e.jsx("div",{children:"Nenhuma aplicaÃ§Ã£o encontrada."})),Y(!0);return}const a=e.jsx("div",{className:"buscarpeca-compat-wrapper",children:e.jsx(ze,{applications:v.applications,usuarioLogado:s})}),d=async()=>{try{if(!s){window.showToast&&window.showToast("FaÃ§a login para salvar pesquisas","error",3e3);return}const p=s.id||s.email,b=p&&String(p).trim().toLowerCase();let A=[];try{Array.from(document.querySelectorAll(".compat-modal .compatibility-grid-row")).forEach(E=>{const W=E.querySelector(".compatibility-vehicle-text"),z=E.querySelector(".compatibility-year-select"),re=W?String(W.textContent||"").trim():"",te=z?String(z.value||"").trim():"";(re||te)&&A.push({veiculo:re,ano:te})})}catch(y){console.debug("NÃ£o foi possÃ­vel ler anos selecionados do modal de compatibilidade",y)}const N={veiculoId:F||"",data:new Date().toISOString(),tipo:"preventiva",descricao:v?.nome||v?.name||"",kmAtual:"",oficina:"",valor:"",observacoes:"",meta:{savedFrom:"search",mappedFields:{id:v?.id},selectedApplications:A}};try{const y=Array.from(new Set(A.map(E=>E.ano).filter(Boolean)));y.length===1?(N.meta.selectedYearSummary=y[0],N.descricao&&(N.descricao=`${N.descricao} â€” Ano: ${y[0]}`)):y.length>1&&(N.meta.selectedYearSummary=y.join(", "))}catch{}const L=await Ge(b,N);if(Y(!1),L&&L.id){try{N&&N.descricao&&sessionStorage.setItem("pf_prefill_descricao",String(N.descricao))}catch{}const y={openMaintenanceId:L.id,prefillDescricao:N.descricao};try{if(typeof window<"u"&&window.location&&String(window.location.hash||"").includes("/historico-manutencao")){try{window.dispatchEvent(new CustomEvent("pf_open_maintenance",{detail:y}))}catch{}try{pe("/historico-manutencao",{state:y,replace:!0})}catch{}}else pe("/historico-manutencao",{state:y})}catch{try{window.location.hash="#/historico-manutencao"}catch{}}}window.showToast&&window.showToast("Pesquisa salva no histÃ³rico","success",2500)}catch(p){console.error("Salvar pesquisa falhou (compatibility modal)",p),window.showToast&&window.showToast("Erro ao salvar pesquisa","error",3e3)}};ce(a),Ce(()=>d),Y(!0)},qe=async n=>{if(n&&n.preventDefault&&n.preventDefault(),se(""),!(c||l||t||f||o||h)){se("Por favor, preencha pelo menos um campo para realizar a busca."),x(""),q(""),ee(""),ae("");return}D(!0),_("");const a={grupo:c,categoria:l,marca:t,modelo:f,ano:o,fabricante:h};try{const d=await de.buscarPecasML(a);console.log("ðŸ” Filtros aplicados:",a),console.log("ðŸ“¦ Dados retornados:",d),console.log("ðŸ“‹ PeÃ§as encontradas:",d.pecas?.length||0),console.log("ðŸŒ Fonte:",d.source||"local");const p=d.pecas||[];if(p.length===0){const b=[];a.marca&&b.push(`Marca: ${a.marca}`),a.modelo&&b.push(`Modelo: ${a.modelo}`),a.ano&&b.push(`Ano: ${a.ano}`),a.grupo&&b.push(`Grupo: ${a.grupo}`),a.categoria&&b.push(`PeÃ§a: ${a.categoria}`),a.fabricante&&b.push(`Fabricante: ${a.fabricante}`);const A=b.length>0?`Nenhuma peÃ§a encontrada para: ${b.join(", ")}. Tente remover alguns filtros ou buscar por termos mais genÃ©ricos.`:"Nenhuma peÃ§a encontrada para os filtros selecionados.";_(A)}else G(p),he(`Encontradas ${p.length} peÃ§a(s)`),ce(Pe(p)),Y(!0)}catch(d){console.error("âŒ Erro na busca:",d),_(d.message||"Erro ao buscar peÃ§as")}finally{D(!1)}},Be=()=>{m(""),r(""),S(""),j(""),w(""),M(""),G([]),_(""),x(""),q(""),ee(""),ae(""),se("")};return e.jsxs(e.Fragment,{children:[s?e.jsx(Te,{}):e.jsx(Ie,{}),e.jsx("div",{className:"page-wrapper menu-page",children:e.jsxs("div",{className:"page-content buscarpeca-section",children:[e.jsx("h2",{className:"page-title",children:"CatÃ¡logo de PeÃ§as"}),e.jsx("div",{className:"buscarpeca-intro",children:e.jsx("p",{children:"Encontre peÃ§as automotivas compatÃ­veis com seu veÃ­culo. Busque por marca, modelo e ano."})}),e.jsx(Qe,{selectedGrupo:c,setSelectedGrupo:m,selectedCategoria:l,setSelectedCategoria:r,selectedMarca:t,setSelectedMarca:S,selectedModelo:f,setSelectedModelo:j,selectedAno:o,setSelectedAno:w,selectedFabricante:h,setSelectedFabricante:M,grupos:T,todasPecas:Me(),marcas:Le(),modelos:Ee(),anos:Fe(),fabricantes:ke(),onSearch:qe,onClear:Be,onCarroChange:X,loading:J,error:O,warningMarca:Z,warningModelo:P,warningAno:ue,warningFabricante:je,emptyFieldsWarning:be})]})}),e.jsx(Ue,{show:Ne,onClose:()=>Y(!1),title:ne,titleIcon:ne==="Compatibilidade"?"./check.png":null,onSave:ne==="Compatibilidade"?we:void 0,children:ye}),e.jsx(Ve,{isOpen:Se,onClose:De,productId:Ae,selectedCarId:F})]})}export{ia as default};
